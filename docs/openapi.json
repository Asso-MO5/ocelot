{
  "openapi": "3.1.0",
  "info": {
    "title": "Ocelot API - Museum Back End",
    "description": "API backend Fastify avec authentification Discord OAuth2.\n\nCette documentation est gÃ©nÃ©rÃ©e Ã  partir des scÃ©narios Gherkin/Cucumber et des schÃ©mas Fastify.",
    "version": "1.0.0",
    "contact": {
      "name": "API Support"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Serveur de dÃ©veloppement"
    }
  ],
  "tags": [
    {
      "name": "Authentification",
      "description": "Endpoints d'authentification Discord OAuth2"
    }
  ],
  "paths": {
    "/auth/signin": {
      "get": {
        "tags": [
          "Authentification"
        ],
        "summary": "Redirige vers Discord OAuth2 pour l'authentification",
        "description": "**Redirection vers Discord pour l'authentification** : je devrais Ãªtre redirigÃ© vers Discord OAuth2 l'URL de redirection devrait contenir le client_id l'URL de redirection devrait contenir le redirect_uri l'URL de redirection devrait contenir les scopes demandÃ©s\n\n**Erreur si DISCORD_CLIENT_ID n'est pas configurÃ©** : je devrais recevoir une erreur 500 le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configurÃ©\"\n\n**Utilisation de scopes personnalisÃ©s** : l'URL de redirection Discord devrait contenir les scopes personnalisÃ©s\n\n**Configuration de l'URI de redirection personnalisÃ©e** : l'URL de redirection Discord devrait utiliser l'URI personnalisÃ©e\n\n### ScÃ©narios de test\n\n**Redirection vers Discord pour l'authentification**\n\nðŸ“‹ que je suis un utilisateur non authentifiÃ©\n\nâš¡ je fais une requÃªte GET vers \"/auth/signin\"\n\nâœ… je devrais Ãªtre redirigÃ© vers Discord OAuth2\n\nâœ… l'URL de redirection devrait contenir le client_id\n\nâœ… l'URL de redirection devrait contenir le redirect_uri\n\nâœ… l'URL de redirection devrait contenir les scopes demandÃ©s\n\n**Erreur si DISCORD_CLIENT_ID n'est pas configurÃ©**\n\nðŸ“‹ que DISCORD_CLIENT_ID n'est pas dÃ©fini\n\nâš¡ je fais une requÃªte GET vers \"/auth/signin\"\n\nâœ… je devrais recevoir une erreur 500\n\nâœ… le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configurÃ©\"\n\n**Utilisation de scopes personnalisÃ©s**\n\nðŸ“‹ que DISCORD_SCOPES est configurÃ© avec \"identify email guilds\"\n\nâš¡ je fais une requÃªte GET vers \"/auth/signin\"\n\nâœ… l'URL de redirection Discord devrait contenir les scopes personnalisÃ©s\n\n**Configuration de l'URI de redirection personnalisÃ©e**\n\nðŸ“‹ que DISCORD_REDIRECT_URI est configurÃ©\n\nâš¡ je fais une requÃªte GET vers \"/auth/signin\"\n\nâœ… l'URL de redirection Discord devrait utiliser l'URI personnalisÃ©e\n\n",
        "operationId": "get_auth_signin",
        "parameters": [],
        "responses": {
          "302": {
            "description": "Redirection",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string"
                },
                "description": "URL de redirection"
              }
            }
          },
          "500": {
            "description": "Erreur serveur - je devrais recevoir une erreur 500, le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configurÃ©\"",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "Message d'erreur"
                    }
                  },
                  "required": [
                    "error"
                  ]
                },
                "example": {
                  "error": "exemple_error"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "get": {
        "tags": [
          "Authentification"
        ],
        "summary": "Alias de /auth/signin - Redirige vers Discord OAuth2",
        "description": "**Redirection vers Discord via /auth/login** : je devrais Ãªtre redirigÃ© vers Discord OAuth2 le comportement devrait Ãªtre identique Ã  \"/auth/signin\"\n\n### ScÃ©narios de test\n\n**Redirection vers Discord via /auth/login**\n\nðŸ“‹ que je suis un utilisateur non authentifiÃ©\n\nâš¡ je fais une requÃªte GET vers \"/auth/login\"\n\nâœ… je devrais Ãªtre redirigÃ© vers Discord OAuth2\n\nâœ… le comportement devrait Ãªtre identique Ã  \"/auth/signin\"\n\n",
        "operationId": "get_auth_login",
        "parameters": [],
        "responses": {
          "302": {
            "description": "Redirection",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string"
                },
                "description": "URL de redirection"
              }
            }
          },
          "500": {
            "description": "Erreur serveur",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "Message d'erreur"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/auth/callback": {
      "get": {
        "tags": [
          "Authentification"
        ],
        "summary": "Callback OAuth2 de Discord - Ã‰change le code d'autorisation contre des tokens",
        "description": "**Callback OAuth2 sans code** : je devrais Ãªtre redirigÃ© vers le frontend avec error=missing_code\n\n### ScÃ©narios de test\n\n**Callback OAuth2 sans code**\n\nðŸ“‹ que Discord n'a pas retournÃ© de code\n\nâš¡ je fais une requÃªte GET vers \"/auth/callback\"\n\nâœ… je devrais Ãªtre redirigÃ© vers le frontend avec error=missing_code\n\n",
        "operationId": "get_auth_callback",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "description": "Code d'autorisation retournÃ© par Discord",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Code d'autorisation retournÃ© par Discord"
            }
          },
          {
            "name": "error",
            "in": "query",
            "description": "Code d'erreur retournÃ© par Discord",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Code d'erreur retournÃ© par Discord"
            }
          },
          {
            "name": "state",
            "in": "query",
            "description": "Ã‰tat passÃ© lors de la requÃªte initiale",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Ã‰tat passÃ© lors de la requÃªte initiale"
            }
          }
        ],
        "responses": {}
      }
    },
    "/auth/session": {
      "get": {
        "tags": [
          "Authentification"
        ],
        "summary": "VÃ©rifie l'Ã©tat de la session utilisateur",
        "description": "**VÃ©rification de session - utilisateur non authentifiÃ©** : je devrais recevoir authenticated: false je devrais recevoir hasRefreshToken: false\n\n**VÃ©rification de session - utilisateur authentifiÃ©** : je devrais recevoir authenticated: true je devrais recevoir hasRefreshToken: true si un refresh_token existe\n\n### ScÃ©narios de test\n\n**VÃ©rification de session - utilisateur non authentifiÃ©**\n\nðŸ“‹ que je n'ai pas de token d'accÃ¨s\n\nâš¡ je fais une requÃªte GET vers \"/auth/session\"\n\nâœ… je devrais recevoir authenticated: false\n\nâœ… je devrais recevoir hasRefreshToken: false\n\n**VÃ©rification de session - utilisateur authentifiÃ©**\n\nðŸ“‹ que j'ai un access_token valide\n\nâš¡ je fais une requÃªte GET vers \"/auth/session\"\n\nâœ… je devrais recevoir authenticated: true\n\nâœ… je devrais recevoir hasRefreshToken: true si un refresh_token existe\n\n",
        "operationId": "get_auth_session",
        "parameters": [],
        "responses": {
          "200": {
            "description": "SuccÃ¨s",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "authenticated": {
                      "type": "boolean",
                      "description": "Indique si l'utilisateur est authentifiÃ©"
                    },
                    "hasRefreshToken": {
                      "type": "boolean",
                      "description": "Indique si un refresh token est disponible"
                    }
                  },
                  "required": [
                    "authenticated",
                    "hasRefreshToken"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/auth/me": {
      "get": {
        "tags": [
          "Authentification"
        ],
        "summary": "RÃ©cupÃ¨re les informations de l'utilisateur authentifiÃ© (gÃ¨re automatiquement le refresh du token)",
        "description": "**RÃ©cupÃ©ration des donnÃ©es utilisateur - token valide** : je devrais recevoir mes informations utilisateur la rÃ©ponse devrait contenir id, username, discriminator, avatar la rÃ©ponse devrait contenir email si le scope email est accordÃ©\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - token expirÃ© avec refresh automatique** : que j'ai un refresh_token valide le refresh_token devrait Ãªtre utilisÃ© pour obtenir un nouveau access_token les nouveaux tokens devraient Ãªtre stockÃ©s dans les cookies je devrais recevoir mes informations utilisateur\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - token expirÃ© sans refresh token** : que je n'ai pas de refresh_token je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Token expirÃ© et aucun refresh token disponible\"\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - refresh token invalide** : que mon refresh_token est invalide je devrais recevoir une erreur 401 les cookies devraient Ãªtre supprimÃ©s le message d'erreur devrait indiquer \"Session expirÃ©e, veuillez vous reconnecter\"\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - non authentifiÃ©** : je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Non authentifiÃ©\"\n\n### ScÃ©narios de test\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - token valide**\n\nðŸ“‹ que j'ai un access_token valide\n\nâš¡ je fais une requÃªte GET vers \"/auth/me\"\n\nâœ… je devrais recevoir mes informations utilisateur\n\nâœ… la rÃ©ponse devrait contenir id, username, discriminator, avatar\n\nâœ… la rÃ©ponse devrait contenir email si le scope email est accordÃ©\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - token expirÃ© avec refresh automatique**\n\nðŸ“‹ que mon access_token est expirÃ©\n\nâœ… que j'ai un refresh_token valide\n\nâš¡ je fais une requÃªte GET vers \"/auth/me\"\n\nâœ… le refresh_token devrait Ãªtre utilisÃ© pour obtenir un nouveau access_token\n\nâœ… les nouveaux tokens devraient Ãªtre stockÃ©s dans les cookies\n\nâœ… je devrais recevoir mes informations utilisateur\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - token expirÃ© sans refresh token**\n\nðŸ“‹ que mon access_token est expirÃ©\n\nâœ… que je n'ai pas de refresh_token\n\nâš¡ je fais une requÃªte GET vers \"/auth/me\"\n\nâœ… je devrais recevoir une erreur 401\n\nâœ… le message d'erreur devrait indiquer \"Token expirÃ© et aucun refresh token disponible\"\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - refresh token invalide**\n\nðŸ“‹ que mon access_token est expirÃ©\n\nâœ… que mon refresh_token est invalide\n\nâš¡ je fais une requÃªte GET vers \"/auth/me\"\n\nâœ… je devrais recevoir une erreur 401\n\nâœ… les cookies devraient Ãªtre supprimÃ©s\n\nâœ… le message d'erreur devrait indiquer \"Session expirÃ©e, veuillez vous reconnecter\"\n\n**RÃ©cupÃ©ration des donnÃ©es utilisateur - non authentifiÃ©**\n\nðŸ“‹ que je n'ai pas de token d'accÃ¨s\n\nâš¡ je fais une requÃªte GET vers \"/auth/me\"\n\nâœ… je devrais recevoir une erreur 401\n\nâœ… le message d'erreur devrait indiquer \"Non authentifiÃ©\"\n\n",
        "operationId": "get_auth_me",
        "parameters": [],
        "responses": {
          "200": {
            "description": "SuccÃ¨s",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "ID unique de l'utilisateur Discord"
                    },
                    "username": {
                      "type": "string",
                      "description": "Nom d'utilisateur"
                    },
                    "discriminator": {
                      "type": "string",
                      "description": "Discriminator (4 chiffres)"
                    },
                    "avatar": {
                      "type": [
                        "string"
                      ],
                      "description": "Hash de l'avatar ou null",
                      "nullable": true
                    },
                    "email": {
                      "type": "string",
                      "description": "Email de l'utilisateur (si le scope email est accordÃ©)"
                    }
                  },
                  "required": [
                    "id",
                    "username",
                    "discriminator",
                    "avatar"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Non authentifiÃ© - que je n'ai pas de refresh_token, je devrais recevoir une erreur 401, le message d'erreur devrait indiquer \"Token expirÃ© et aucun refresh token disponible\"",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "Message d'erreur"
                    }
                  },
                  "required": [
                    "error"
                  ]
                },
                "example": {
                  "error": "exemple_error"
                }
              }
            }
          },
          "500": {
            "description": "Erreur serveur",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "Message d'erreur"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "discord_access_token",
        "description": "Token d'accÃ¨s Discord stockÃ© dans un cookie HTTP-only"
      }
    }
  }
}