openapi: "3.1.0"
info:
  title: "Ocelot API - Museum Back End"
  description: "API backend Fastify avec authentification Discord OAuth2.

Cette documentation est g√©n√©r√©e √† partir des sc√©narios Gherkin/Cucumber et des sch√©mas Fastify."
  version: "1.0.0"
  contact:
    name: "API Support"
servers:
  - url: "http://localhost:3000"
    description: "Serveur de d√©veloppement"
tags:
  - name: "Authentification"
    description: "Endpoints d'authentification Discord OAuth2"
  - name: "Paiement"
    description: "Endpoints de paiement SumUp"
  - name: "Mus√©e - Horaires"
    description: "Endpoints de gestion des horaires d'ouverture"
  - name: "Mus√©e - Tarifs"
    description: "Endpoints de gestion des tarifs"
  - name: "Mus√©e - Param√®tres"
    description: "Endpoints de gestion des param√®tres du mus√©e"
  - name: "Mus√©e - Capacit√©"
    description: "Endpoints de gestion de la capacit√© et des visiteurs"
  - name: "Mus√©e - Tickets"
    description: "Endpoints de gestion des tickets et r√©servations"
  - name: "Mus√©e - Cr√©neaux"
    description: "Endpoints de gestion des cr√©neaux horaires et disponibilit√©s"
paths:
  /auth/signin:
    get:
      tags:
        - Authentification
      summary: "Redirige vers Discord OAuth2 pour l'authentification"
      description: "**Redirection vers Discord pour l'authentification** : je devrais √™tre redirig√© vers Discord OAuth2 l'URL de redirection devrait contenir le client_id l'URL de redirection devrait contenir le redirect_uri l'URL de redirection devrait contenir les scopes demand√©s

**Erreur si DISCORD_CLIENT_ID n'est pas configur√©** : je devrais recevoir une erreur 500 le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configur√©\"

**Utilisation de scopes personnalis√©s** : l'URL de redirection Discord devrait contenir les scopes personnalis√©s

**Configuration de l'URI de redirection personnalis√©e** : l'URL de redirection Discord devrait utiliser l'URI personnalis√©e

### Sc√©narios de test

**Redirection vers Discord pour l'authentification**

üìã que je suis un utilisateur non authentifi√©

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ je devrais √™tre redirig√© vers Discord OAuth2

‚úÖ l'URL de redirection devrait contenir le client_id

‚úÖ l'URL de redirection devrait contenir le redirect_uri

‚úÖ l'URL de redirection devrait contenir les scopes demand√©s

**Erreur si DISCORD_CLIENT_ID n'est pas configur√©**

üìã que DISCORD_CLIENT_ID n'est pas d√©fini

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ je devrais recevoir une erreur 500

‚úÖ le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configur√©\"

**Utilisation de scopes personnalis√©s**

üìã que DISCORD_SCOPES est configur√© avec \"identify email guilds\"

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ l'URL de redirection Discord devrait contenir les scopes personnalis√©s

**Configuration de l'URI de redirection personnalis√©e**

üìã que DISCORD_REDIRECT_URI est configur√©

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ l'URL de redirection Discord devrait utiliser l'URI personnalis√©e

"
      operationId: "get_auth_signin"
      parameters:
      responses:
        302:
          description: "Redirection"
          content: null
          headers:
            Location:
              schema:
                type: "string"
              description: "URL de redirection"
        500:
          description: "Erreur serveur - je devrais recevoir une erreur 500, le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configur√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example:
                error: "exemple_error"
          headers: null
  /auth/login:
    get:
      tags:
        - Authentification
      summary: "Alias de /auth/signin - Redirige vers Discord OAuth2"
      description: "**Redirection vers Discord via /auth/login** : je devrais √™tre redirig√© vers Discord OAuth2 le comportement devrait √™tre identique √† \"/auth/signin\"

### Sc√©narios de test

**Redirection vers Discord via /auth/login**

üìã que je suis un utilisateur non authentifi√©

‚ö° je fais une requ√™te GET vers \"/auth/login\"

‚úÖ je devrais √™tre redirig√© vers Discord OAuth2

‚úÖ le comportement devrait √™tre identique √† \"/auth/signin\"

"
      operationId: "get_auth_login"
      parameters:
      responses:
        302:
          description: "Redirection"
          content: null
          headers:
            Location:
              schema:
                type: "string"
              description: "URL de redirection"
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example: null
          headers: null
  /auth/callback:
    get:
      tags:
        - Authentification
      summary: "Callback OAuth2 de Discord - √âchange le code d'autorisation contre des tokens"
      description: "**Callback OAuth2 sans code** : je devrais √™tre redirig√© vers le frontend avec error=missing_code

### Sc√©narios de test

**Callback OAuth2 sans code**

üìã que Discord n'a pas retourn√© de code

‚ö° je fais une requ√™te GET vers \"/auth/callback\"

‚úÖ je devrais √™tre redirig√© vers le frontend avec error=missing_code

"
      operationId: "get_auth_callback"
      parameters:
        - name: "code"
          in: "query"
          description: "Code d'autorisation retourn√© par Discord"
          required: false
          schema:
            type: "string"
            description: "Code d'autorisation retourn√© par Discord"
        - name: "error"
          in: "query"
          description: "Code d'erreur retourn√© par Discord"
          required: false
          schema:
            type: "string"
            description: "Code d'erreur retourn√© par Discord"
        - name: "state"
          in: "query"
          description: "√âtat pass√© lors de la requ√™te initiale"
          required: false
          schema:
            type: "string"
            description: "√âtat pass√© lors de la requ√™te initiale"
      responses:
  /auth/me:
    get:
      tags:
        - Authentification
      summary: "R√©cup√®re les informations de l'utilisateur authentifi√© (g√®re automatiquement le refresh du token)"
      description: "**R√©cup√©ration des donn√©es utilisateur - token valide** : je devrais recevoir mes informations utilisateur la r√©ponse devrait contenir id, username, discriminator, avatar la r√©ponse devrait contenir email si le scope email est accord√©

**R√©cup√©ration des donn√©es utilisateur - token expir√© avec refresh automatique** : que j'ai un refresh_token valide le refresh_token devrait √™tre utilis√© pour obtenir un nouveau access_token les nouveaux tokens devraient √™tre stock√©s dans les cookies je devrais recevoir mes informations utilisateur

**R√©cup√©ration des donn√©es utilisateur - token expir√© sans refresh token** : que je n'ai pas de refresh_token je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Token expir√© et aucun refresh token disponible\"

**R√©cup√©ration des donn√©es utilisateur - refresh token invalide** : que mon refresh_token est invalide je devrais recevoir une erreur 401 les cookies devraient √™tre supprim√©s le message d'erreur devrait indiquer \"Session expir√©e, veuillez vous reconnecter\"

**R√©cup√©ration des donn√©es utilisateur - non authentifi√©** : je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Non authentifi√©\"

### Sc√©narios de test

**R√©cup√©ration des donn√©es utilisateur - token valide**

üìã que j'ai un access_token valide

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir mes informations utilisateur

‚úÖ la r√©ponse devrait contenir id, username, discriminator, avatar

‚úÖ la r√©ponse devrait contenir email si le scope email est accord√©

**R√©cup√©ration des donn√©es utilisateur - token expir√© avec refresh automatique**

üìã que mon access_token est expir√©

‚úÖ que j'ai un refresh_token valide

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ le refresh_token devrait √™tre utilis√© pour obtenir un nouveau access_token

‚úÖ les nouveaux tokens devraient √™tre stock√©s dans les cookies

‚úÖ je devrais recevoir mes informations utilisateur

**R√©cup√©ration des donn√©es utilisateur - token expir√© sans refresh token**

üìã que mon access_token est expir√©

‚úÖ que je n'ai pas de refresh_token

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ le message d'erreur devrait indiquer \"Token expir√© et aucun refresh token disponible\"

**R√©cup√©ration des donn√©es utilisateur - refresh token invalide**

üìã que mon access_token est expir√©

‚úÖ que mon refresh_token est invalide

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ les cookies devraient √™tre supprim√©s

‚úÖ le message d'erreur devrait indiquer \"Session expir√©e, veuillez vous reconnecter\"

**R√©cup√©ration des donn√©es utilisateur - non authentifi√©**

üìã que je n'ai pas de token d'acc√®s

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ le message d'erreur devrait indiquer \"Non authentifi√©\"

"
      operationId: "get_auth_me"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                    description: "ID unique de l'utilisateur Discord"
                  username:
                    type: "string"
                    description: "Nom d'utilisateur"
                  discriminator:
                    type: "string"
                    description: "Discriminator (4 chiffres)"
                  avatar:
                    type:
                      - string
                    description: "Hash de l'avatar ou null"
                    nullable: true
                  email:
                    type: "string"
                    description: "Email de l'utilisateur (si le scope email est accord√©)"
                  roles:
                    type: "array"
                    description: "R√¥les de l'utilisateur"
                    items:
                      type: "string"
                      description: "Nom du r√¥le"
                required:
                  - id
                  - username
                  - discriminator
                  - avatar
                  - roles
              example: null
          headers: null
        401:
          description: "Non authentifi√© - que je n'ai pas de refresh_token, je devrais recevoir une erreur 401, le message d'erreur devrait indiquer \"Token expir√© et aucun refresh token disponible\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example: null
          headers: null
      security:
        - cookieAuth:
  /pay/checkout:
    post:
      tags:
        - Paiement
      summary: "Cr√©e un nouveau checkout SumUp pour un paiement"
      description: "**Cr√©er un checkout SumUp avec succ√®s** : que je fournis un montant valide dans le body je re√ßois une r√©ponse 200 la r√©ponse contient un \"checkout_id\" la r√©ponse contient le \"checkout_reference\" la r√©ponse contient le \"amount\" la r√©ponse contient la \"currency\" la r√©ponse contient le \"status\"

**Cr√©er un checkout avec un montant invalide** : que je fournis un montant n√©gatif ou nul dans le body je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre sup√©rieur √† 0

**Cr√©er un checkout avec une devise personnalis√©e** : que je fournis un montant valide que je sp√©cifie une devise dans le body(par exemple \"USD\") je re√ßois une r√©ponse 200 la r√©ponse contient la devise sp√©cifi√©e

**Cr√©er un checkout avec une description** : que je fournis un montant valide que je fournis une description dans le body je re√ßois une r√©ponse 200 le checkout est cr√©√© avec la description fournie

**Cr√©er un checkout avec une r√©f√©rence personnalis√©e** : que je fournis un montant valide que je fournis une \"checkout_reference\" personnalis√©e dans le body je re√ßois une r√©ponse 200 la r√©ponse contient la r√©f√©rence personnalis√©e fournie

**Cr√©er un checkout sans montant** : que je ne fournis pas de montant dans le body je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur de validation

**Cr√©er un checkout avec configuration SumUp manquante** : que je fournis un montant valide je re√ßois une r√©ponse 500 la r√©ponse contient un message indiquant que la configuration SumUp est manquante

**G√©rer les erreurs de l'API SumUp** : que je fournis un montant valide je re√ßois une r√©ponse 500 la r√©ponse contient un message d'erreur g√©n√©rique les d√©tails de l'erreur sont logg√©s c√¥t√© serveur

### Sc√©narios de test

**Cr√©er un checkout SumUp avec succ√®s**

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant valide dans le body

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un \"checkout_id\"

‚úÖ la r√©ponse contient le \"checkout_reference\"

‚úÖ la r√©ponse contient le \"amount\"

‚úÖ la r√©ponse contient la \"currency\"

‚úÖ la r√©ponse contient le \"status\"

**Cr√©er un checkout avec un montant invalide**

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant n√©gatif ou nul dans le body

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre sup√©rieur √† 0

**Cr√©er un checkout avec une devise personnalis√©e**

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant valide

‚úÖ que je sp√©cifie une devise dans le body(par exemple \"USD\")

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient la devise sp√©cifi√©e

**Cr√©er un checkout avec une description**

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant valide

‚úÖ que je fournis une description dans le body

‚úÖ je re√ßois une r√©ponse 200

‚úÖ le checkout est cr√©√© avec la description fournie

**Cr√©er un checkout avec une r√©f√©rence personnalis√©e**

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant valide

‚úÖ que je fournis une \"checkout_reference\" personnalis√©e dans le body

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient la r√©f√©rence personnalis√©e fournie

**Cr√©er un checkout sans montant**

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je ne fournis pas de montant dans le body

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur de validation

**Cr√©er un checkout avec configuration SumUp manquante**

üìã que SUMUP_API_KEY n'est pas configur√©e

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant valide

‚úÖ je re√ßois une r√©ponse 500

‚úÖ la r√©ponse contient un message indiquant que la configuration SumUp est manquante

**G√©rer les erreurs de l'API SumUp**

üìã que l'API SumUp retourne une erreur

‚ö° je fais une requ√™te POST vers \"/pay/checkout\"

‚úÖ que je fournis un montant valide

‚úÖ je re√ßois une r√©ponse 500

‚úÖ la r√©ponse contient un message d'erreur g√©n√©rique

‚úÖ les d√©tails de l'erreur sont logg√©s c√¥t√© serveur

"
      operationId: "post_pay_checkout"
      parameters:
      responses:
        200:
          description: "Succ√®s - que je fournis un montant valide dans le body, je re√ßois une r√©ponse 200, la r√©ponse contient un \"checkout_id\", la r√©ponse contient le \"checkout_reference\", la r√©ponse contient le \"amount\", la r√©ponse contient la \"currency\", la r√©ponse contient le \"status\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  checkout_id:
                    type: "string"
                    description: "ID du checkout SumUp"
                  checkout_reference:
                    type: "string"
                    description: "R√©f√©rence du checkout"
                  amount:
                    type: "number"
                    description: "Montant du paiement"
                  currency:
                    type: "string"
                    description: "Devise"
                  status:
                    type: "string"
                    description: "Statut du checkout"
              example:
                checkout_id: "exemple_checkout_id"
                checkout_reference: "exemple_checkout_reference"
                amount: 123
                currency: "exemple_currency"
                status: "exemple_status"
          headers: null
        400:
          description: "Code 400 - que je fournis un montant n√©gatif ou nul dans le body, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre sup√©rieur √† 0"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur - que je fournis un montant valide, je re√ßois une r√©ponse 500, la r√©ponse contient un message indiquant que la configuration SumUp est manquante"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - amount
              properties:
                amount:
                  type: "number"
                  minimum: 5
                  maximum: 12
                  description: "Montant du paiement"
                currency:
                  type: "string"
                  default: "EUR"
                  description: "Devise du paiement (d√©faut: EUR)"
                description:
                  type: "string"
                  description: "Description du paiement"
      security:
        - cookieAuth:
  /pay/checkout/:checkoutId:
    get:
      tags:
        - Paiement
      summary: "V√©rifie le statut d'un checkout SumUp"
      description: ""
      operationId: "get_pay_checkout_:checkoutId"
      parameters:
        - name: "checkoutId"
          in: "path"
          description: "ID du checkout SumUp"
          required: true
          schema:
            type: "string"
            description: "ID du checkout SumUp"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  checkout_reference:
                    type: "string"
                  amount:
                    type: "number"
                  currency:
                    type: "string"
                  status:
                    type: "string"
                    enum:
                      - PENDING
                      - PAID
                      - FAILED
                      - CANCELLED
                      - SENT
                      - SUCCESS
                  payment_type:
                    type: "string"
                  transaction_code:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /pay/webhook:
    post:
      tags:
        - Paiement
      summary: "Endpoint webhook pour recevoir les notifications de paiement SumUp. Met √† jour automatiquement les tickets associ√©s au checkout_id selon le statut du paiement (route publique)"
      description: ""
      operationId: "post_pay_webhook"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  success:
                    type: "boolean"
                    description: "Indique si le webhook a √©t√© trait√© avec succ√®s"
                  tickets_updated:
                    type: "number"
                    description: "Nombre de tickets mis √† jour"
                  qr_codes:
                    type: "array"
                    items:
                      type: "string"
                    description: "Liste des QR codes des tickets associ√©s au checkout"
                required:
                  - success
                  - tickets_updated
                  - qr_codes
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                id:
                  type: "string"
                  description: "ID de l'√©v√©nement webhook"
                type:
                  type: "string"
                  description: "Type d'√©v√©nement (checkout.payment.succeeded, checkout.payment.failed, etc.)"
                timestamp:
                  type: "string"
                  description: "Timestamp de l'√©v√©nement"
                checkout_id:
                  type: "string"
                  description: "ID du checkout SumUp"
                checkout_reference:
                  type: "string"
                  description: "R√©f√©rence du checkout"
                amount:
                  type: "number"
                  description: "Montant du paiement"
                currency:
                  type: "string"
                  description: "Devise"
                status:
                  type: "string"
                  enum:
                    - PENDING
                    - PAID
                    - FAILED
                    - CANCELLED
                    - SENT
                    - SUCCESS
                  description: "Statut du checkout"
                payment_type:
                  type: "string"
                  description: "Type de paiement"
                transaction_code:
                  type: "string"
                  description: "Code de transaction"
                merchant_code:
                  type: "string"
                  description: "Code marchand"
                event:
                  type: "object"
                  description: "D√©tails de l'√©v√©nement"
                  properties:
                    id:
                      type: "string"
                    type:
                      type: "string"
                    timestamp:
                      type: "string"
                    checkout_id:
                      type: "string"
                    checkout_reference:
                      type: "string"
                    amount:
                      type: "number"
                    currency:
                      type: "string"
                    status:
                      type: "string"
                    payment_type:
                      type: "string"
                    transaction_code:
                      type: "string"
  /museum/schedules:
    post:
      tags:
        - Mus√©e - Horaires
      summary: "Cr√©e ou met √† jour un horaire d'ouverture (UPSERT). Pour les exceptions : cherche par start_date, end_date et audience_type. Pour les horaires r√©currents : cherche par day_of_week et audience_type. Retourne 201 si cr√©√©, 200 si mis √† jour."
      description: "**Cr√©er un horaire r√©current pour le public** : que je fournis un day_of_week (0-6) que je fournis start_time et end_time que je fournis audience_type = \"public\" je re√ßois une r√©ponse 201 la r√©ponse contient l'horaire cr√©√© avec un id la r√©ponse contient day_of_week, start_time, end_time, audience_type

**Cr√©er un horaire r√©current pour les membres** : que je fournis un day_of_week (0-6) que je fournis start_time et end_time que je fournis audience_type = \"member\" je re√ßois une r√©ponse 201 la r√©ponse contient l'horaire cr√©√© avec audience_type = \"member\"

**Cr√©er une exception (horaires sp√©cifiques pour une p√©riode)** : que je fournis is_exception = true que je fournis start_date et end_date que je fournis start_time et end_time que je fournis audience_type je re√ßois une r√©ponse 201 la r√©ponse contient is_exception = true la r√©ponse contient start_date et end_date

**Cr√©er une fermeture exceptionnelle** : que je fournis is_exception = true que je fournis is_closed = true que je fournis start_date et end_date que je fournis une description je re√ßois une r√©ponse 201 la r√©ponse contient is_closed = true la r√©ponse contient la description

**Erreur lors de la cr√©ation d'un horaire r√©current sans day_of_week** : que je ne fournis pas day_of_week que is_exception = false je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que day_of_week est requis

**Erreur lors de la cr√©ation d'une exception sans dates** : que je fournis is_exception = true que je ne fournis pas start_date ou end_date je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que start_date et end_date sont requis

### Sc√©narios de test

**Cr√©er un horaire r√©current pour le public**

üìã que je veux cr√©er un horaire r√©current

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis un day_of_week (0-6)

‚úÖ que je fournis start_time et end_time

‚úÖ que je fournis audience_type = \"public\"

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient l'horaire cr√©√© avec un id

‚úÖ la r√©ponse contient day_of_week, start_time, end_time, audience_type

**Cr√©er un horaire r√©current pour les membres**

üìã que je veux cr√©er un horaire r√©current pour les membres

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis un day_of_week (0-6)

‚úÖ que je fournis start_time et end_time

‚úÖ que je fournis audience_type = \"member\"

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient l'horaire cr√©√© avec audience_type = \"member\"

**Cr√©er une exception (horaires sp√©cifiques pour une p√©riode)**

üìã que je veux cr√©er une exception pour les vacances

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis is_exception = true

‚úÖ que je fournis start_date et end_date

‚úÖ que je fournis start_time et end_time

‚úÖ que je fournis audience_type

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient is_exception = true

‚úÖ la r√©ponse contient start_date et end_date

**Cr√©er une fermeture exceptionnelle**

üìã que je veux cr√©er une fermeture exceptionnelle

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis is_exception = true

‚úÖ que je fournis is_closed = true

‚úÖ que je fournis start_date et end_date

‚úÖ que je fournis une description

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient is_closed = true

‚úÖ la r√©ponse contient la description

**Erreur lors de la cr√©ation d'un horaire r√©current sans day_of_week**

üìã que je veux cr√©er un horaire r√©current

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je ne fournis pas day_of_week

‚úÖ que is_exception = false

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que day_of_week est requis

**Erreur lors de la cr√©ation d'une exception sans dates**

üìã que je veux cr√©er une exception

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis is_exception = true

‚úÖ que je ne fournis pas start_date ou end_date

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que start_date et end_date sont requis

"
      operationId: "post_museum_schedules"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                description: "Horaire mis √† jour (upsert)"
              example: null
          headers: null
        201:
          description: "Code 201 - que je fournis un day_of_week (0-6), que je fournis start_time et end_time, que je fournis audience_type = \"public\", je re√ßois une r√©ponse 201, la r√©ponse contient l'horaire cr√©√© avec un id, la r√©ponse contient day_of_week, start_time, end_time, audience_type"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                description: "Nouvel horaire cr√©√© (upsert)"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400 - que je ne fournis pas day_of_week, que is_exception = false, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que day_of_week est requis"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - start_time
                - end_time
                - audience_type
              properties:
                day_of_week:
                  type: "integer"
                  minimum: 0
                  maximum: 6
                  description: "Jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi). Requis si is_exception est false."
                start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but au format HH:MM:SS"
                end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin au format HH:MM:SS"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                is_exception:
                  type: "boolean"
                  default: false
                  description: "Indique si c'est une exception (vacances, fermeture exceptionnelle, etc.)"
                is_closed:
                  type: "boolean"
                  default: false
                  description: "Indique si le mus√©e est ferm√©"
                description:
                  type: "string"
                  description: "Description de l'exception ou du changement d'horaire"
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage (optionnel, sera auto-assign√©e si non fournie)"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Horaires
      summary: "R√©cup√®re tous les horaires avec filtres optionnels (authentification requise)"
      description: "**R√©cup√©rer tous les horaires** : je re√ßois une r√©ponse 200 la r√©ponse contient un tableau d'horaires

### Sc√©narios de test

**R√©cup√©rer tous les horaires**

üìã que des horaires existent en base de donn√©es

‚ö° je fais une requ√™te GET vers \"/museum/schedules\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau d'horaires

"
      operationId: "get_museum_schedules"
      parameters:
        - name: "day_of_week"
          in: "query"
          description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
          required: false
          schema:
            type: "integer"
            minimum: 0
            maximum: 6
            description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
        - name: "audience_type"
          in: "query"
          description: "Filtrer par type d'audience"
          required: false
          schema:
            type: "string"
            enum:
              - public
              - member
              - holiday
            description: "Filtrer par type d'audience"
        - name: "date"
          in: "query"
          description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
        - name: "include_exceptions"
          in: "query"
          description: "Inclure les exceptions dans les r√©sultats"
          required: false
          schema:
            type: "boolean"
            default: true
            description: "Inclure les exceptions dans les r√©sultats"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient un tableau d'horaires"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    day_of_week:
                      type:
                        - integer
                      nullable: true
                    start_time:
                      type: "string"
                    end_time:
                      type: "string"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_exception:
                      type: "boolean"
                    is_closed:
                      type: "boolean"
                    description:
                      type:
                        - string
                      nullable: true
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/schedules/public:
    get:
      tags:
        - Mus√©e - Horaires
      summary: "R√©cup√®re uniquement les horaires publics (route publique, accessible sans authentification)"
      description: ""
      operationId: "get_museum_schedules_public"
      parameters:
        - name: "day_of_week"
          in: "query"
          description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
          required: false
          schema:
            type: "integer"
            minimum: 0
            maximum: 6
            description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
        - name: "date"
          in: "query"
          description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
        - name: "include_exceptions"
          in: "query"
          description: "Inclure les exceptions dans les r√©sultats"
          required: false
          schema:
            type: "boolean"
            default: true
            description: "Inclure les exceptions dans les r√©sultats"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    day_of_week:
                      type:
                        - integer
                      nullable: true
                    start_time:
                      type: "string"
                    end_time:
                      type: "string"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_exception:
                      type: "boolean"
                    is_closed:
                      type: "boolean"
                    description:
                      type:
                        - string
                      nullable: true
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/schedules/:id:
    get:
      tags:
        - Mus√©e - Horaires
      summary: "R√©cup√®re un horaire par son ID"
      description: "**R√©cup√©rer un horaire par son ID** : je re√ßois une r√©ponse 200 la r√©ponse contient l'horaire avec l'id demand√©

**Erreur lors de la r√©cup√©ration d'un horaire inexistant** : je re√ßois une r√©ponse 404 la r√©ponse contient un message d'erreur \"Horaire non trouv√©\"

### Sc√©narios de test

**R√©cup√©rer un horaire par son ID**

üìã qu'un horaire existe avec un id sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/schedules/:id\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient l'horaire avec l'id demand√©

**Erreur lors de la r√©cup√©ration d'un horaire inexistant**

üìã qu'aucun horaire n'existe avec cet id

‚ö° je fais une requ√™te GET vers \"/museum/schedules/:id\"

‚úÖ je re√ßois une r√©ponse 404

‚úÖ la r√©ponse contient un message d'erreur \"Horaire non trouv√©\"

"
      operationId: "get_museum_schedules_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de l'horaire"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de l'horaire"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient l'horaire avec l'id demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404 - je re√ßois une r√©ponse 404, la r√©ponse contient un message d'erreur \"Horaire non trouv√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Horaires
      summary: "Met √† jour un horaire"
      description: "**Mettre √† jour un horaire** : que je fournis les champs √† mettre √† jour je re√ßois une r√©ponse 200 la r√©ponse contient l'horaire mis √† jour

### Sc√©narios de test

**Mettre √† jour un horaire**

üìã qu'un horaire existe

‚ö° je fais une requ√™te PUT vers \"/museum/schedules/:id\"

‚úÖ que je fournis les champs √† mettre √† jour

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient l'horaire mis √† jour

"
      operationId: "put_museum_schedules_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de l'horaire √† mettre √† jour"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de l'horaire √† mettre √† jour"
      responses:
        200:
          description: "Succ√®s - que je fournis les champs √† mettre √† jour, je re√ßois une r√©ponse 200, la r√©ponse contient l'horaire mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                day_of_week:
                  type:
                    - integer
                  minimum: 0
                  maximum: 6
                  description: "Jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
                  nullable: true
                start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but au format HH:MM:SS"
                end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin au format HH:MM:SS"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de d√©but pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                  nullable: true
                end_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de fin pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                  nullable: true
                is_exception:
                  type: "boolean"
                  description: "Indique si c'est une exception"
                is_closed:
                  type: "boolean"
                  description: "Indique si le mus√©e est ferm√©"
                description:
                  type:
                    - string
                  description: "Description de l'exception ou du changement d'horaire"
                  nullable: true
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage"
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Horaires
      summary: "Supprime un horaire"
      description: "**Supprimer un horaire** : je re√ßois une r√©ponse 204 l'horaire est supprim√© de la base de donn√©es

**Erreur lors de la suppression d'un horaire inexistant** : je re√ßois une r√©ponse 404 la r√©ponse contient un message d'erreur \"Horaire non trouv√©\"

### Sc√©narios de test

**Supprimer un horaire**

üìã qu'un horaire existe

‚ö° je fais une requ√™te DELETE vers \"/museum/schedules/:id\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ l'horaire est supprim√© de la base de donn√©es

**Erreur lors de la suppression d'un horaire inexistant**

üìã qu'aucun horaire n'existe avec cet id

‚ö° je fais une requ√™te DELETE vers \"/museum/schedules/:id\"

‚úÖ je re√ßois une r√©ponse 404

‚úÖ la r√©ponse contient un message d'erreur \"Horaire non trouv√©\"

"
      operationId: "delete_museum_schedules_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de l'horaire √† supprimer"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de l'horaire √† supprimer"
      responses:
        204:
          description: "Code 204 - je re√ßois une r√©ponse 204, l'horaire est supprim√© de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404 - je re√ßois une r√©ponse 404, la r√©ponse contient un message d'erreur \"Horaire non trouv√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/schedules/reorder:
    post:
      tags:
        - Mus√©e - Horaires
      summary: "R√©ordonne les horaires selon l'ordre fourni. Met √† jour les positions de tous les horaires selon l'ordre des IDs fournis (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      description: ""
      operationId: "post_museum_schedules_reorder"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    day_of_week:
                      type:
                        - integer
                      nullable: true
                    start_time:
                      type: "string"
                    end_time:
                      type: "string"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_exception:
                      type: "boolean"
                    is_closed:
                      type: "boolean"
                    description:
                      type:
                        - string
                      nullable: true
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
                description: "Liste des horaires r√©ordonn√©s avec leurs nouvelles positions"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - schedule_ids
              properties:
                schedule_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  minItems: 1
                  description: "Tableau d'IDs d'horaires dans l'ordre souhait√©. Les positions seront mises √† jour selon cet ordre (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      security:
        - cookieAuth:
  /museum/prices:
    post:
      tags:
        - Mus√©e - Tarifs
      summary: "Cr√©e ou met √† jour un tarif (upsert). Si un id est fourni et existe, met √† jour le tarif (retourne 200). Sinon, cr√©e un nouveau tarif (retourne 201)."
      description: "**Cr√©er un tarif pour le public** : que je fournis un name que je fournis un amount en euros que je fournis audience_type = \"public\" je re√ßois une r√©ponse 201 la r√©ponse contient le tarif cr√©√© avec un id la r√©ponse contient name, amount, audience_type

**Cr√©er un tarif pour les membres** : que je fournis un name que je fournis un amount en euros que je fournis audience_type = \"member\" je re√ßois une r√©ponse 201 la r√©ponse contient le tarif cr√©√© avec audience_type = \"member\"

**Cr√©er un tarif avec dates de validit√©** : que je fournis start_date et end_date que je fournis name, amount, audience_type je re√ßois une r√©ponse 201 la r√©ponse contient start_date et end_date

**Cr√©er un tarif inactif** : que je fournis is_active = false que je fournis name, amount, audience_type je re√ßois une r√©ponse 201 la r√©ponse contient is_active = false

**Cr√©er un tarif n√©cessitant un justificatif** : que je fournis requires_proof = true que je fournis name, amount, audience_type je re√ßois une r√©ponse 201 la r√©ponse contient requires_proof = true

**Erreur lors de la cr√©ation d'un tarif avec montant n√©gatif** : que je fournis un amount n√©gatif je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre positif

**Erreur lors de la cr√©ation d'un tarif avec dates invalides** : que je fournis start_date sans end_date je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que start_date et end_date doivent √™tre d√©finis ensemble

**Erreur lors de la cr√©ation d'un tarif avec start_date apr√®s end_date** : que je fournis start_date apr√®s end_date je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que start_date doit √™tre ant√©rieure √† end_date

**Acc√®s non autoris√© pour cr√©er un tarif sans authentification** : je re√ßois une r√©ponse 401 la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un tarif sans les r√¥les requis** : je re√ßois une r√©ponse 403 la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©er un tarif pour le public**

üìã que je veux cr√©er un tarif pour le public

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis un name

‚úÖ que je fournis un amount en euros

‚úÖ que je fournis audience_type = \"public\"

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient le tarif cr√©√© avec un id

‚úÖ la r√©ponse contient name, amount, audience_type

**Cr√©er un tarif pour les membres**

üìã que je veux cr√©er un tarif pour les membres

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis un name

‚úÖ que je fournis un amount en euros

‚úÖ que je fournis audience_type = \"member\"

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient le tarif cr√©√© avec audience_type = \"member\"

**Cr√©er un tarif avec dates de validit√©**

üìã que je veux cr√©er un tarif valide pour une p√©riode sp√©cifique

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis start_date et end_date

‚úÖ que je fournis name, amount, audience_type

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient start_date et end_date

**Cr√©er un tarif inactif**

üìã que je veux cr√©er un tarif inactif

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis is_active = false

‚úÖ que je fournis name, amount, audience_type

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient is_active = false

**Cr√©er un tarif n√©cessitant un justificatif**

üìã que je veux cr√©er un tarif r√©duit n√©cessitant un justificatif

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis requires_proof = true

‚úÖ que je fournis name, amount, audience_type

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient requires_proof = true

**Erreur lors de la cr√©ation d'un tarif avec montant n√©gatif**

üìã que je veux cr√©er un tarif

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis un amount n√©gatif

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre positif

**Erreur lors de la cr√©ation d'un tarif avec dates invalides**

üìã que je veux cr√©er un tarif avec dates

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis start_date sans end_date

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que start_date et end_date doivent √™tre d√©finis ensemble

**Erreur lors de la cr√©ation d'un tarif avec start_date apr√®s end_date**

üìã que je veux cr√©er un tarif avec dates

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis start_date apr√®s end_date

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que start_date doit √™tre ant√©rieure √† end_date

**Acc√®s non autoris√© pour cr√©er un tarif sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ je re√ßois une r√©ponse 401

‚úÖ la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un tarif sans les r√¥les requis**

üìã que je suis authentifi√© mais sans les r√¥les bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ je re√ßois une r√©ponse 403

‚úÖ la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_prices"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                description: "Tarif mis √† jour (si id fourni et existe)"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example: null
          headers: null
        201:
          description: "Code 201 - que je fournis un name, que je fournis un amount en euros, que je fournis audience_type = \"public\", je re√ßois une r√©ponse 201, la r√©ponse contient le tarif cr√©√© avec un id, la r√©ponse contient name, amount, audience_type"
          content:
            application/json:
              schema:
                type: "object"
                description: "Nouveau tarif cr√©√©"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        400:
          description: "Code 400 - que je fournis un amount n√©gatif, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre positif"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - amount
                - audience_type
                - translations
              properties:
                id:
                  type: "string"
                  format: "uuid"
                  description: "ID optionnel pour l'upsert : si fourni et existe, met √† jour le tarif ; sinon cr√©e un nouveau tarif avec cet ID ou g√©n√®re un nouvel ID"
                amount:
                  type: "number"
                  minimum: 0
                  description: "Montant en euros"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but de validit√© (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin de validit√© (format YYYY-MM-DD)"
                is_active:
                  type: "boolean"
                  default: true
                  description: "Indique si le tarif est actif"
                requires_proof:
                  type: "boolean"
                  default: false
                  description: "Indique si le tarif n√©cessite un justificatif (ex: tarif r√©duit √©tudiant, senior, etc.)"
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage (optionnel, sera auto-assign√©e si non fournie)"
                translations:
                  type: "array"
                  minItems: 1
                  description: "Traductions du tarif (au moins une traduction pour \"name\" est requise)"
                  items:
                    type: "object"
                    required:
                      - lang
                      - field_name
                      - translation
                    properties:
                      lang:
                        type: "string"
                        minLength: 2
                        maxLength: 10
                        description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
                      field_name:
                        type: "string"
                        enum:
                          - name
                          - description
                        description: "Nom du champ √† traduire (name ou description)"
                      translation:
                        type: "string"
                        minLength: 1
                        description: "Texte traduit"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Tarifs
      summary: "R√©cup√®re tous les tarifs avec filtres optionnels"
      description: "**R√©cup√©rer tous les tarifs actifs** : je re√ßois une r√©ponse 200 la r√©ponse contient un tableau de tarifs tous les tarifs retourn√©s ont is_active = true

### Sc√©narios de test

**R√©cup√©rer tous les tarifs actifs**

üìã que des tarifs existent en base de donn√©es

‚ö° je fais une requ√™te GET vers \"/museum/prices\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau de tarifs

‚úÖ tous les tarifs retourn√©s ont is_active = true

"
      operationId: "get_museum_prices"
      parameters:
        - name: "audience_type"
          in: "query"
          description: "Filtrer par type d'audience"
          required: false
          schema:
            type: "string"
            enum:
              - public
              - member
            description: "Filtrer par type d'audience"
        - name: "date"
          in: "query"
          description: "R√©cup√©rer les tarifs valides pour une date sp√©cifique (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "R√©cup√©rer les tarifs valides pour une date sp√©cifique (format YYYY-MM-DD)"
        - name: "is_active"
          in: "query"
          description: "Filtrer par statut actif/inactif"
          required: false
          schema:
            type: "boolean"
            description: "Filtrer par statut actif/inactif"
        - name: "lang"
          in: "query"
          description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
          required: false
          schema:
            type: "string"
            minLength: 2
            maxLength: 10
            description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient un tableau de tarifs, tous les tarifs retourn√©s ont is_active = true"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    amount:
                      type: "number"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_active:
                      type: "boolean"
                    requires_proof:
                      type: "boolean"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
                    translations:
                      type: "object"
                      description: "Traductions organis√©es par langue et champ"
                      additionalProperties:
                        type: "object"
                        additionalProperties:
                          type: "string"
                    name:
                      type: "string"
                    description:
                      type:
                        - string
                      nullable: true
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/prices/:id:
    get:
      tags:
        - Mus√©e - Tarifs
      summary: "R√©cup√®re un tarif par son ID"
      description: "**R√©cup√©rer un tarif par son ID** : je re√ßois une r√©ponse 200 la r√©ponse contient le tarif avec l'id demand√©

**Erreur lors de la r√©cup√©ration d'un tarif inexistant** : je re√ßois une r√©ponse 404 la r√©ponse contient un message d'erreur \"Tarif non trouv√©\"

### Sc√©narios de test

**R√©cup√©rer un tarif par son ID**

üìã qu'un tarif existe avec un id sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/prices/:id\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le tarif avec l'id demand√©

**Erreur lors de la r√©cup√©ration d'un tarif inexistant**

üìã qu'aucun tarif n'existe avec cet id

‚ö° je fais une requ√™te GET vers \"/museum/prices/:id\"

‚úÖ je re√ßois une r√©ponse 404

‚úÖ la r√©ponse contient un message d'erreur \"Tarif non trouv√©\"

"
      operationId: "get_museum_prices_:id"
      parameters:
        - name: "lang"
          in: "query"
          description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
          required: false
          schema:
            type: "string"
            minLength: 2
            maxLength: 10
            description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
        - name: "id"
          in: "path"
          description: "ID du tarif"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du tarif"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient le tarif avec l'id demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        404:
          description: "Code 404 - je re√ßois une r√©ponse 404, la r√©ponse contient un message d'erreur \"Tarif non trouv√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Tarifs
      summary: "Met √† jour un tarif"
      description: "**Mettre √† jour un tarif** : que je fournis les champs √† mettre √† jour je re√ßois une r√©ponse 200 la r√©ponse contient le tarif mis √† jour

**D√©sactiver un tarif** : que je fournis is_active = false je re√ßois une r√©ponse 200 la r√©ponse contient is_active = false

### Sc√©narios de test

**Mettre √† jour un tarif**

üìã qu'un tarif existe

‚ö° je fais une requ√™te PUT vers \"/museum/prices/:id\"

‚úÖ que je fournis les champs √† mettre √† jour

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le tarif mis √† jour

**D√©sactiver un tarif**

üìã qu'un tarif existe

‚ö° je fais une requ√™te PUT vers \"/museum/prices/:id\"

‚úÖ que je fournis is_active = false

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient is_active = false

"
      operationId: "put_museum_prices_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du tarif √† mettre √† jour"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du tarif √† mettre √† jour"
      responses:
        200:
          description: "Succ√®s - que je fournis les champs √† mettre √† jour, je re√ßois une r√©ponse 200, la r√©ponse contient le tarif mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                amount:
                  type: "number"
                  minimum: 0
                  description: "Montant en euros"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de d√©but de validit√© (format YYYY-MM-DD)"
                  nullable: true
                end_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de fin de validit√© (format YYYY-MM-DD)"
                  nullable: true
                is_active:
                  type: "boolean"
                  description: "Indique si le tarif est actif"
                requires_proof:
                  type: "boolean"
                  description: "Indique si le tarif n√©cessite un justificatif"
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage"
                translations:
                  type: "array"
                  description: "Traductions du tarif"
                  items:
                    type: "object"
                    required:
                      - lang
                      - field_name
                      - translation
                    properties:
                      lang:
                        type: "string"
                        minLength: 2
                        maxLength: 10
                        description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
                      field_name:
                        type: "string"
                        enum:
                          - name
                          - description
                        description: "Nom du champ √† traduire (name ou description)"
                      translation:
                        type: "string"
                        minLength: 1
                        description: "Texte traduit"
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Tarifs
      summary: "Supprime un tarif"
      description: "**Supprimer un tarif** : je re√ßois une r√©ponse 204 le tarif est supprim√© de la base de donn√©es

**Erreur lors de la suppression d'un tarif inexistant** : je re√ßois une r√©ponse 404 la r√©ponse contient un message d'erreur \"Tarif non trouv√©\"

### Sc√©narios de test

**Supprimer un tarif**

üìã qu'un tarif existe

‚ö° je fais une requ√™te DELETE vers \"/museum/prices/:id\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ le tarif est supprim√© de la base de donn√©es

**Erreur lors de la suppression d'un tarif inexistant**

üìã qu'aucun tarif n'existe avec cet id

‚ö° je fais une requ√™te DELETE vers \"/museum/prices/:id\"

‚úÖ je re√ßois une r√©ponse 404

‚úÖ la r√©ponse contient un message d'erreur \"Tarif non trouv√©\"

"
      operationId: "delete_museum_prices_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du tarif √† supprimer"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du tarif √† supprimer"
      responses:
        204:
          description: "Code 204 - je re√ßois une r√©ponse 204, le tarif est supprim√© de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404 - je re√ßois une r√©ponse 404, la r√©ponse contient un message d'erreur \"Tarif non trouv√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/prices/reorder:
    post:
      tags:
        - Mus√©e - Tarifs
      summary: "R√©ordonne les tarifs selon l'ordre fourni. Met √† jour les positions de tous les tarifs selon l'ordre des IDs fournis (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      description: ""
      operationId: "post_museum_prices_reorder"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    amount:
                      type: "number"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_active:
                      type: "boolean"
                    requires_proof:
                      type: "boolean"
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
                    translations:
                      type: "object"
                      description: "Traductions organis√©es par langue et champ"
                      additionalProperties:
                        type: "object"
                        additionalProperties:
                          type: "string"
                    name:
                      type: "string"
                    description:
                      type:
                        - string
                      nullable: true
                description: "Liste des tarifs r√©ordonn√©s avec leurs nouvelles positions"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - price_ids
              properties:
                price_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  minItems: 1
                  description: "Tableau d'IDs de tarifs dans l'ordre souhait√©. Les positions seront mises √† jour selon cet ordre (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      security:
        - cookieAuth:
  /museum/settings:
    get:
      tags:
        - Mus√©e - Param√®tres
      summary: "R√©cup√®re tous les param√®tres avec filtres optionnels"
      description: ""
      operationId: "get_museum_settings"
      parameters:
        - name: "key"
          in: "query"
          description: "Filtrer par cl√© sp√©cifique"
          required: false
          schema:
            type: "string"
            description: "Filtrer par cl√© sp√©cifique"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    key:
                      type: "string"
                    value:
                      type: "string"
                    value_type:
                      type: "string"
                    description:
                      type:
                        - string
                      nullable: true
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    post:
      tags:
        - Mus√©e - Param√®tres
      summary: "Cr√©e ou met √† jour un param√®tre (upsert) - Retourne 201 si cr√©√©, 200 si mis √† jour"
      description: ""
      operationId: "post_museum_settings"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - key
                - value
              properties:
                key:
                  type: "string"
                  minLength: 1
                  maxLength: 255
                  description: "Cl√© unique du param√®tre (ex: \"max_capacity\", \"current_visitors\")"
                value:
                  description: "Valeur du param√®tre (string, number, boolean ou object) - Le type est auto-d√©tect√© si value_type n'est pas fourni"
                description:
                  type: "string"
                  description: "Description du param√®tre"
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Param√®tres
      summary: "Cr√©e ou met √† jour un param√®tre (upsert) - Retourne 201 si cr√©√©, 200 si mis √† jour"
      description: ""
      operationId: "put_museum_settings"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - key
                - value
              properties:
                key:
                  type: "string"
                  minLength: 1
                  maxLength: 255
                  description: "Cl√© unique du param√®tre (ex: \"max_capacity\", \"current_visitors\")"
                value:
                  description: "Valeur du param√®tre (string, number, boolean ou object) - Le type est auto-d√©tect√© si value_type n'est pas fourni"
                description:
                  type: "string"
                  description: "Description du param√®tre"
      security:
        - cookieAuth:
  /museum/settings/:key:
    get:
      tags:
        - Mus√©e - Param√®tres
      summary: "R√©cup√®re un param√®tre par sa cl√©"
      description: ""
      operationId: "get_museum_settings_:key"
      parameters:
        - name: "key"
          in: "path"
          description: "Cl√© du param√®tre"
          required: true
          schema:
            type: "string"
            description: "Cl√© du param√®tre"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type: "string"
                  value_type:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Param√®tres
      summary: "Supprime un param√®tre par sa cl√©"
      description: ""
      operationId: "delete_museum_settings_:key"
      parameters:
        - name: "key"
          in: "path"
          description: "Cl√© du param√®tre √† supprimer"
          required: true
          schema:
            type: "string"
            description: "Cl√© du param√®tre √† supprimer"
      responses:
        204:
          description: "Code 204"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/capacity/max:
    get:
      tags:
        - Mus√©e - Capacit√©
      summary: "R√©cup√®re la capacit√© maximale du mus√©e"
      description: ""
      operationId: "get_museum_capacity_max"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  max_capacity:
                    type: "number"
                    description: "Capacit√© maximale du mus√©e"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    post:
      tags:
        - Mus√©e - Capacit√©
      summary: "D√©finit la capacit√© maximale du mus√©e"
      description: ""
      operationId: "post_museum_capacity_max"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type: "string"
                  value_type:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - max_capacity
              properties:
                max_capacity:
                  type: "number"
                  minimum: 0
                  description: "Capacit√© maximale du mus√©e (doit √™tre positive ou nulle)"
      security:
        - cookieAuth:
  /museum/capacity/validated-tickets:
    get:
      tags:
        - Mus√©e - Capacit√©
      summary: "R√©cup√®re les tickets valid√©s pour un cr√©neau donn√©. Retourne le nombre de tickets valid√©s (count) et la liste compl√®te des tickets (tickets) pour le cr√©neau sp√©cifi√©. Peut inclure les cr√©neaux adjacents si include_adjacent_slots est true."
      description: ""
      operationId: "get_museum_capacity_validated-tickets"
      parameters:
        - name: "reservation_date"
          in: "query"
          description: "Date de r√©servation (format YYYY-MM-DD)"
          required: true
          schema:
            type: "string"
            format: "date"
            description: "Date de r√©servation (format YYYY-MM-DD)"
        - name: "slot_start_time"
          in: "query"
          description: "Heure de d√©but du cr√©neau (format HH:MM:SS)"
          required: true
          schema:
            type: "string"
            pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
            description: "Heure de d√©but du cr√©neau (format HH:MM:SS)"
        - name: "slot_end_time"
          in: "query"
          description: "Heure de fin du cr√©neau (format HH:MM:SS)"
          required: true
          schema:
            type: "string"
            pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
            description: "Heure de fin du cr√©neau (format HH:MM:SS)"
        - name: "include_adjacent_slots"
          in: "query"
          description: "Inclure les cr√©neaux adjacents (par d√©faut: true)"
          required: false
          schema:
            type: "boolean"
            default: true
            description: "Inclure les cr√©neaux adjacents (par d√©faut: true)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  count:
                    type: "number"
                    description: "Nombre de tickets valid√©s pour le cr√©neau"
                  tickets:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        qr_code:
                          type: "string"
                        first_name:
                          type:
                            - string
                          nullable: true
                        last_name:
                          type:
                            - string
                          nullable: true
                        email:
                          type: "string"
                        reservation_date:
                          type: "string"
                        slot_start_time:
                          type: "string"
                        slot_end_time:
                          type: "string"
                        checkout_id:
                          type:
                            - string
                          nullable: true
                        checkout_reference:
                          type:
                            - string
                          nullable: true
                        transaction_status:
                          type:
                            - string
                          nullable: true
                        ticket_price:
                          type: "number"
                        donation_amount:
                          type: "number"
                        total_amount:
                          type: "number"
                        status:
                          type: "string"
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        language:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                    description: "Liste des tickets valid√©s pour le cr√©neau"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets:
    post:
      tags:
        - Mus√©e - Tickets
      summary: "Cr√©e un nouveau ticket avec g√©n√©ration automatique d'un code QR unique"
      description: ""
      operationId: "post_museum_tickets"
      parameters:
      responses:
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - email
                - reservation_date
                - slot_start_time
                - slot_end_time
                - ticket_price
              properties:
                first_name:
                  type: "string"
                  maxLength: 255
                  description: "Pr√©nom du visiteur (optionnel)"
                last_name:
                  type: "string"
                  maxLength: 255
                  description: "Nom du visiteur (optionnel)"
                email:
                  type: "string"
                  format: "email"
                  maxLength: 255
                  description: "Email du visiteur (obligatoire pour recevoir le ticket)"
                reservation_date:
                  type: "string"
                  format: "date"
                  description: "Date de r√©servation (format YYYY-MM-DD)"
                slot_start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but du cr√©neau horaire (format HH:MM:SS)"
                slot_end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin du cr√©neau horaire (format HH:MM:SS)"
                ticket_price:
                  type: "number"
                  minimum: 0
                  description: "Prix du ticket en euros"
                donation_amount:
                  type: "number"
                  minimum: 0
                  default: 0
                  description: "Montant du don optionnel en euros (0 par d√©faut)"
                checkout_id:
                  type: "string"
                  description: "ID du checkout SumUp (optionnel au moment de la cr√©ation)"
                checkout_reference:
                  type: "string"
                  description: "R√©f√©rence du checkout SumUp (optionnel)"
                transaction_status:
                  type: "string"
                  description: "Statut de la transaction SumUp (optionnel)"
                notes:
                  type: "string"
                  description: "Notes libres optionnelles. Si pricing_info est fourni, il sera automatiquement stock√© dans notes au format JSON avec les notes libres."
                pricing_info:
                  type: "object"
                  description: "Informations de tarif au moment de la cr√©ation (sera stock√© dans notes au format JSON). Permet de conserver les informations de tarif pour v√©rification ult√©rieure, notamment pour les membres avec places gratuites."
                  properties:
                    price_id:
                      type:
                        - string
                      format: "uuid"
                      description: "ID du tarif utilis√© (optionnel, peut √™tre null pour les tarifs personnalis√©s)"
                      nullable: true
                    price_name:
                      type:
                        - string
                      description: "Nom du tarif au moment de la cr√©ation (pour r√©f√©rence)"
                      nullable: true
                    price_amount:
                      type: "number"
                      minimum: 0
                      description: "Montant du tarif au moment de la cr√©ation"
                    audience_type:
                      type:
                        - string
                      enum:
                        - public
                        - member
                      description: "Type d'audience"
                      nullable: true
                    requires_proof:
                      type:
                        - boolean
                      description: "Si un justificatif √©tait requis"
                      nullable: true
                    proof_info:
                      type:
                        - object
                      description: "Informations sur le justificatif fourni"
                      properties:
                        type:
                          type:
                            - string
                          description: "Type de justificatif (ex: \"student_card\", \"senior_card\", \"member_card\")"
                          nullable: true
                        reference:
                          type:
                            - string
                          description: "R√©f√©rence du justificatif (num√©ro de carte, etc.)"
                          nullable: true
                        uploaded_at:
                          type:
                            - string
                          format: "date-time"
                          description: "Date d'upload du justificatif (format ISO)"
                          nullable: true
                        verified:
                          type:
                            - boolean
                          description: "Si le justificatif a √©t√© v√©rifi√©"
                          nullable: true
                        verified_by:
                          type:
                            - string
                          description: "ID ou nom de la personne qui a v√©rifi√©"
                          nullable: true
                        verified_at:
                          type:
                            - string
                          format: "date-time"
                          description: "Date de v√©rification (format ISO)"
                          nullable: true
                      nullable: true
                    applied_at:
                      type: "string"
                      format: "date-time"
                      default: "2025-12-03T22:45:11.151Z"
                      description: "Date d'application du tarif (format ISO). G√©n√©r√©e automatiquement si non fournie."
                  required:
                    - price_amount
                language:
                  type: "string"
                  maxLength: 10
                  description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re tous les tickets avec filtres optionnels (email, date, statut, etc.)"
      description: ""
      operationId: "get_museum_tickets"
      parameters:
        - name: "search"
          in: "query"
          description: "Recherche textuelle dans email, first_name, last_name, checkout_id, checkout_reference et qr_code (insensible √† la casse, recherche partielle). Exemple: \"gmail\" trouvera tous les tickets avec un email contenant \"gmail\"."
          required: false
          schema:
            type: "string"
            description: "Recherche textuelle dans email, first_name, last_name, checkout_id, checkout_reference et qr_code (insensible √† la casse, recherche partielle). Exemple: \"gmail\" trouvera tous les tickets avec un email contenant \"gmail\"."
        - name: "reservation_date"
          in: "query"
          description: "Filtrer par date de r√©servation (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "Filtrer par date de r√©servation (format YYYY-MM-DD)"
        - name: "status"
          in: "query"
          description: "Filtrer par statut"
          required: false
          schema:
            type: "string"
            enum:
              - pending
              - paid
              - cancelled
              - used
              - expired
            description: "Filtrer par statut"
        - name: "page"
          in: "query"
          description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
            description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
        - name: "limit"
          in: "query"
          description: "Nombre d'√©l√©ments par page (par d√©faut 500)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 500
            description: "Nombre d'√©l√©ments par page (par d√©faut 500)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  tickets:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        qr_code:
                          type: "string"
                        first_name:
                          type:
                            - string
                          nullable: true
                        last_name:
                          type:
                            - string
                          nullable: true
                        email:
                          type: "string"
                        reservation_date:
                          type: "string"
                        slot_start_time:
                          type: "string"
                        slot_end_time:
                          type: "string"
                        checkout_id:
                          type:
                            - string
                          nullable: true
                        checkout_reference:
                          type:
                            - string
                          nullable: true
                        transaction_status:
                          type:
                            - string
                          nullable: true
                        ticket_price:
                          type: "number"
                        donation_amount:
                          type: "number"
                        total_amount:
                          type: "number"
                        status:
                          type: "string"
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        language:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  total:
                    type: "integer"
                    description: "Nombre total de tickets correspondant aux filtres"
                  page:
                    type: "integer"
                    description: "Page actuelle"
                  limit:
                    type: "integer"
                    description: "Nombre d'√©l√©ments par page"
                  totalPages:
                    type: "integer"
                    description: "Nombre total de pages"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets/:id:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re un ticket par son ID (authentification requise)"
      description: ""
      operationId: "get_museum_tickets_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Tickets
      summary: "Met √† jour un ticket"
      description: ""
      operationId: "put_museum_tickets_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket √† mettre √† jour"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket √† mettre √† jour"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                first_name:
                  type:
                    - string
                  maxLength: 255
                  description: "Pr√©nom du visiteur"
                  nullable: true
                last_name:
                  type:
                    - string
                  maxLength: 255
                  description: "Nom du visiteur"
                  nullable: true
                email:
                  type: "string"
                  format: "email"
                  maxLength: 255
                  description: "Email du visiteur"
                reservation_date:
                  type: "string"
                  format: "date"
                  description: "Date de r√©servation (format YYYY-MM-DD)"
                slot_start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but du cr√©neau horaire (format HH:MM:SS)"
                slot_end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin du cr√©neau horaire (format HH:MM:SS)"
                ticket_price:
                  type: "number"
                  minimum: 0
                  description: "Prix du ticket en euros"
                donation_amount:
                  type: "number"
                  minimum: 0
                  description: "Montant du don optionnel en euros"
                checkout_id:
                  type:
                    - string
                  description: "ID du checkout SumUp"
                  nullable: true
                checkout_reference:
                  type:
                    - string
                  description: "R√©f√©rence du checkout SumUp"
                  nullable: true
                transaction_status:
                  type:
                    - string
                  description: "Statut de la transaction SumUp"
                  nullable: true
                status:
                  type: "string"
                  enum:
                    - pending
                    - paid
                    - cancelled
                    - used
                    - expired
                  description: "Statut du ticket"
                used_at:
                  type:
                    - string
                  format: "date-time"
                  description: "Date/heure d'utilisation du ticket"
                  nullable: true
                notes:
                  type:
                    - string
                  description: "Notes optionnelles"
                  nullable: true
                language:
                  type:
                    - string
                  maxLength: 10
                  description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
                  nullable: true
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Tickets
      summary: "Supprime un ticket"
      description: ""
      operationId: "delete_museum_tickets_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket √† supprimer"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket √† supprimer"
      responses:
        204:
          description: "Code 204"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets/qr/:qrCode:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re un ticket par son code QR (route publique)"
      description: ""
      operationId: "get_museum_tickets_qr_:qrCode"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/tickets/validate:
    post:
      tags:
        - Mus√©e - Tickets
      summary: "Valide/utilise un ticket en scannant son code QR (route publique)"
      description: ""
      operationId: "post_museum_tickets_validate"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - qr_code
              properties:
                qr_code:
                  type: "string"
                  minLength: 8
                  maxLength: 8
                  pattern: "^[A-Z0-9]{8}$"
                  description: "Code QR du ticket √† valider (8 caract√®res alphanum√©riques majuscules)"
      security:
        - cookieAuth:
  /museum/tickets/payment:
    post:
      tags:
        - Mus√©e - Tickets
      summary: "Cr√©e plusieurs tickets avec paiement SumUp. Cr√©e d'abord un checkout SumUp avec le montant total (somme de tous les ticket_price + donation_amount), puis enregistre tous les tickets avec le checkout_id et le statut pending (route publique)"
      description: ""
      operationId: "post_museum_tickets_payment"
      parameters:
      responses:
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  checkout_id:
                    type:
                      - string
                    description: "ID du checkout SumUp (null si la commande est gratuite)"
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    description: "R√©f√©rence du checkout SumUp (null si la commande est gratuite)"
                    nullable: true
                  tickets:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        qr_code:
                          type: "string"
                        first_name:
                          type:
                            - string
                          nullable: true
                        last_name:
                          type:
                            - string
                          nullable: true
                        email:
                          type: "string"
                        reservation_date:
                          type: "string"
                        slot_start_time:
                          type: "string"
                        slot_end_time:
                          type: "string"
                        checkout_id:
                          type:
                            - string
                          nullable: true
                        checkout_reference:
                          type:
                            - string
                          nullable: true
                        transaction_status:
                          type:
                            - string
                          nullable: true
                        ticket_price:
                          type: "number"
                        donation_amount:
                          type: "number"
                        total_amount:
                          type: "number"
                        status:
                          type: "string"
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        language:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                    description: "Liste des tickets cr√©√©s"
                required:
                  - tickets
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - email
                - tickets
              properties:
                email:
                  type: "string"
                  format: "email"
                  maxLength: 255
                  description: "Email commun pour tous les tickets (obligatoire)"
                first_name:
                  type: "string"
                  maxLength: 255
                  description: "Pr√©nom commun pour tous les tickets (optionnel)"
                last_name:
                  type: "string"
                  maxLength: 255
                  description: "Nom commun pour tous les tickets (optionnel)"
                language:
                  type: "string"
                  maxLength: 10
                  description: "Code de langue commun pour tous les tickets (ex: \"fr\", \"en\", \"es\")"
                tickets:
                  type: "array"
                  minItems: 1
                  items:
                    type: "object"
                    required:
                      - reservation_date
                      - slot_start_time
                      - slot_end_time
                      - ticket_price
                    properties:
                      reservation_date:
                        type: "string"
                        format: "date"
                        description: "Date de r√©servation (format YYYY-MM-DD)"
                      slot_start_time:
                        type: "string"
                        pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                        description: "Heure de d√©but du cr√©neau horaire (format HH:MM:SS)"
                      slot_end_time:
                        type: "string"
                        pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                        description: "Heure de fin du cr√©neau horaire (format HH:MM:SS)"
                      ticket_price:
                        type: "number"
                        minimum: 0
                        description: "Prix du ticket en euros"
                      donation_amount:
                        type: "number"
                        minimum: 0
                        default: 0
                        description: "Montant du don optionnel en euros (0 par d√©faut)"
                      notes:
                        type: "string"
                        description: "Notes libres optionnelles pour ce ticket. Si pricing_info est fourni, il sera automatiquement stock√© dans notes au format JSON avec les notes libres."
                      pricing_info:
                        type: "object"
                        description: "Informations de tarif au moment de la cr√©ation pour ce ticket (sera stock√© dans notes au format JSON). Permet de conserver les informations de tarif pour v√©rification ult√©rieure, notamment pour les membres avec places gratuites."
                        properties:
                          price_id:
                            type:
                              - string
                            format: "uuid"
                            description: "ID du tarif utilis√© (optionnel, peut √™tre null pour les tarifs personnalis√©s)"
                            nullable: true
                          price_name:
                            type:
                              - string
                            description: "Nom du tarif au moment de la cr√©ation (pour r√©f√©rence)"
                            nullable: true
                          price_amount:
                            type: "number"
                            minimum: 0
                            description: "Montant du tarif au moment de la cr√©ation"
                          audience_type:
                            type:
                              - string
                            enum:
                              - public
                              - member
                            description: "Type d'audience"
                            nullable: true
                          requires_proof:
                            type:
                              - boolean
                            description: "Si un justificatif √©tait requis"
                            nullable: true
                          proof_info:
                            type:
                              - object
                            description: "Informations sur le justificatif fourni"
                            properties:
                              type:
                                type:
                                  - string
                                description: "Type de justificatif (ex: \"student_card\", \"senior_card\", \"member_card\")"
                                nullable: true
                              reference:
                                type:
                                  - string
                                description: "R√©f√©rence du justificatif (num√©ro de carte, etc.)"
                                nullable: true
                              uploaded_at:
                                type:
                                  - string
                                format: "date-time"
                                description: "Date d'upload du justificatif (format ISO)"
                                nullable: true
                              verified:
                                type:
                                  - boolean
                                description: "Si le justificatif a √©t√© v√©rifi√©"
                                nullable: true
                              verified_by:
                                type:
                                  - string
                                description: "ID ou nom de la personne qui a v√©rifi√©"
                                nullable: true
                              verified_at:
                                type:
                                  - string
                                format: "date-time"
                                description: "Date de v√©rification (format ISO)"
                                nullable: true
                            nullable: true
                          applied_at:
                            type: "string"
                            format: "date-time"
                            description: "Date d'application du tarif (format ISO). G√©n√©r√©e automatiquement si non fournie."
                        required:
                          - price_amount
                          - applied_at
                  description: "Liste des tickets √† cr√©er (au moins 1 ticket requis)"
                gift_codes:
                  type: "array"
                  items:
                    type: "string"
                    pattern: "^[A-Z0-9]{12}$"
                    description: "Code cadeau (12 caract√®res alphanum√©riques majuscules)"
                  description: "Tableau de codes cadeaux √† utiliser (optionnel). Chaque code offre une place gratuite, appliqu√©e aux tickets les plus chers en premier."
                currency:
                  type: "string"
                  default: "EUR"
                  description: "Devise pour le paiement (d√©faut: EUR)"
                description:
                  type: "string"
                  description: "Description du paiement (optionnel)"
  /museum/tickets/checkout/:checkoutId:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re tous les tickets associ√©s √† un checkout_id donn√© (route publique)"
      description: ""
      operationId: "get_museum_tickets_checkout_:checkoutId"
      parameters:
        - name: "checkoutId"
          in: "path"
          description: "ID du checkout SumUp"
          required: true
          schema:
            type: "string"
            description: "ID du checkout SumUp"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    qr_code:
                      type: "string"
                    first_name:
                      type:
                        - string
                      nullable: true
                    last_name:
                      type:
                        - string
                      nullable: true
                    email:
                      type: "string"
                    reservation_date:
                      type: "string"
                    slot_start_time:
                      type: "string"
                    slot_end_time:
                      type: "string"
                    checkout_id:
                      type:
                        - string
                      nullable: true
                    checkout_reference:
                      type:
                        - string
                      nullable: true
                    transaction_status:
                      type:
                        - string
                      nullable: true
                    ticket_price:
                      type: "number"
                    donation_amount:
                      type: "number"
                    total_amount:
                      type: "number"
                    status:
                      type: "string"
                    used_at:
                      type:
                        - string
                      nullable: true
                    notes:
                      type:
                        - string
                      nullable: true
                    language:
                      type:
                        - string
                      nullable: true
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/tickets/stats:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re les statistiques des tickets : nombre total vendus, nombre de la semaine avec r√©partition par jour, montants total, semaine et mois (route publique)"
      description: ""
      operationId: "get_museum_tickets_stats"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  tickets_stats:
                    type: "object"
                    properties:
                      total_tickets_sold:
                        type: "number"
                        description: "Nombre total de tickets vendus (status = paid)"
                      week_tickets_sold:
                        type: "number"
                        description: "Nombre de tickets vendus cette semaine"
                      week_tickets_by_day:
                        type: "array"
                        items:
                          type: "object"
                          properties:
                            date:
                              type: "string"
                              description: "Date au format YYYY-MM-DD"
                            day_name:
                              type: "string"
                              description: "Nom du jour (lundi, mardi, etc.)"
                            tickets_count:
                              type: "number"
                              description: "Nombre de tickets vendus ce jour"
                            amount:
                              type: "number"
                              description: "Montant total des tickets vendus ce jour"
                          required:
                            - date
                            - day_name
                            - tickets_count
                            - amount
                        description: "R√©partition des tickets vendus par jour de la semaine"
                      total_amount:
                        type: "number"
                        description: "Montant total de tous les tickets vendus"
                      week_amount:
                        type: "number"
                        description: "Montant total des tickets vendus cette semaine"
                      month_amount:
                        type: "number"
                        description: "Montant total des tickets vendus ce mois"
                    required:
                      - total_tickets_sold
                      - week_tickets_sold
                      - week_tickets_by_day
                      - total_amount
                      - week_amount
                      - month_amount
                required:
                  - tickets_stats
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/slots:
    get:
      tags:
        - Mus√©e - Cr√©neaux
      summary: "R√©cup√®re les cr√©neaux horaires disponibles pour une date donn√©e avec leurs capacit√©s et taux d'occupation (route publique)"
      description: ""
      operationId: "get_museum_slots"
      parameters:
        - name: "date"
          in: "query"
          description: "Date au format YYYY-MM-DD (ex: 2025-12-23)"
          required: true
          schema:
            type: "string"
            pattern: "^\d{4}-\d{2}-\d{2}$"
            description: "Date au format YYYY-MM-DD (ex: 2025-12-23)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  date:
                    type: "string"
                    description: "Date au format YYYY-MM-DD"
                  slots:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        start_time:
                          type: "string"
                          description: "Heure de d√©but du cr√©neau (HH:MM:SS)"
                        end_time:
                          type: "string"
                          description: "Heure de fin du cr√©neau (HH:MM:SS)"
                        capacity:
                          type: "number"
                          description: "Capacit√© maximale du cr√©neau"
                        booked:
                          type: "number"
                          description: "Nombre de tickets r√©serv√©s pour ce cr√©neau"
                        available:
                          type: "number"
                          description: "Nombre de places disponibles"
                        occupancy_percentage:
                          type: "number"
                          description: "Pourcentage d'occupation (0-100)"
                      required:
                        - start_time
                        - end_time
                        - capacity
                        - booked
                        - available
                        - occupancy_percentage
                  total_capacity:
                    type: "number"
                    description: "Capacit√© totale de la journ√©e"
                  total_booked:
                    type: "number"
                    description: "Nombre total de tickets r√©serv√©s"
                  total_available:
                    type: "number"
                    description: "Nombre total de places disponibles"
                required:
                  - date
                  - slots
                  - total_capacity
                  - total_booked
                  - total_available
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/donation-proof/generate:
    get:
      tags:
        - Mus√©e - Certificats de don
      summary: "G√©n√®re et t√©l√©charge un certificat de don CERFA 11580 en PDF pour un ticket donn√©. Le ticket doit contenir un don (donation_amount > 0). Les param√®tres address, postal_code et city sont optionnels et permettent de compl√©ter les informations du donateur."
      description: ""
      operationId: "get_museum_donation-proof_generate"
      parameters:
        - name: "ticket_id"
          in: "query"
          description: "ID du ticket pour lequel g√©n√©rer le certificat de don"
          required: true
          schema:
            type: "string"
            description: "ID du ticket pour lequel g√©n√©rer le certificat de don"
        - name: "address"
          in: "query"
          description: "Adresse du donateur (optionnel)"
          required: false
          schema:
            type: "string"
            description: "Adresse du donateur (optionnel)"
        - name: "postal_code"
          in: "query"
          description: "Code postal du donateur (optionnel)"
          required: false
          schema:
            type: "string"
            description: "Code postal du donateur (optionnel)"
        - name: "city"
          in: "query"
          description: "Ville du donateur (optionnel)"
          required: false
          schema:
            type: "string"
            description: "Ville du donateur (optionnel)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                description: "PDF du certificat de don"
                content:
                  application/pdf:
                    schema:
                      type: "string"
                      format: "binary"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/gift-codes/packs:
    post:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Cr√©e un pack de codes cadeaux. Chaque code offre une place gratuite. Les codes peuvent √™tre cr√©√©s en lot pour faciliter la distribution (ex: pour un influenceur)."
      description: ""
      operationId: "post_museum_gift-codes_packs"
      parameters:
      responses:
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  pack_id:
                    type: "string"
                  codes:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        code:
                          type: "string"
                        status:
                          type: "string"
                          enum:
                            - unused
                            - used
                            - expired
                        ticket_id:
                          type:
                            - string
                          nullable: true
                        pack_id:
                          type:
                            - string
                          nullable: true
                        recipient_email:
                          type:
                            - string
                          nullable: true
                        expires_at:
                          type:
                            - string
                          nullable: true
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  quantity:
                    type: "integer"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - quantity
              properties:
                quantity:
                  type: "integer"
                  minimum: 1
                  maximum: 1000
                  description: "Nombre de codes cadeaux √† cr√©er"
                pack_name:
                  type: "string"
                  maxLength: 255
                  description: "Nom du pack (optionnel)"
                expires_at:
                  type: "string"
                  format: "date-time"
                  description: "Date d'expiration des codes (optionnelle, format ISO)"
                notes:
                  type: "string"
                  description: "Notes optionnelles pour le pack"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "R√©cup√®re la liste pagin√©e des packs de codes cadeaux avec leurs codes associ√©s. Permet de rechercher un pack par code (param√®tre `code`). Retourne les statistiques de chaque pack (nombre de codes, utilis√©s, non utilis√©s, expir√©s)."
      description: ""
      operationId: "get_museum_gift-codes_packs"
      parameters:
        - name: "code"
          in: "query"
          description: "Rechercher un code sp√©cifique (retourne le pack qui le contient)"
          required: false
          schema:
            type: "string"
            pattern: "^[A-Z0-9]{12}$"
            description: "Rechercher un code sp√©cifique (retourne le pack qui le contient)"
        - name: "page"
          in: "query"
          description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
            description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
        - name: "limit"
          in: "query"
          description: "Nombre d'√©l√©ments par page (par d√©faut 50)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 50
            description: "Nombre d'√©l√©ments par page (par d√©faut 50)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  packs:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        pack_id:
                          type: "string"
                        codes:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              id:
                                type: "string"
                              code:
                                type: "string"
                              status:
                                type: "string"
                                enum:
                                  - unused
                                  - used
                                  - expired
                              ticket_id:
                                type:
                                  - string
                                nullable: true
                              pack_id:
                                type:
                                  - string
                                nullable: true
                              recipient_email:
                                type:
                                  - string
                                nullable: true
                              expires_at:
                                type:
                                  - string
                                nullable: true
                              used_at:
                                type:
                                  - string
                                nullable: true
                              notes:
                                type:
                                  - string
                                nullable: true
                              created_at:
                                type: "string"
                              updated_at:
                                type: "string"
                        codes_count:
                          type: "integer"
                        unused_count:
                          type: "integer"
                        used_count:
                          type: "integer"
                        expired_count:
                          type: "integer"
                        created_at:
                          type: "string"
                  total:
                    type: "integer"
                  page:
                    type: "integer"
                  limit:
                    type: "integer"
                  totalPages:
                    type: "integer"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/gift-codes/distribute:
    post:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Distribue des codes cadeaux par email. Permet d'envoyer un lot de codes √† un destinataire (ex: influenceur). Les codes sont associ√©s √† l'email du destinataire."
      description: ""
      operationId: "post_museum_gift-codes_distribute"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  message:
                    type: "string"
                  codes_sent:
                    type: "integer"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - code_ids
                - recipient_email
              properties:
                code_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  minItems: 1
                  description: "IDs des codes cadeaux √† distribuer"
                recipient_email:
                  type: "string"
                  format: "email"
                  description: "Email du destinataire"
                subject:
                  type: "string"
                  description: "Sujet de l'email (optionnel)"
                message:
                  type: "string"
                  description: "Message personnalis√© (optionnel)"
                language:
                  type: "string"
                  enum:
                    - fr
                    - en
                  default: "fr"
                  description: "Langue de l'email"
      security:
        - cookieAuth:
  /museum/gift-codes:
    get:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "R√©cup√®re la liste des codes cadeaux avec pagination et filtres optionnels (statut, pack, destinataire, ticket associ√©)."
      description: ""
      operationId: "get_museum_gift-codes"
      parameters:
        - name: "status"
          in: "query"
          description: "Filtrer par statut"
          required: false
          schema:
            type: "string"
            enum:
              - unused
              - used
              - expired
            description: "Filtrer par statut"
        - name: "pack_id"
          in: "query"
          description: "Filtrer par pack"
          required: false
          schema:
            type: "string"
            format: "uuid"
            description: "Filtrer par pack"
        - name: "recipient_email"
          in: "query"
          description: "Filtrer par destinataire"
          required: false
          schema:
            type: "string"
            format: "email"
            description: "Filtrer par destinataire"
        - name: "ticket_id"
          in: "query"
          description: "Filtrer par ticket"
          required: false
          schema:
            type: "string"
            format: "uuid"
            description: "Filtrer par ticket"
        - name: "page"
          in: "query"
          description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
            description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
        - name: "limit"
          in: "query"
          description: "Nombre d'√©l√©ments par page (par d√©faut 100)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 100
            description: "Nombre d'√©l√©ments par page (par d√©faut 100)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  codes:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        code:
                          type: "string"
                        status:
                          type: "string"
                          enum:
                            - unused
                            - used
                            - expired
                        ticket_id:
                          type:
                            - string
                          nullable: true
                        pack_id:
                          type:
                            - string
                          nullable: true
                        recipient_email:
                          type:
                            - string
                          nullable: true
                        expires_at:
                          type:
                            - string
                          nullable: true
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  total:
                    type: "integer"
                  page:
                    type: "integer"
                  limit:
                    type: "integer"
                  totalPages:
                    type: "integer"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/gift-codes/validate/:code:
    get:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Valide un code cadeau (route publique). V√©rifie que le code existe, n'est pas utilis√© et n'est pas expir√©. Permet au frontend de valider un code avant de l'utiliser dans une commande."
      description: ""
      operationId: "get_museum_gift-codes_validate_:code"
      parameters:
        - name: "code"
          in: "path"
          description: "Code cadeau √† valider (12 caract√®res alphanum√©riques majuscules)"
          required: true
          schema:
            type: "string"
            pattern: "^[A-Z0-9]{12}$"
            description: "Code cadeau √† valider (12 caract√®res alphanum√©riques majuscules)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  code:
                    type: "string"
                  status:
                    type: "string"
                    enum:
                      - unused
                      - used
                      - expired
                  ticket_id:
                    type:
                      - string
                    nullable: true
                  pack_id:
                    type:
                      - string
                    nullable: true
                  recipient_email:
                    type:
                      - string
                    nullable: true
                  expires_at:
                    type:
                      - string
                    nullable: true
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/special-periods:
    post:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "Cr√©e une p√©riode sp√©ciale (vacances scolaires ou fermeture). Les p√©riodes de vacances permettent d'afficher automatiquement les horaires avec audience_type=\"holiday\" en plus des horaires publics. Les p√©riodes de fermeture masquent les horaires normaux."
      description: ""
      operationId: "post_museum_special-periods"
      parameters:
      responses:
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                    enum:
                      - holiday
                      - closure
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  name:
                    type:
                      - string
                    nullable: true
                  description:
                    type:
                      - string
                    nullable: true
                  zone:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - type
                - start_date
                - end_date
              properties:
                type:
                  type: "string"
                  enum:
                    - holiday
                    - closure
                  description: "Type de p√©riode : holiday (vacances) ou closure (fermeture)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin (format YYYY-MM-DD)"
                name:
                  type: "string"
                  maxLength: 255
                  description: "Nom de la p√©riode (ex: \"Vacances de No√´l 2024\")"
                description:
                  type: "string"
                  description: "Description optionnelle"
                zone:
                  type: "string"
                  maxLength: 50
                  description: "Zone pour les vacances scolaires (ex: \"A\", \"B\", \"C\", \"all\"). Null pour les fermetures."
                is_active:
                  type: "boolean"
                  default: true
                  description: "Indique si la p√©riode est active"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "R√©cup√®re la liste des p√©riodes sp√©ciales (vacances et fermetures) avec filtres optionnels (type, date, zone). Permet de v√©rifier si une date est dans une p√©riode sp√©ciale."
      description: ""
      operationId: "get_museum_special-periods"
      parameters:
        - name: "type"
          in: "query"
          description: "Filtrer par type"
          required: false
          schema:
            type: "string"
            enum:
              - holiday
              - closure
            description: "Filtrer par type"
        - name: "date"
          in: "query"
          description: "V√©rifier si une date est dans une p√©riode sp√©ciale (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "V√©rifier si une date est dans une p√©riode sp√©ciale (format YYYY-MM-DD)"
        - name: "zone"
          in: "query"
          description: "Filtrer par zone (pour les vacances scolaires)"
          required: false
          schema:
            type: "string"
            description: "Filtrer par zone (pour les vacances scolaires)"
        - name: "is_active"
          in: "query"
          description: "Filtrer par statut actif"
          required: false
          schema:
            type: "boolean"
            description: "Filtrer par statut actif"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    type:
                      type: "string"
                      enum:
                        - holiday
                        - closure
                    start_date:
                      type: "string"
                    end_date:
                      type: "string"
                    name:
                      type:
                        - string
                      nullable: true
                    description:
                      type:
                        - string
                      nullable: true
                    zone:
                      type:
                        - string
                      nullable: true
                    is_active:
                      type: "boolean"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/special-periods/:id:
    get:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "R√©cup√®re une p√©riode sp√©ciale par son ID."
      description: ""
      operationId: "get_museum_special-periods_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de la p√©riode sp√©ciale"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de la p√©riode sp√©ciale"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                    enum:
                      - holiday
                      - closure
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  name:
                    type:
                      - string
                    nullable: true
                  description:
                    type:
                      - string
                    nullable: true
                  zone:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "Met √† jour une p√©riode sp√©ciale (vacances ou fermeture)."
      description: ""
      operationId: "put_museum_special-periods_:id"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                    enum:
                      - holiday
                      - closure
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  name:
                    type:
                      - string
                    nullable: true
                  description:
                    type:
                      - string
                    nullable: true
                  zone:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                type:
                  type: "string"
                  enum:
                    - holiday
                    - closure
                  description: "Type de p√©riode : holiday (vacances) ou closure (fermeture)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin (format YYYY-MM-DD)"
                name:
                  type:
                    - string
                  maxLength: 255
                  description: "Nom de la p√©riode"
                  nullable: true
                description:
                  type:
                    - string
                  description: "Description optionnelle"
                  nullable: true
                zone:
                  type:
                    - string
                  maxLength: 50
                  description: "Zone pour les vacances scolaires"
                  nullable: true
                is_active:
                  type: "boolean"
                  description: "Indique si la p√©riode est active"
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "Supprime une p√©riode sp√©ciale."
      description: ""
      operationId: "delete_museum_special-periods_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de la p√©riode sp√©ciale"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de la p√©riode sp√©ciale"
      responses:
        204:
          description: "Code 204"
          content:
            application/json:
              schema:
                type: "null"
                description: "P√©riode sp√©ciale supprim√©e avec succ√®s"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
components:
  securitySchemes:
    cookieAuth:
      type: "apiKey"
      in: "cookie"
      name: "discord_access_token"
      description: "Token d'acc√®s Discord stock√© dans un cookie HTTP-only"
