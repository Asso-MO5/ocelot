openapi: "3.1.0"
info:
  title: "Ocelot API - Museum Back End"
  description: "API backend Fastify avec authentification Discord OAuth2.

Cette documentation est g√©n√©r√©e √† partir des sc√©narios Gherkin/Cucumber et des sch√©mas Fastify."
  version: "1.0.0"
  contact:
    name: "API Support"
servers:
  - url: "http://localhost:3000"
    description: "Serveur de d√©veloppement"
tags:
  - name: "Authentification"
    description: "Endpoints d'authentification Discord OAuth2"
  - name: "Paiement"
    description: "Endpoints de paiement"
  - name: "Mus√©e - Horaires"
    description: "Endpoints de gestion des horaires d'ouverture"
  - name: "Mus√©e - Tarifs"
    description: "Endpoints de gestion des tarifs"
  - name: "Mus√©e - Param√®tres"
    description: "Endpoints de gestion des param√®tres du mus√©e"
  - name: "Mus√©e - Capacit√©"
    description: "Endpoints de gestion de la capacit√© et des visiteurs"
  - name: "Mus√©e - Tickets"
    description: "Endpoints de gestion des tickets et r√©servations"
  - name: "Mus√©e - Cr√©neaux"
    description: "Endpoints de gestion des cr√©neaux horaires et disponibilit√©s"
  - name: "Mus√©e - P√©riodes sp√©ciales"
    description: "Endpoints de gestion des p√©riodes sp√©ciales (vacances, fermetures)"
  - name: "√âv√©nements"
    description: "Endpoints de gestion des √©v√©nements (mus√©e, association, externes)"
  - name: "Mus√©e - Calendrier"
    description: "Endpoint de r√©cup√©ration du calendrier avec √©v√©nements et horaires"
  - name: "Pr√©sences membres"
    description: "Endpoints de gestion des pr√©sences des membres du staff au mus√©e"
paths:
  /auth/signin:
    get:
      tags:
        - Authentification
      summary: "Redirige vers Discord OAuth2 pour l'authentification"
      description: "**Redirection vers Discord pour l'authentification** : je devrais √™tre redirig√© vers Discord OAuth2 l'URL de redirection devrait contenir le client_id l'URL de redirection devrait contenir le redirect_uri l'URL de redirection devrait contenir les scopes demand√©s

**Erreur si DISCORD_CLIENT_ID n'est pas configur√©** : je devrais recevoir une erreur 500 le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configur√©\"

**Utilisation de scopes personnalis√©s** : l'URL de redirection Discord devrait contenir les scopes personnalis√©s

**Configuration de l'URI de redirection personnalis√©e** : l'URL de redirection Discord devrait utiliser l'URI personnalis√©e

### Sc√©narios de test

**Redirection vers Discord pour l'authentification**

üìã que je suis un utilisateur non authentifi√©

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ je devrais √™tre redirig√© vers Discord OAuth2

‚úÖ l'URL de redirection devrait contenir le client_id

‚úÖ l'URL de redirection devrait contenir le redirect_uri

‚úÖ l'URL de redirection devrait contenir les scopes demand√©s

**Erreur si DISCORD_CLIENT_ID n'est pas configur√©**

üìã que DISCORD_CLIENT_ID n'est pas d√©fini

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ je devrais recevoir une erreur 500

‚úÖ le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configur√©\"

**Utilisation de scopes personnalis√©s**

üìã que DISCORD_SCOPES est configur√© avec \"identify email guilds\"

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ l'URL de redirection Discord devrait contenir les scopes personnalis√©s

**Configuration de l'URI de redirection personnalis√©e**

üìã que DISCORD_REDIRECT_URI est configur√©

‚ö° je fais une requ√™te GET vers \"/auth/signin\"

‚úÖ l'URL de redirection Discord devrait utiliser l'URI personnalis√©e

"
      operationId: "get_auth_signin"
      parameters:
      responses:
        302:
          description: "Redirection"
          content: null
          headers:
            Location:
              schema:
                type: "string"
              description: "URL de redirection"
        500:
          description: "Erreur serveur - je devrais recevoir une erreur 500, le message d'erreur devrait indiquer \"DISCORD_CLIENT_ID non configur√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example:
                error: "exemple_error"
          headers: null
  /auth/login:
    get:
      tags:
        - Authentification
      summary: "Alias de /auth/signin - Redirige vers Discord OAuth2"
      description: ""
      operationId: "get_auth_login"
      parameters:
      responses:
        302:
          description: "Redirection"
          content: null
          headers:
            Location:
              schema:
                type: "string"
              description: "URL de redirection"
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example: null
          headers: null
  /auth/callback:
    get:
      tags:
        - Authentification
      summary: "Callback OAuth2 de Discord - √âchange le code d'autorisation contre des tokens"
      description: "**Callback OAuth2 sans code** : je devrais √™tre redirig√© vers le frontend avec error=missing_code

### Sc√©narios de test

**Callback OAuth2 sans code**

üìã que Discord n'a pas retourn√© de code

‚ö° je fais une requ√™te GET vers \"/auth/callback\"

‚úÖ je devrais √™tre redirig√© vers le frontend avec error=missing_code

"
      operationId: "get_auth_callback"
      parameters:
        - name: "code"
          in: "query"
          description: "Code d'autorisation retourn√© par Discord"
          required: false
          schema:
            type: "string"
            description: "Code d'autorisation retourn√© par Discord"
        - name: "error"
          in: "query"
          description: "Code d'erreur retourn√© par Discord"
          required: false
          schema:
            type: "string"
            description: "Code d'erreur retourn√© par Discord"
        - name: "state"
          in: "query"
          description: "√âtat pass√© lors de la requ√™te initiale"
          required: false
          schema:
            type: "string"
            description: "√âtat pass√© lors de la requ√™te initiale"
      responses:
  /auth/me:
    get:
      tags:
        - Authentification
      summary: "R√©cup√®re les informations de l'utilisateur authentifi√© (g√®re automatiquement le refresh du token)"
      description: "**R√©cup√©ration des donn√©es utilisateur - token valide** : je devrais recevoir mes informations utilisateur la r√©ponse devrait contenir id, username, discriminator, avatar la r√©ponse devrait contenir email si le scope email est accord√© la r√©ponse devrait contenir roles l'utilisateur devrait √™tre sauvegard√© en base de donn√©es

**R√©cup√©ration des donn√©es utilisateur - token expir√© avec refresh automatique** : que j'ai un refresh_token valide le refresh_token devrait √™tre utilis√© pour obtenir un nouveau access_token les nouveaux tokens devraient √™tre stock√©s dans les cookies je devrais recevoir mes informations utilisateur

**R√©cup√©ration des donn√©es utilisateur - token expir√© sans refresh token** : que je n'ai pas de refresh_token je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Non authentifi√©\"

**R√©cup√©ration des donn√©es utilisateur - refresh token invalide** : que mon refresh_token est invalide je devrais recevoir une erreur 401 les cookies devraient √™tre supprim√©s le message d'erreur devrait indiquer \"Non authentifi√©\"

**R√©cup√©ration des donn√©es utilisateur - non authentifi√©** : je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Non authentifi√©\"

**R√©cup√©ration des donn√©es utilisateur - erreur serveur** : qu'une erreur se produit lors de la r√©cup√©ration des donn√©es je devrais recevoir une erreur 500 le message d'erreur devrait indiquer \"Erreur serveur\"

### Sc√©narios de test

**R√©cup√©ration des donn√©es utilisateur - token valide**

üìã que j'ai un access_token valide

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir mes informations utilisateur

‚úÖ la r√©ponse devrait contenir id, username, discriminator, avatar

‚úÖ la r√©ponse devrait contenir email si le scope email est accord√©

‚úÖ la r√©ponse devrait contenir roles

‚úÖ l'utilisateur devrait √™tre sauvegard√© en base de donn√©es

**R√©cup√©ration des donn√©es utilisateur - token expir√© avec refresh automatique**

üìã que mon access_token est expir√©

‚úÖ que j'ai un refresh_token valide

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ le refresh_token devrait √™tre utilis√© pour obtenir un nouveau access_token

‚úÖ les nouveaux tokens devraient √™tre stock√©s dans les cookies

‚úÖ je devrais recevoir mes informations utilisateur

**R√©cup√©ration des donn√©es utilisateur - token expir√© sans refresh token**

üìã que mon access_token est expir√©

‚úÖ que je n'ai pas de refresh_token

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ le message d'erreur devrait indiquer \"Non authentifi√©\"

**R√©cup√©ration des donn√©es utilisateur - refresh token invalide**

üìã que mon access_token est expir√©

‚úÖ que mon refresh_token est invalide

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ les cookies devraient √™tre supprim√©s

‚úÖ le message d'erreur devrait indiquer \"Non authentifi√©\"

**R√©cup√©ration des donn√©es utilisateur - non authentifi√©**

üìã que je n'ai pas de token d'acc√®s

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ le message d'erreur devrait indiquer \"Non authentifi√©\"

**R√©cup√©ration des donn√©es utilisateur - erreur serveur**

üìã que j'ai un access_token valide

‚úÖ qu'une erreur se produit lors de la r√©cup√©ration des donn√©es

‚ö° je fais une requ√™te GET vers \"/auth/me\"

‚úÖ je devrais recevoir une erreur 500

‚úÖ le message d'erreur devrait indiquer \"Erreur serveur\"

"
      operationId: "get_auth_me"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                    description: "ID unique de l'utilisateur Discord"
                  username:
                    type: "string"
                    description: "Nom d'utilisateur"
                  discriminator:
                    type: "string"
                    description: "Discriminator (4 chiffres)"
                  avatar:
                    type:
                      - string
                    description: "Hash de l'avatar ou null"
                    nullable: true
                  email:
                    type: "string"
                    description: "Email de l'utilisateur (si le scope email est accord√©)"
                  roles:
                    type: "array"
                    description: "R√¥les de l'utilisateur"
                    items:
                      type: "string"
                      description: "Nom du r√¥le"
                required:
                  - id
                  - username
                  - discriminator
                  - avatar
                  - roles
              example: null
          headers: null
        401:
          description: "Non authentifi√© - que je n'ai pas de refresh_token, je devrais recevoir une erreur 401, le message d'erreur devrait indiquer \"Non authentifi√©\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur - qu'une erreur se produit lors de la r√©cup√©ration des donn√©es, je devrais recevoir une erreur 500, le message d'erreur devrait indiquer \"Erreur serveur\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
                    description: "Message d'erreur"
                required:
                  - error
              example:
                error: "exemple_error"
          headers: null
      security:
        - cookieAuth:
  /auth/signout:
    get:
      tags:
        - Authentification
      summary: "D√©connecte l'utilisateur en supprimant les cookies de session (discord_access_token et discord_refresh_token)"
      description: "**D√©connexion de l'utilisateur** : que j'ai des cookies de session (discord_access_token et discord_refresh_token) les cookies discord_access_token et discord_refresh_token devraient √™tre supprim√©s je devrais recevoir une r√©ponse avec success=true

### Sc√©narios de test

**D√©connexion de l'utilisateur**

üìã que je suis authentifi√©

‚úÖ que j'ai des cookies de session (discord_access_token et discord_refresh_token)

‚ö° je fais une requ√™te GET vers \"/auth/signout\"

‚úÖ les cookies discord_access_token et discord_refresh_token devraient √™tre supprim√©s

‚úÖ je devrais recevoir une r√©ponse avec success=true

"
      operationId: "get_auth_signout"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  success:
                    type: "boolean"
                    description: "Indique si la d√©connexion a r√©ussi"
                required:
                  - success
              example: null
          headers: null
  /pay/checkout/:sessionId:
    get:
      tags:
        - Paiement
      summary: "V√©rifie le statut d'une session de checkout. Retourne le statut de paiement et les informations de la session (route publique)"
      description: ""
      operationId: "get_pay_checkout_:sessionId"
      parameters:
        - name: "sessionId"
          in: "path"
          description: "ID de la session de checkout"
          required: true
          schema:
            type: "string"
            description: "ID de la session de checkout"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  amount_total:
                    type: "number"
                  currency:
                    type: "string"
                  status:
                    type: "string"
                    enum:
                      - open
                      - complete
                      - expired
                  payment_status:
                    type: "string"
                    enum:
                      - paid
                      - unpaid
                      - no_payment_required
                  payment_intent:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /pay/webhook:
    post:
      tags:
        - Paiement
      summary: "Endpoint webhook pour recevoir les notifications de paiement. Met √† jour automatiquement les tickets associ√©s au session_id selon le statut du paiement (route publique)"
      description: "**R√©ception d'un webhook checkout.session.completed** : je re√ßois une r√©ponse 200 les tickets associ√©s sont mis √† jour avec le statut de paiement les emails de confirmation sont envoy√©s si le paiement est r√©ussi les certificats de don sont envoy√©s si des dons sont pr√©sents

**R√©ception d'un webhook payment_intent.succeeded** : je re√ßois une r√©ponse 200 les tickets associ√©s sont mis √† jour avec le statut PAID

**R√©ception d'un webhook payment_intent.payment_failed** : je re√ßois une r√©ponse 200 les tickets associ√©s sont mis √† jour avec le statut FAILED

**R√©ception d'un webhook checkout.session.expired** : je re√ßois une r√©ponse 200 les tickets associ√©s sont mis √† jour avec le statut CANCELLED

**Erreur si la signature du webhook est invalide (production)** : qu'un webhook avec une signature invalide est re√ßu je re√ßois une erreur 400 le message d'erreur indique \"Signature invalide\"

**Webhook accept√© avec signature invalide en d√©veloppement** : qu'un webhook avec une signature invalide est re√ßu je re√ßois une r√©ponse 200 le webhook est trait√© malgr√© la signature invalide

**Erreur si la signature est manquante** : je re√ßois une erreur 400 le message d'erreur indique \"Signature manquante\"

**Erreur si le raw body n'est pas disponible** : je re√ßois une erreur 500 le message d'erreur indique \"Raw body non disponible\"

**Mise √† jour des informations client depuis customer_details** : que la session contient customer_details avec email, first_name, last_name les tickets associ√©s sont mis √† jour avec les informations client

**Traitement d'un √©v√©nement non g√©r√©** : je re√ßois une r√©ponse 200 la r√©ponse indique success: true avec tickets_updated: 0

### Sc√©narios de test

**R√©ception d'un webhook checkout.session.completed**

üìã qu'un webhook Stripe est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\" avec un √©v√©nement checkout.session.completed

‚úÖ je re√ßois une r√©ponse 200

‚úÖ les tickets associ√©s sont mis √† jour avec le statut de paiement

‚úÖ les emails de confirmation sont envoy√©s si le paiement est r√©ussi

‚úÖ les certificats de don sont envoy√©s si des dons sont pr√©sents

**R√©ception d'un webhook payment_intent.succeeded**

üìã qu'un webhook Stripe est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\" avec un √©v√©nement payment_intent.succeeded

‚úÖ je re√ßois une r√©ponse 200

‚úÖ les tickets associ√©s sont mis √† jour avec le statut PAID

**R√©ception d'un webhook payment_intent.payment_failed**

üìã qu'un webhook Stripe est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\" avec un √©v√©nement payment_intent.payment_failed

‚úÖ je re√ßois une r√©ponse 200

‚úÖ les tickets associ√©s sont mis √† jour avec le statut FAILED

**R√©ception d'un webhook checkout.session.expired**

üìã qu'un webhook Stripe est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\" avec un √©v√©nement checkout.session.expired

‚úÖ je re√ßois une r√©ponse 200

‚úÖ les tickets associ√©s sont mis √† jour avec le statut CANCELLED

**Erreur si la signature du webhook est invalide (production)**

üìã que l'environnement est en production

‚úÖ qu'un webhook avec une signature invalide est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\"

‚úÖ je re√ßois une erreur 400

‚úÖ le message d'erreur indique \"Signature invalide\"

**Webhook accept√© avec signature invalide en d√©veloppement**

üìã que l'environnement est en d√©veloppement

‚úÖ qu'un webhook avec une signature invalide est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ le webhook est trait√© malgr√© la signature invalide

**Erreur si la signature est manquante**

üìã qu'un webhook sans signature est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\"

‚úÖ je re√ßois une erreur 400

‚úÖ le message d'erreur indique \"Signature manquante\"

**Erreur si le raw body n'est pas disponible**

üìã qu'un webhook est re√ßu mais le raw body n'est pas disponible

‚ö° je fais une requ√™te POST vers \"/pay/webhook\"

‚úÖ je re√ßois une erreur 500

‚úÖ le message d'erreur indique \"Raw body non disponible\"

**Mise √† jour des informations client depuis customer_details**

üìã qu'un webhook checkout.session.completed est re√ßu

‚úÖ que la session contient customer_details avec email, first_name, last_name

‚ö° je fais une requ√™te POST vers \"/pay/webhook\"

‚úÖ les tickets associ√©s sont mis √† jour avec les informations client

**Traitement d'un √©v√©nement non g√©r√©**

üìã qu'un webhook avec un type d'√©v√©nement non g√©r√© est re√ßu

‚ö° je fais une requ√™te POST vers \"/pay/webhook\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse indique success: true avec tickets_updated: 0

"
      operationId: "post_pay_webhook"
      parameters:
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, les tickets associ√©s sont mis √† jour avec le statut de paiement, les emails de confirmation sont envoy√©s si le paiement est r√©ussi, les certificats de don sont envoy√©s si des dons sont pr√©sents"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  success:
                    type: "boolean"
                    description: "Indique si le webhook a √©t√© trait√© avec succ√®s"
                  tickets_updated:
                    type: "number"
                    description: "Nombre de tickets mis √† jour"
                  qr_codes:
                    type: "array"
                    items:
                      type: "string"
                    description: "Liste des QR codes des tickets associ√©s au checkout"
                required:
                  - success
                  - tickets_updated
                  - qr_codes
              example:
                success: true
                tickets_updated: 123
          headers: null
        400:
          description: "Code 400 - qu'un webhook avec une signature invalide est re√ßu, je re√ßois une erreur 400, le message d'erreur indique \"Signature invalide\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur - je re√ßois une erreur 500, le message d'erreur indique \"Raw body non disponible\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - id
                - type
                - data
              properties:
                id:
                  type: "string"
                  description: "ID de l'√©v√©nement webhook"
                type:
                  type: "string"
                  description: "Type d'√©v√©nement (checkout.session.completed, payment_intent.succeeded, etc.)"
                created:
                  type: "number"
                  description: "Timestamp Unix de l'√©v√©nement"
                data:
                  type: "object"
                  required:
                    - object
                  properties:
                    object:
                      type: "object"
                      description: "Objet de l'√©v√©nement (checkout.session ou payment_intent)"
                      properties:
                        id:
                          type: "string"
                        object:
                          type: "string"
                        amount_total:
                          type: "number"
                        currency:
                          type: "string"
                        status:
                          type: "string"
                        payment_status:
                          type: "string"
                        payment_intent:
                          type: "string"
                        metadata:
                          type: "object"
  /museum/schedules:
    post:
      tags:
        - Mus√©e - Horaires
      summary: "Cr√©e ou met √† jour un horaire d'ouverture (UPSERT). Pour les exceptions : cherche par start_date, end_date et audience_type. Pour les horaires r√©currents : cherche par day_of_week et audience_type. Retourne 201 si cr√©√©, 200 si mis √† jour."
      description: "**Cr√©er un horaire r√©current pour le public** : que je fournis day_of_week, start_time, end_time et audience_type=\"public\" je re√ßois une r√©ponse 201 la r√©ponse contient l'horaire cr√©√© avec un id la r√©ponse contient day_of_week, start_time, end_time, audience_type

**Cr√©er un horaire r√©current pour les membres** : que je fournis day_of_week, start_time, end_time et audience_type=\"member\" je re√ßois une r√©ponse 201 la r√©ponse contient l'horaire cr√©√© avec audience_type = \"member\"

**Cr√©er une exception (horaires sp√©cifiques pour une p√©riode)** : que je fournis is_exception = true que je fournis start_date et end_date que je fournis start_time, end_time et audience_type je re√ßois une r√©ponse 201 la r√©ponse contient is_exception = true la r√©ponse contient start_date et end_date

**Cr√©er une fermeture exceptionnelle** : que je fournis is_exception = true que je fournis is_closed = true que je fournis start_date et end_date que je fournis une description je re√ßois une r√©ponse 201 la r√©ponse contient is_closed = true la r√©ponse contient la description

**Mettre √† jour un horaire existant (upsert)** : qu'un horaire existe avec les m√™mes crit√®res que je fournis les m√™mes crit√®res avec de nouvelles donn√©es je re√ßois une r√©ponse 200 la r√©ponse contient l'horaire mis √† jour

**Erreur lors de la cr√©ation d'un horaire r√©current sans day_of_week** : que je ne fournis pas day_of_week que is_exception = false je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que day_of_week est requis

**Erreur lors de la cr√©ation d'une exception sans dates** : que je fournis is_exception = true que je ne fournis pas start_date ou end_date je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que start_date et end_date sont requis

**Acc√®s non autoris√© pour cr√©er un horaire sans authentification** : je re√ßois une r√©ponse 401 la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un horaire sans les r√¥les requis** : je re√ßois une r√©ponse 403 la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©er un horaire r√©current pour le public**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis day_of_week, start_time, end_time et audience_type=\"public\"

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient l'horaire cr√©√© avec un id

‚úÖ la r√©ponse contient day_of_week, start_time, end_time, audience_type

**Cr√©er un horaire r√©current pour les membres**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis day_of_week, start_time, end_time et audience_type=\"member\"

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient l'horaire cr√©√© avec audience_type = \"member\"

**Cr√©er une exception (horaires sp√©cifiques pour une p√©riode)**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis is_exception = true

‚úÖ que je fournis start_date et end_date

‚úÖ que je fournis start_time, end_time et audience_type

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient is_exception = true

‚úÖ la r√©ponse contient start_date et end_date

**Cr√©er une fermeture exceptionnelle**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis is_exception = true

‚úÖ que je fournis is_closed = true

‚úÖ que je fournis start_date et end_date

‚úÖ que je fournis une description

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient is_closed = true

‚úÖ la r√©ponse contient la description

**Mettre √† jour un horaire existant (upsert)**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un horaire existe avec les m√™mes crit√®res

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis les m√™mes crit√®res avec de nouvelles donn√©es

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient l'horaire mis √† jour

**Erreur lors de la cr√©ation d'un horaire r√©current sans day_of_week**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je ne fournis pas day_of_week

‚úÖ que is_exception = false

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que day_of_week est requis

**Erreur lors de la cr√©ation d'une exception sans dates**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ que je fournis is_exception = true

‚úÖ que je ne fournis pas start_date ou end_date

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que start_date et end_date sont requis

**Acc√®s non autoris√© pour cr√©er un horaire sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ je re√ßois une r√©ponse 401

‚úÖ la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un horaire sans les r√¥les requis**

üìã que je suis authentifi√© mais sans les r√¥les bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules\"

‚úÖ je re√ßois une r√©ponse 403

‚úÖ la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_schedules"
      parameters:
      responses:
        200:
          description: "Succ√®s - qu'un horaire existe avec les m√™mes crit√®res, que je fournis les m√™mes crit√®res avec de nouvelles donn√©es, je re√ßois une r√©ponse 200, la r√©ponse contient l'horaire mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                description: "Horaire mis √† jour (upsert)"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        201:
          description: "Code 201 - que je fournis day_of_week, start_time, end_time et audience_type=\"public\", je re√ßois une r√©ponse 201, la r√©ponse contient l'horaire cr√©√© avec un id, la r√©ponse contient day_of_week, start_time, end_time, audience_type"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                description: "Nouvel horaire cr√©√© (upsert)"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400 - que je ne fournis pas day_of_week, que is_exception = false, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que day_of_week est requis"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - start_time
                - end_time
                - audience_type
              properties:
                day_of_week:
                  type: "integer"
                  minimum: 0
                  maximum: 6
                  description: "Jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi). Requis si is_exception est false."
                start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but au format HH:MM:SS"
                end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin au format HH:MM:SS"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                is_exception:
                  type: "boolean"
                  default: false
                  description: "Indique si c'est une exception (vacances, fermeture exceptionnelle, etc.)"
                is_closed:
                  type: "boolean"
                  default: false
                  description: "Indique si le mus√©e est ferm√©"
                description:
                  type: "string"
                  description: "Description de l'exception ou du changement d'horaire"
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage (optionnel, sera auto-assign√©e si non fournie)"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Horaires
      summary: "R√©cup√®re tous les horaires avec filtres optionnels (authentification requise)"
      description: "**R√©cup√©rer tous les horaires (membres authentifi√©s)** : que des horaires existent en base de donn√©es je re√ßois une r√©ponse 200 la r√©ponse contient un tableau d'horaires

**Acc√®s refus√© pour r√©cup√©rer tous les horaires sans authentification** : je re√ßois une r√©ponse 401 la r√©ponse contient un message d'erreur \"Non authentifi√©\"

### Sc√©narios de test

**R√©cup√©rer tous les horaires (membres authentifi√©s)**

üìã que je suis authentifi√©

‚úÖ que des horaires existent en base de donn√©es

‚ö° je fais une requ√™te GET vers \"/museum/schedules\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau d'horaires

**Acc√®s refus√© pour r√©cup√©rer tous les horaires sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te GET vers \"/museum/schedules\"

‚úÖ je re√ßois une r√©ponse 401

‚úÖ la r√©ponse contient un message d'erreur \"Non authentifi√©\"

"
      operationId: "get_museum_schedules"
      parameters:
        - name: "day_of_week"
          in: "query"
          description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
          required: false
          schema:
            type: "integer"
            minimum: 0
            maximum: 6
            description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
        - name: "audience_type"
          in: "query"
          description: "Filtrer par type d'audience"
          required: false
          schema:
            type: "string"
            enum:
              - public
              - member
              - holiday
            description: "Filtrer par type d'audience"
        - name: "date"
          in: "query"
          description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
        - name: "include_exceptions"
          in: "query"
          description: "Inclure les exceptions dans les r√©sultats"
          required: false
          schema:
            type: "boolean"
            default: true
            description: "Inclure les exceptions dans les r√©sultats"
      responses:
        200:
          description: "Succ√®s - que des horaires existent en base de donn√©es, je re√ßois une r√©ponse 200, la r√©ponse contient un tableau d'horaires"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    day_of_week:
                      type:
                        - integer
                      nullable: true
                    start_time:
                      type: "string"
                    end_time:
                      type: "string"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_exception:
                      type: "boolean"
                    is_closed:
                      type: "boolean"
                    description:
                      type:
                        - string
                      nullable: true
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/schedules/public:
    get:
      tags:
        - Mus√©e - Horaires
      summary: "R√©cup√®re uniquement les horaires publics (route publique, accessible sans authentification)"
      description: "**R√©cup√©rer les horaires publics (non authentifi√©)** : que des horaires existent en base de donn√©es je re√ßois une r√©ponse 200 la r√©ponse contient un tableau d'horaires publics les horaires contiennent holiday_periods et closure_periods

### Sc√©narios de test

**R√©cup√©rer les horaires publics (non authentifi√©)**

üìã que je ne suis pas authentifi√©

‚úÖ que des horaires existent en base de donn√©es

‚ö° je fais une requ√™te GET vers \"/museum/schedules/public\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau d'horaires publics

‚úÖ les horaires contiennent holiday_periods et closure_periods

"
      operationId: "get_museum_schedules_public"
      parameters:
        - name: "day_of_week"
          in: "query"
          description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
          required: false
          schema:
            type: "integer"
            minimum: 0
            maximum: 6
            description: "Filtrer par jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
        - name: "date"
          in: "query"
          description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "R√©cup√©rer les horaires pour une date sp√©cifique (format YYYY-MM-DD)"
        - name: "include_exceptions"
          in: "query"
          description: "Inclure les exceptions dans les r√©sultats"
          required: false
          schema:
            type: "boolean"
            default: true
            description: "Inclure les exceptions dans les r√©sultats"
      responses:
        200:
          description: "Succ√®s - que des horaires existent en base de donn√©es, je re√ßois une r√©ponse 200, la r√©ponse contient un tableau d'horaires publics, les horaires contiennent holiday_periods et closure_periods"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    day_of_week:
                      type:
                        - integer
                      nullable: true
                    start_time:
                      type: "string"
                    end_time:
                      type: "string"
                    audience_type:
                      type: "string"
                      enum:
                        - public
                        - member
                        - holiday
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_exception:
                      type: "boolean"
                    is_closed:
                      type: "boolean"
                    description:
                      type:
                        - string
                      nullable: true
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
                    holiday_periods:
                      type: "array"
                      description: "Tableau des p√©riodes de vacances associ√©es √† cet horaire. Peut contenir plusieurs p√©riodes si elles se chevauchent ou sont cons√©cutives."
                      items:
                        type: "object"
                        properties:
                          id:
                            type: "string"
                          name:
                            type:
                              - string
                            nullable: true
                          start_date:
                            type: "string"
                          end_date:
                            type: "string"
                          zone:
                            type:
                              - string
                            nullable: true
                    closure_periods:
                      type: "array"
                      description: "Tableau des p√©riodes de fermeture associ√©es √† cet horaire. Peut contenir plusieurs p√©riodes si elles se chevauchent ou sont cons√©cutives."
                      items:
                        type: "object"
                        properties:
                          id:
                            type: "string"
                          name:
                            type:
                              - string
                            nullable: true
                          start_date:
                            type: "string"
                          end_date:
                            type: "string"
                          zone:
                            type:
                              - string
                            nullable: true
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/schedules/:id:
    get:
      tags:
        - Mus√©e - Horaires
      summary: "R√©cup√®re un horaire par son ID"
      description: "**R√©cup√©rer un horaire par son ID** : je re√ßois une r√©ponse 200 la r√©ponse contient l'horaire avec l'id demand√©

### Sc√©narios de test

**R√©cup√©rer un horaire par son ID**

üìã qu'un horaire existe avec un id sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/schedules/:id\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient l'horaire avec l'id demand√©

"
      operationId: "get_museum_schedules_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de l'horaire"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de l'horaire"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient l'horaire avec l'id demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Horaires
      summary: "Met √† jour un horaire"
      description: "**Mettre √† jour un horaire** : qu'un horaire existe que je fournis les champs √† mettre √† jour je re√ßois une r√©ponse 200 la r√©ponse contient l'horaire mis √† jour

### Sc√©narios de test

**Mettre √† jour un horaire**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un horaire existe

‚ö° je fais une requ√™te PUT vers \"/museum/schedules/:id\"

‚úÖ que je fournis les champs √† mettre √† jour

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient l'horaire mis √† jour

"
      operationId: "put_museum_schedules_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de l'horaire √† mettre √† jour"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de l'horaire √† mettre √† jour"
      responses:
        200:
          description: "Succ√®s - qu'un horaire existe, que je fournis les champs √† mettre √† jour, je re√ßois une r√©ponse 200, la r√©ponse contient l'horaire mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  day_of_week:
                    type:
                      - integer
                    nullable: true
                  start_time:
                    type: "string"
                  end_time:
                    type: "string"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_exception:
                    type: "boolean"
                  is_closed:
                    type: "boolean"
                  description:
                    type:
                      - string
                    nullable: true
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                start_time: "exemple_start_time"
                end_time: "exemple_end_time"
                audience_type: "exemple_audience_type"
                is_exception: true
                is_closed: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                day_of_week:
                  type:
                    - integer
                  minimum: 0
                  maximum: 6
                  description: "Jour de la semaine (0=dimanche, 1=lundi, ..., 6=samedi)"
                  nullable: true
                start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but au format HH:MM:SS"
                end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin au format HH:MM:SS"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de d√©but pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                  nullable: true
                end_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de fin pour les horaires sp√©cifiques (format YYYY-MM-DD)"
                  nullable: true
                is_exception:
                  type: "boolean"
                  description: "Indique si c'est une exception"
                is_closed:
                  type: "boolean"
                  description: "Indique si le mus√©e est ferm√©"
                description:
                  type:
                    - string
                  description: "Description de l'exception ou du changement d'horaire"
                  nullable: true
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage"
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Horaires
      summary: "Supprime un horaire"
      description: "**Supprimer un horaire** : qu'un horaire existe je re√ßois une r√©ponse 204 l'horaire est supprim√© de la base de donn√©es

### Sc√©narios de test

**Supprimer un horaire**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un horaire existe

‚ö° je fais une requ√™te DELETE vers \"/museum/schedules/:id\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ l'horaire est supprim√© de la base de donn√©es

"
      operationId: "delete_museum_schedules_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de l'horaire √† supprimer"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de l'horaire √† supprimer"
      responses:
        204:
          description: "Code 204 - qu'un horaire existe, je re√ßois une r√©ponse 204, l'horaire est supprim√© de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/schedules/reorder:
    post:
      tags:
        - Mus√©e - Horaires
      summary: "R√©ordonne les horaires selon l'ordre fourni. Met √† jour les positions de tous les horaires selon l'ordre des IDs fournis (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      description: "**R√©ordonner les horaires** : que plusieurs horaires existent que je fournis un tableau schedule_ids dans l'ordre souhait√© je re√ßois une r√©ponse 200 la r√©ponse contient les horaires dans le nouvel ordre

**Erreur lors du r√©ordonnancement avec un tableau vide** : que je fournis un tableau schedule_ids vide je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que le tableau ne peut pas √™tre vide

**Erreur lors du r√©ordonnancement avec des IDs invalides** : que je fournis un tableau schedule_ids contenant des IDs inexistants je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que des IDs sont invalides

### Sc√©narios de test

**R√©ordonner les horaires**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ que plusieurs horaires existent

‚ö° je fais une requ√™te POST vers \"/museum/schedules/reorder\"

‚úÖ que je fournis un tableau schedule_ids dans l'ordre souhait√©

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient les horaires dans le nouvel ordre

**Erreur lors du r√©ordonnancement avec un tableau vide**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules/reorder\"

‚úÖ que je fournis un tableau schedule_ids vide

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que le tableau ne peut pas √™tre vide

**Erreur lors du r√©ordonnancement avec des IDs invalides**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/schedules/reorder\"

‚úÖ que je fournis un tableau schedule_ids contenant des IDs inexistants

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que des IDs sont invalides

"
      operationId: "post_museum_schedules_reorder"
      parameters:
      responses:
        200:
          description: "Succ√®s - que plusieurs horaires existent, que je fournis un tableau schedule_ids dans l'ordre souhait√©, je re√ßois une r√©ponse 200, la r√©ponse contient les horaires dans le nouvel ordre"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    day_of_week:
                      type:
                        - integer
                      nullable: true
                    start_time:
                      type: "string"
                    end_time:
                      type: "string"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_exception:
                      type: "boolean"
                    is_closed:
                      type: "boolean"
                    description:
                      type:
                        - string
                      nullable: true
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
                description: "Liste des horaires r√©ordonn√©s avec leurs nouvelles positions"
              example: null
          headers: null
        400:
          description: "Code 400 - que je fournis un tableau schedule_ids vide, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que le tableau ne peut pas √™tre vide"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - schedule_ids
              properties:
                schedule_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  minItems: 1
                  description: "Tableau d'IDs d'horaires dans l'ordre souhait√©. Les positions seront mises √† jour selon cet ordre (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      security:
        - cookieAuth:
  /museum/prices:
    post:
      tags:
        - Mus√©e - Tarifs
      summary: "Cr√©e ou met √† jour un tarif (upsert). Si un id est fourni et existe, met √† jour le tarif (retourne 200). Sinon, cr√©e un nouveau tarif (retourne 201)."
      description: "**Cr√©er un tarif pour le public** : que je fournis amount, audience_type=\"public\" et translations avec au moins un name je re√ßois une r√©ponse 201 la r√©ponse contient le tarif cr√©√© avec un id la r√©ponse contient amount, audience_type et translations

**Cr√©er un tarif pour les membres** : que je fournis amount, audience_type=\"member\" et translations avec au moins un name je re√ßois une r√©ponse 201 la r√©ponse contient le tarif cr√©√© avec audience_type = \"member\"

**Cr√©er un tarif avec dates de validit√©** : que je fournis start_date et end_date valides que je fournis amount, audience_type et translations avec au moins un name je re√ßois une r√©ponse 201 la r√©ponse contient start_date et end_date

**Cr√©er un tarif inactif** : que je fournis is_active = false que je fournis amount, audience_type et translations avec au moins un name je re√ßois une r√©ponse 201 la r√©ponse contient is_active = false

**Cr√©er un tarif n√©cessitant un justificatif** : que je fournis requires_proof = true que je fournis amount, audience_type et translations avec au moins un name je re√ßois une r√©ponse 201 la r√©ponse contient requires_proof = true

**Mettre √† jour un tarif existant (upsert)** : qu'un tarif existe avec un id sp√©cifique que je fournis cet id avec les nouvelles donn√©es je re√ßois une r√©ponse 200 la r√©ponse contient le tarif mis √† jour

**Erreur lors de la cr√©ation d'un tarif avec montant n√©gatif** : que je fournis un amount n√©gatif je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre positif

**Erreur lors de la cr√©ation d'un tarif avec dates invalides** : que je fournis start_date sans end_date je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que start_date et end_date doivent √™tre d√©finis ensemble

**Erreur lors de la cr√©ation d'un tarif avec start_date apr√®s end_date** : que je fournis start_date apr√®s end_date je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que start_date doit √™tre ant√©rieure √† end_date

**Erreur lors de la cr√©ation d'un tarif sans traduction name** : que je fournis translations sans aucun champ name je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant qu'au moins une traduction pour le champ \"name\" est requise

**Acc√®s non autoris√© pour cr√©er un tarif sans authentification** : je re√ßois une r√©ponse 401 la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un tarif sans les r√¥les requis** : je re√ßois une r√©ponse 403 la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©er un tarif pour le public**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis amount, audience_type=\"public\" et translations avec au moins un name

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient le tarif cr√©√© avec un id

‚úÖ la r√©ponse contient amount, audience_type et translations

**Cr√©er un tarif pour les membres**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis amount, audience_type=\"member\" et translations avec au moins un name

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient le tarif cr√©√© avec audience_type = \"member\"

**Cr√©er un tarif avec dates de validit√©**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis start_date et end_date valides

‚úÖ que je fournis amount, audience_type et translations avec au moins un name

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient start_date et end_date

**Cr√©er un tarif inactif**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis is_active = false

‚úÖ que je fournis amount, audience_type et translations avec au moins un name

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient is_active = false

**Cr√©er un tarif n√©cessitant un justificatif**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis requires_proof = true

‚úÖ que je fournis amount, audience_type et translations avec au moins un name

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient requires_proof = true

**Mettre √† jour un tarif existant (upsert)**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un tarif existe avec un id sp√©cifique

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis cet id avec les nouvelles donn√©es

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le tarif mis √† jour

**Erreur lors de la cr√©ation d'un tarif avec montant n√©gatif**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis un amount n√©gatif

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre positif

**Erreur lors de la cr√©ation d'un tarif avec dates invalides**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis start_date sans end_date

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que start_date et end_date doivent √™tre d√©finis ensemble

**Erreur lors de la cr√©ation d'un tarif avec start_date apr√®s end_date**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis start_date apr√®s end_date

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que start_date doit √™tre ant√©rieure √† end_date

**Erreur lors de la cr√©ation d'un tarif sans traduction name**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ que je fournis translations sans aucun champ name

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant qu'au moins une traduction pour le champ \"name\" est requise

**Acc√®s non autoris√© pour cr√©er un tarif sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ je re√ßois une r√©ponse 401

‚úÖ la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un tarif sans les r√¥les requis**

üìã que je suis authentifi√© mais sans les r√¥les bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices\"

‚úÖ je re√ßois une r√©ponse 403

‚úÖ la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_prices"
      parameters:
      responses:
        200:
          description: "Succ√®s - qu'un tarif existe avec un id sp√©cifique, que je fournis cet id avec les nouvelles donn√©es, je re√ßois une r√©ponse 200, la r√©ponse contient le tarif mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                description: "Tarif mis √† jour (si id fourni et existe)"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        201:
          description: "Code 201 - que je fournis amount, audience_type=\"public\" et translations avec au moins un name, je re√ßois une r√©ponse 201, la r√©ponse contient le tarif cr√©√© avec un id, la r√©ponse contient amount, audience_type et translations"
          content:
            application/json:
              schema:
                type: "object"
                description: "Nouveau tarif cr√©√©"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        400:
          description: "Code 400 - que je fournis un amount n√©gatif, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que le montant doit √™tre positif"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - amount
                - audience_type
                - translations
              properties:
                id:
                  type: "string"
                  format: "uuid"
                  description: "ID optionnel pour l'upsert : si fourni et existe, met √† jour le tarif ; sinon cr√©e un nouveau tarif avec cet ID ou g√©n√®re un nouvel ID"
                amount:
                  type: "number"
                  minimum: 0
                  description: "Montant en euros"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but de validit√© (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin de validit√© (format YYYY-MM-DD)"
                is_active:
                  type: "boolean"
                  default: true
                  description: "Indique si le tarif est actif"
                requires_proof:
                  type: "boolean"
                  default: false
                  description: "Indique si le tarif n√©cessite un justificatif (ex: tarif r√©duit √©tudiant, senior, etc.)"
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage (optionnel, sera auto-assign√©e si non fournie)"
                translations:
                  type: "array"
                  minItems: 1
                  description: "Traductions du tarif (au moins une traduction pour \"name\" est requise)"
                  items:
                    type: "object"
                    required:
                      - lang
                      - field_name
                      - translation
                    properties:
                      lang:
                        type: "string"
                        minLength: 2
                        maxLength: 10
                        description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
                      field_name:
                        type: "string"
                        enum:
                          - name
                          - description
                        description: "Nom du champ √† traduire (name ou description)"
                      translation:
                        type: "string"
                        minLength: 1
                        description: "Texte traduit"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Tarifs
      summary: "R√©cup√®re tous les tarifs avec filtres optionnels"
      description: "**Acc√®s public pour lire les tarifs** : je re√ßois une r√©ponse 200 la r√©ponse contient un tableau de tarifs

### Sc√©narios de test

**Acc√®s public pour lire les tarifs**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te GET vers \"/museum/prices\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau de tarifs

"
      operationId: "get_museum_prices"
      parameters:
        - name: "audience_type"
          in: "query"
          description: "Filtrer par type d'audience"
          required: false
          schema:
            type: "string"
            enum:
              - public
              - member
            description: "Filtrer par type d'audience"
        - name: "date"
          in: "query"
          description: "R√©cup√©rer les tarifs valides pour une date sp√©cifique (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "R√©cup√©rer les tarifs valides pour une date sp√©cifique (format YYYY-MM-DD)"
        - name: "is_active"
          in: "query"
          description: "Filtrer par statut actif/inactif"
          required: false
          schema:
            type: "boolean"
            description: "Filtrer par statut actif/inactif"
        - name: "lang"
          in: "query"
          description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
          required: false
          schema:
            type: "string"
            minLength: 2
            maxLength: 10
            description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient un tableau de tarifs"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  prices:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        amount:
                          type: "number"
                        audience_type:
                          type: "string"
                        start_date:
                          type:
                            - string
                          nullable: true
                        end_date:
                          type:
                            - string
                          nullable: true
                        is_active:
                          type: "boolean"
                        requires_proof:
                          type: "boolean"
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                        translations:
                          type: "object"
                          description: "Traductions organis√©es par langue et champ"
                          additionalProperties:
                            type: "object"
                            additionalProperties:
                              type: "string"
                        name:
                          type: "string"
                        description:
                          type:
                            - string
                          nullable: true
                    description: "Liste des tarifs du mus√©e"
                  guided_tour_price:
                    type:
                      - number
                    description: "Prix de la visite guid√©e (en euros). null si non configur√©."
                    nullable: true
                required:
                  - prices
                  - guided_tour_price
              example:
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/prices/:id:
    get:
      tags:
        - Mus√©e - Tarifs
      summary: "R√©cup√®re un tarif par son ID"
      description: "**R√©cup√©rer un tarif par son ID** : je re√ßois une r√©ponse 200 la r√©ponse contient le tarif avec l'id demand√©

### Sc√©narios de test

**R√©cup√©rer un tarif par son ID**

üìã qu'un tarif existe avec un id sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/prices/:id\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le tarif avec l'id demand√©

"
      operationId: "get_museum_prices_:id"
      parameters:
        - name: "lang"
          in: "query"
          description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
          required: false
          schema:
            type: "string"
            minLength: 2
            maxLength: 10
            description: "Code de langue pour les traductions (ex: \"fr\", \"en\"). Si non fourni, retourne toutes les traductions"
        - name: "id"
          in: "path"
          description: "ID du tarif"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du tarif"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient le tarif avec l'id demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Tarifs
      summary: "Met √† jour un tarif"
      description: "**Mettre √† jour un tarif** : qu'un tarif existe que je fournis les champs √† mettre √† jour je re√ßois une r√©ponse 200 la r√©ponse contient le tarif mis √† jour

**D√©sactiver un tarif** : qu'un tarif existe que je fournis is_active = false je re√ßois une r√©ponse 200 la r√©ponse contient is_active = false

### Sc√©narios de test

**Mettre √† jour un tarif**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un tarif existe

‚ö° je fais une requ√™te PUT vers \"/museum/prices/:id\"

‚úÖ que je fournis les champs √† mettre √† jour

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le tarif mis √† jour

**D√©sactiver un tarif**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un tarif existe

‚ö° je fais une requ√™te PUT vers \"/museum/prices/:id\"

‚úÖ que je fournis is_active = false

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient is_active = false

"
      operationId: "put_museum_prices_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du tarif √† mettre √† jour"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du tarif √† mettre √† jour"
      responses:
        200:
          description: "Succ√®s - qu'un tarif existe, que je fournis les champs √† mettre √† jour, je re√ßois une r√©ponse 200, la r√©ponse contient le tarif mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  amount:
                    type: "number"
                  audience_type:
                    type: "string"
                  start_date:
                    type:
                      - string
                    nullable: true
                  end_date:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  requires_proof:
                    type: "boolean"
                  position:
                    type: "integer"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
                  translations:
                    type: "object"
                    description: "Traductions organis√©es par langue et champ"
                    additionalProperties:
                      type: "object"
                      additionalProperties:
                        type: "string"
                  name:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
              example:
                id: "exemple_id"
                amount: 123
                audience_type: "exemple_audience_type"
                is_active: true
                requires_proof: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
                name: "exemple_name"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                amount:
                  type: "number"
                  minimum: 0
                  description: "Montant en euros"
                audience_type:
                  type: "string"
                  enum:
                    - public
                    - member
                    - holiday
                  description: "Type d'audience (public, member ou holiday)"
                start_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de d√©but de validit√© (format YYYY-MM-DD)"
                  nullable: true
                end_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de fin de validit√© (format YYYY-MM-DD)"
                  nullable: true
                is_active:
                  type: "boolean"
                  description: "Indique si le tarif est actif"
                requires_proof:
                  type: "boolean"
                  description: "Indique si le tarif n√©cessite un justificatif"
                position:
                  type: "integer"
                  minimum: 1
                  description: "Position pour l'ordre d'affichage"
                translations:
                  type: "array"
                  description: "Traductions du tarif"
                  items:
                    type: "object"
                    required:
                      - lang
                      - field_name
                      - translation
                    properties:
                      lang:
                        type: "string"
                        minLength: 2
                        maxLength: 10
                        description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
                      field_name:
                        type: "string"
                        enum:
                          - name
                          - description
                        description: "Nom du champ √† traduire (name ou description)"
                      translation:
                        type: "string"
                        minLength: 1
                        description: "Texte traduit"
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Tarifs
      summary: "Supprime un tarif"
      description: "**Supprimer un tarif** : qu'un tarif existe je re√ßois une r√©ponse 204 le tarif est supprim√© de la base de donn√©es

### Sc√©narios de test

**Supprimer un tarif**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un tarif existe

‚ö° je fais une requ√™te DELETE vers \"/museum/prices/:id\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ le tarif est supprim√© de la base de donn√©es

"
      operationId: "delete_museum_prices_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du tarif √† supprimer"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du tarif √† supprimer"
      responses:
        204:
          description: "Code 204 - qu'un tarif existe, je re√ßois une r√©ponse 204, le tarif est supprim√© de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/prices/reorder:
    post:
      tags:
        - Mus√©e - Tarifs
      summary: "R√©ordonne les tarifs selon l'ordre fourni. Met √† jour les positions de tous les tarifs selon l'ordre des IDs fournis (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      description: "**R√©ordonner les tarifs** : que plusieurs tarifs existent que je fournis un tableau price_ids dans l'ordre souhait√© je re√ßois une r√©ponse 200 la r√©ponse contient les tarifs dans le nouvel ordre

**Erreur lors du r√©ordonnancement avec un tableau vide** : que je fournis un tableau price_ids vide je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que le tableau ne peut pas √™tre vide

**Erreur lors du r√©ordonnancement avec des IDs invalides** : que je fournis un tableau price_ids contenant des IDs inexistants je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que des IDs sont invalides

### Sc√©narios de test

**R√©ordonner les tarifs**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ que plusieurs tarifs existent

‚ö° je fais une requ√™te POST vers \"/museum/prices/reorder\"

‚úÖ que je fournis un tableau price_ids dans l'ordre souhait√©

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient les tarifs dans le nouvel ordre

**Erreur lors du r√©ordonnancement avec un tableau vide**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices/reorder\"

‚úÖ que je fournis un tableau price_ids vide

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que le tableau ne peut pas √™tre vide

**Erreur lors du r√©ordonnancement avec des IDs invalides**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/prices/reorder\"

‚úÖ que je fournis un tableau price_ids contenant des IDs inexistants

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que des IDs sont invalides

"
      operationId: "post_museum_prices_reorder"
      parameters:
      responses:
        200:
          description: "Succ√®s - que plusieurs tarifs existent, que je fournis un tableau price_ids dans l'ordre souhait√©, je re√ßois une r√©ponse 200, la r√©ponse contient les tarifs dans le nouvel ordre"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    amount:
                      type: "number"
                    audience_type:
                      type: "string"
                    start_date:
                      type:
                        - string
                      nullable: true
                    end_date:
                      type:
                        - string
                      nullable: true
                    is_active:
                      type: "boolean"
                    requires_proof:
                      type: "boolean"
                    position:
                      type: "integer"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
                    translations:
                      type: "object"
                      description: "Traductions organis√©es par langue et champ"
                      additionalProperties:
                        type: "object"
                        additionalProperties:
                          type: "string"
                    name:
                      type: "string"
                    description:
                      type:
                        - string
                      nullable: true
                description: "Liste des tarifs r√©ordonn√©s avec leurs nouvelles positions"
              example: null
          headers: null
        400:
          description: "Code 400 - que je fournis un tableau price_ids vide, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que le tableau ne peut pas √™tre vide"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - price_ids
              properties:
                price_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  minItems: 1
                  description: "Tableau d'IDs de tarifs dans l'ordre souhait√©. Les positions seront mises √† jour selon cet ordre (premier ID = position 1, deuxi√®me ID = position 2, etc.)"
      security:
        - cookieAuth:
  /museum/settings:
    get:
      tags:
        - Mus√©e - Param√®tres
      summary: "R√©cup√®re tous les param√®tres avec filtres optionnels"
      description: "**R√©cup√©rer tous les param√®tres** : je re√ßois une r√©ponse 200 la r√©ponse contient un tableau de param√®tres

**Acc√®s public pour lire les param√®tres** : je re√ßois une r√©ponse 200 la r√©ponse contient un tableau de param√®tres

### Sc√©narios de test

**R√©cup√©rer tous les param√®tres**

üìã que des param√®tres existent en base de donn√©es

‚ö° je fais une requ√™te GET vers \"/museum/settings\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau de param√®tres

**Acc√®s public pour lire les param√®tres**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te GET vers \"/museum/settings\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau de param√®tres

"
      operationId: "get_museum_settings"
      parameters:
        - name: "key"
          in: "query"
          description: "Filtrer par cl√© sp√©cifique"
          required: false
          schema:
            type: "string"
            description: "Filtrer par cl√© sp√©cifique"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient un tableau de param√®tres"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    key:
                      type: "string"
                    value:
                      type: "string"
                    value_type:
                      type: "string"
                    description:
                      type:
                        - string
                      nullable: true
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    post:
      tags:
        - Mus√©e - Param√®tres
      summary: "Cr√©e ou met √† jour un param√®tre (upsert) - Retourne 201 si cr√©√©, 200 si mis √† jour"
      description: "**Cr√©er un nouveau param√®tre** : que je fournis key et value je re√ßois une r√©ponse 201 la r√©ponse contient le param√®tre cr√©√© avec un id la r√©ponse contient key, value et value_type

**Mettre √† jour un param√®tre existant (upsert)** : qu'un param√®tre existe avec une cl√© sp√©cifique que je fournis la m√™me cl√© avec une nouvelle valeur je re√ßois une r√©ponse 200 la r√©ponse contient le param√®tre mis √† jour

**Cr√©er un param√®tre avec un type sp√©cifique** : que je fournis key, value et value_type je re√ßois une r√©ponse 201 la r√©ponse contient value_type correspondant au type fourni

**Cr√©er un param√®tre avec auto-d√©tection du type** : que je fournis key et value (sans value_type) je re√ßois une r√©ponse 201 la r√©ponse contient value_type auto-d√©tect√© selon le type de value

**Erreur lors de la cr√©ation d'un param√®tre avec valeur invalide** : que je fournis value_type=\"number\" avec une value qui n'est pas un nombre je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que la valeur ne peut pas √™tre convertie

**Acc√®s non autoris√© pour cr√©er un param√®tre sans authentification** : je re√ßois une r√©ponse 401 la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un param√®tre sans les r√¥les requis** : je re√ßois une r√©ponse 403 la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©er un nouveau param√®tre**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ que je fournis key et value

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient le param√®tre cr√©√© avec un id

‚úÖ la r√©ponse contient key, value et value_type

**Mettre √† jour un param√®tre existant (upsert)**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'un param√®tre existe avec une cl√© sp√©cifique

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ que je fournis la m√™me cl√© avec une nouvelle valeur

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le param√®tre mis √† jour

**Cr√©er un param√®tre avec un type sp√©cifique**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ que je fournis key, value et value_type

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient value_type correspondant au type fourni

**Cr√©er un param√®tre avec auto-d√©tection du type**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ que je fournis key et value (sans value_type)

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient value_type auto-d√©tect√© selon le type de value

**Erreur lors de la cr√©ation d'un param√®tre avec valeur invalide**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ que je fournis value_type=\"number\" avec une value qui n'est pas un nombre

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que la valeur ne peut pas √™tre convertie

**Acc√®s non autoris√© pour cr√©er un param√®tre sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ je re√ßois une r√©ponse 401

‚úÖ la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er un param√®tre sans les r√¥les requis**

üìã que je suis authentifi√© mais sans les r√¥les bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/settings\"

‚úÖ je re√ßois une r√©ponse 403

‚úÖ la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_settings"
      parameters:
      responses:
        200:
          description: "Succ√®s - qu'un param√®tre existe avec une cl√© sp√©cifique, que je fournis la m√™me cl√© avec une nouvelle valeur, je re√ßois une r√©ponse 200, la r√©ponse contient le param√®tre mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                key: "exemple_key"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        201:
          description: "Code 201 - que je fournis key et value, je re√ßois une r√©ponse 201, la r√©ponse contient le param√®tre cr√©√© avec un id, la r√©ponse contient key, value et value_type"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                key: "exemple_key"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400 - que je fournis value_type=\"number\" avec une value qui n'est pas un nombre, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que la valeur ne peut pas √™tre convertie"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - key
                - value
              properties:
                key:
                  type: "string"
                  minLength: 1
                  maxLength: 255
                  description: "Cl√© unique du param√®tre (ex: \"max_capacity\", \"current_visitors\")"
                value:
                  description: "Valeur du param√®tre (string, number, boolean ou object) - Le type est auto-d√©tect√© si value_type n'est pas fourni"
                description:
                  type: "string"
                  description: "Description du param√®tre"
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Param√®tres
      summary: "Cr√©e ou met √† jour un param√®tre (upsert) - Retourne 201 si cr√©√©, 200 si mis √† jour"
      description: ""
      operationId: "put_museum_settings"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type:
                      - string
                      - number
                      - boolean
                      - object
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - key
                - value
              properties:
                key:
                  type: "string"
                  minLength: 1
                  maxLength: 255
                  description: "Cl√© unique du param√®tre (ex: \"max_capacity\", \"current_visitors\")"
                value:
                  description: "Valeur du param√®tre (string, number, boolean ou object) - Le type est auto-d√©tect√© si value_type n'est pas fourni"
                description:
                  type: "string"
                  description: "Description du param√®tre"
      security:
        - cookieAuth:
  /museum/settings/:key:
    get:
      tags:
        - Mus√©e - Param√®tres
      summary: "R√©cup√®re un param√®tre par sa cl√©"
      description: "**R√©cup√©rer un param√®tre par sa cl√©** : je re√ßois une r√©ponse 200 la r√©ponse contient le param√®tre avec la cl√© demand√©e

### Sc√©narios de test

**R√©cup√©rer un param√®tre par sa cl√©**

üìã qu'un param√®tre existe avec une cl√© sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/settings/:key\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le param√®tre avec la cl√© demand√©e

"
      operationId: "get_museum_settings_:key"
      parameters:
        - name: "key"
          in: "path"
          description: "Cl√© du param√®tre"
          required: true
          schema:
            type: "string"
            description: "Cl√© du param√®tre"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient le param√®tre avec la cl√© demand√©e"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type: "string"
                  value_type:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                key: "exemple_key"
                value: "exemple_value"
                value_type: "exemple_value_type"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Param√®tres
      summary: "Supprime un param√®tre par sa cl√©"
      description: "**Supprimer un param√®tre** : qu'un param√®tre existe je re√ßois une r√©ponse 204 le param√®tre est supprim√© de la base de donn√©es

### Sc√©narios de test

**Supprimer un param√®tre**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'un param√®tre existe

‚ö° je fais une requ√™te DELETE vers \"/museum/settings/:key\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ le param√®tre est supprim√© de la base de donn√©es

"
      operationId: "delete_museum_settings_:key"
      parameters:
        - name: "key"
          in: "path"
          description: "Cl√© du param√®tre √† supprimer"
          required: true
          schema:
            type: "string"
            description: "Cl√© du param√®tre √† supprimer"
      responses:
        204:
          description: "Code 204 - qu'un param√®tre existe, je re√ßois une r√©ponse 204, le param√®tre est supprim√© de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/capacity/max:
    get:
      tags:
        - Mus√©e - Capacit√©
      summary: "R√©cup√®re la capacit√© maximale du mus√©e"
      description: "**R√©cup√©rer la capacit√© maximale** : je re√ßois une r√©ponse 200 la r√©ponse contient max_capacity max_capacity est un nombre

**R√©cup√©rer la capacit√© maximale par d√©faut** : je re√ßois une r√©ponse 200 la r√©ponse contient max_capacity = 0

**Acc√®s public pour lire la capacit√© maximale** : je re√ßois une r√©ponse 200 la r√©ponse contient max_capacity

### Sc√©narios de test

**R√©cup√©rer la capacit√© maximale**

üìã qu'un param√®tre max_capacity existe

‚ö° je fais une requ√™te GET vers \"/museum/capacity/max\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient max_capacity

‚úÖ max_capacity est un nombre

**R√©cup√©rer la capacit√© maximale par d√©faut**

üìã qu'aucun param√®tre max_capacity n'existe

‚ö° je fais une requ√™te GET vers \"/museum/capacity/max\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient max_capacity = 0

**Acc√®s public pour lire la capacit√© maximale**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te GET vers \"/museum/capacity/max\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient max_capacity

"
      operationId: "get_museum_capacity_max"
      parameters:
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient max_capacity, max_capacity est un nombre"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  max_capacity:
                    type: "number"
                    description: "Capacit√© maximale du mus√©e"
              example:
                max_capacity: 123
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    post:
      tags:
        - Mus√©e - Capacit√©
      summary: "D√©finit la capacit√© maximale du mus√©e"
      description: "**D√©finir la capacit√© maximale** : que je fournis max_capacity = 90 je re√ßois une r√©ponse 200 la r√©ponse contient le param√®tre max_capacity mis √† jour un message WebSocket est envoy√© pour rafra√Æchir la capacit√©

**Erreur lors de la d√©finition d'une capacit√© maximale n√©gative** : que je fournis max_capacity = -10 je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur indiquant que la capacit√© doit √™tre positive ou nulle

### Sc√©narios de test

**D√©finir la capacit√© maximale**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/capacity/max\"

‚úÖ que je fournis max_capacity = 90

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le param√®tre max_capacity mis √† jour

‚úÖ un message WebSocket est envoy√© pour rafra√Æchir la capacit√©

**Erreur lors de la d√©finition d'une capacit√© maximale n√©gative**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/capacity/max\"

‚úÖ que je fournis max_capacity = -10

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur indiquant que la capacit√© doit √™tre positive ou nulle

"
      operationId: "post_museum_capacity_max"
      parameters:
      responses:
        200:
          description: "Succ√®s - que je fournis max_capacity = 90, je re√ßois une r√©ponse 200, la r√©ponse contient le param√®tre max_capacity mis √† jour, un message WebSocket est envoy√© pour rafra√Æchir la capacit√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  key:
                    type: "string"
                  value:
                    type: "string"
                  value_type:
                    type: "string"
                  description:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                key: "exemple_key"
                value: "exemple_value"
                value_type: "exemple_value_type"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400 - que je fournis max_capacity = -10, je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur indiquant que la capacit√© doit √™tre positive ou nulle"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - max_capacity
              properties:
                max_capacity:
                  type: "number"
                  minimum: 0
                  description: "Capacit√© maximale du mus√©e (doit √™tre positive ou nulle)"
      security:
        - cookieAuth:
  /museum/capacity/validated-tickets:
    get:
      tags:
        - Mus√©e - Capacit√©
      summary: "R√©cup√®re les tickets valid√©s pour un cr√©neau donn√©. Retourne le nombre de tickets valid√©s (count) et la liste compl√®te des tickets (tickets) pour le cr√©neau sp√©cifi√©. Peut inclure les cr√©neaux adjacents si include_adjacent_slots est true."
      description: ""
      operationId: "get_museum_capacity_validated-tickets"
      parameters:
        - name: "reservation_date"
          in: "query"
          description: "Date de r√©servation (format YYYY-MM-DD)"
          required: true
          schema:
            type: "string"
            format: "date"
            description: "Date de r√©servation (format YYYY-MM-DD)"
        - name: "slot_start_time"
          in: "query"
          description: "Heure de d√©but du cr√©neau (format HH:MM:SS)"
          required: true
          schema:
            type: "string"
            pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
            description: "Heure de d√©but du cr√©neau (format HH:MM:SS)"
        - name: "slot_end_time"
          in: "query"
          description: "Heure de fin du cr√©neau (format HH:MM:SS)"
          required: true
          schema:
            type: "string"
            pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
            description: "Heure de fin du cr√©neau (format HH:MM:SS)"
        - name: "include_adjacent_slots"
          in: "query"
          description: "Inclure les cr√©neaux adjacents (par d√©faut: true)"
          required: false
          schema:
            type: "boolean"
            default: true
            description: "Inclure les cr√©neaux adjacents (par d√©faut: true)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  count:
                    type: "number"
                    description: "Nombre de tickets valid√©s pour le cr√©neau"
                  tickets:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        qr_code:
                          type: "string"
                        first_name:
                          type:
                            - string
                          nullable: true
                        last_name:
                          type:
                            - string
                          nullable: true
                        email:
                          type: "string"
                        reservation_date:
                          type: "string"
                        slot_start_time:
                          type: "string"
                        slot_end_time:
                          type: "string"
                        checkout_id:
                          type:
                            - string
                          nullable: true
                        checkout_reference:
                          type:
                            - string
                          nullable: true
                        transaction_status:
                          type:
                            - string
                          nullable: true
                        ticket_price:
                          type: "number"
                        donation_amount:
                          type: "number"
                        total_amount:
                          type: "number"
                        status:
                          type: "string"
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        language:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                    description: "Liste des tickets valid√©s pour le cr√©neau"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets:
    post:
      tags:
        - Mus√©e - Tickets
      summary: "Cr√©e un nouveau ticket avec g√©n√©ration automatique d'un code QR unique"
      description: "**Cr√©er un ticket** : que je fournis email, reservation_date, slot_start_time, slot_end_time, ticket_price je re√ßois une r√©ponse 201 la r√©ponse contient le ticket cr√©√© avec un id et un qr_code

**Acc√®s non autoris√© pour cr√©er un ticket sans les r√¥les requis** : je re√ßois une r√©ponse 403 la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©er un ticket**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/tickets\"

‚úÖ que je fournis email, reservation_date, slot_start_time, slot_end_time, ticket_price

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient le ticket cr√©√© avec un id et un qr_code

**Acc√®s non autoris√© pour cr√©er un ticket sans les r√¥les requis**

üìã que je suis authentifi√© mais sans les r√¥les bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/tickets\"

‚úÖ je re√ßois une r√©ponse 403

‚úÖ la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_tickets"
      parameters:
      responses:
        201:
          description: "Code 201 - que je fournis email, reservation_date, slot_start_time, slot_end_time, ticket_price, je re√ßois une r√©ponse 201, la r√©ponse contient le ticket cr√©√© avec un id et un qr_code"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  guided_tour_price:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                qr_code: "exemple_qr_code"
                email: "exemple_email"
                reservation_date: "exemple_reservation_date"
                slot_start_time: "exemple_slot_start_time"
                slot_end_time: "exemple_slot_end_time"
                ticket_price: 123
                donation_amount: 123
                guided_tour_price: 123
                total_amount: 123
                status: "exemple_status"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - email
                - reservation_date
                - slot_start_time
                - slot_end_time
                - ticket_price
              properties:
                first_name:
                  type: "string"
                  maxLength: 255
                  description: "Pr√©nom du visiteur (optionnel)"
                last_name:
                  type: "string"
                  maxLength: 255
                  description: "Nom du visiteur (optionnel)"
                email:
                  type: "string"
                  format: "email"
                  maxLength: 255
                  description: "Email du visiteur (obligatoire pour recevoir le ticket)"
                reservation_date:
                  type: "string"
                  format: "date"
                  description: "Date de r√©servation (format YYYY-MM-DD)"
                slot_start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but du cr√©neau horaire (format HH:MM:SS)"
                slot_end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin du cr√©neau horaire (format HH:MM:SS)"
                ticket_price:
                  type: "number"
                  minimum: 0
                  description: "Prix du ticket en euros"
                donation_amount:
                  type: "number"
                  minimum: 0
                  default: 0
                  description: "Montant du don optionnel en euros (0 par d√©faut)"
                checkout_id:
                  type: "string"
                  description: "ID du checkout (optionnel au moment de la cr√©ation)"
                checkout_reference:
                  type: "string"
                  description: "R√©f√©rence du checkout (optionnel)"
                transaction_status:
                  type: "string"
                  description: "Statut de la transaction (optionnel)"
                notes:
                  type: "string"
                  description: "Notes libres optionnelles. Si pricing_info est fourni, il sera automatiquement stock√© dans notes au format JSON avec les notes libres."
                pricing_info:
                  type: "object"
                  description: "Informations de tarif au moment de la cr√©ation (sera stock√© dans notes au format JSON). Permet de conserver les informations de tarif pour v√©rification ult√©rieure, notamment pour les membres avec places gratuites."
                  properties:
                    price_id:
                      type:
                        - string
                      format: "uuid"
                      description: "ID du tarif utilis√© (optionnel, peut √™tre null pour les tarifs personnalis√©s)"
                      nullable: true
                    price_name:
                      type:
                        - string
                      description: "Nom du tarif au moment de la cr√©ation (pour r√©f√©rence)"
                      nullable: true
                    price_amount:
                      type: "number"
                      minimum: 0
                      description: "Montant du tarif au moment de la cr√©ation"
                    audience_type:
                      type:
                        - string
                      enum:
                        - public
                        - member
                      description: "Type d'audience"
                      nullable: true
                    requires_proof:
                      type:
                        - boolean
                      description: "Si un justificatif √©tait requis"
                      nullable: true
                    proof_info:
                      type:
                        - object
                      description: "Informations sur le justificatif fourni"
                      properties:
                        type:
                          type:
                            - string
                          description: "Type de justificatif (ex: \"student_card\", \"senior_card\", \"member_card\")"
                          nullable: true
                        reference:
                          type:
                            - string
                          description: "R√©f√©rence du justificatif (num√©ro de carte, etc.)"
                          nullable: true
                        uploaded_at:
                          type:
                            - string
                          format: "date-time"
                          description: "Date d'upload du justificatif (format ISO)"
                          nullable: true
                        verified:
                          type:
                            - boolean
                          description: "Si le justificatif a √©t√© v√©rifi√©"
                          nullable: true
                        verified_by:
                          type:
                            - string
                          description: "ID ou nom de la personne qui a v√©rifi√©"
                          nullable: true
                        verified_at:
                          type:
                            - string
                          format: "date-time"
                          description: "Date de v√©rification (format ISO)"
                          nullable: true
                      nullable: true
                    applied_at:
                      type: "string"
                      format: "date-time"
                      default: "2026-01-13T18:59:11.142Z"
                      description: "Date d'application du tarif (format ISO). G√©n√©r√©e automatiquement si non fournie."
                  required:
                    - price_amount
                language:
                  type: "string"
                  maxLength: 10
                  description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re tous les tickets avec filtres optionnels (email, date, statut, etc.)"
      description: ""
      operationId: "get_museum_tickets"
      parameters:
        - name: "search"
          in: "query"
          description: "Recherche textuelle dans email, first_name, last_name, checkout_id, checkout_reference et qr_code (insensible √† la casse, recherche partielle). Exemple: \"gmail\" trouvera tous les tickets avec un email contenant \"gmail\"."
          required: false
          schema:
            type: "string"
            description: "Recherche textuelle dans email, first_name, last_name, checkout_id, checkout_reference et qr_code (insensible √† la casse, recherche partielle). Exemple: \"gmail\" trouvera tous les tickets avec un email contenant \"gmail\"."
        - name: "reservation_date"
          in: "query"
          description: "Filtrer par date de r√©servation (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "Filtrer par date de r√©servation (format YYYY-MM-DD)"
        - name: "status"
          in: "query"
          description: "Filtrer par statut"
          required: false
          schema:
            type: "string"
            enum:
              - pending
              - paid
              - cancelled
              - used
              - expired
            description: "Filtrer par statut"
        - name: "page"
          in: "query"
          description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
            description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
        - name: "limit"
          in: "query"
          description: "Nombre d'√©l√©ments par page (par d√©faut 500)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 500
            description: "Nombre d'√©l√©ments par page (par d√©faut 500)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  tickets:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        qr_code:
                          type: "string"
                        first_name:
                          type:
                            - string
                          nullable: true
                        last_name:
                          type:
                            - string
                          nullable: true
                        email:
                          type: "string"
                        reservation_date:
                          type: "string"
                        slot_start_time:
                          type: "string"
                        slot_end_time:
                          type: "string"
                        checkout_id:
                          type:
                            - string
                          nullable: true
                        checkout_reference:
                          type:
                            - string
                          nullable: true
                        transaction_status:
                          type:
                            - string
                          nullable: true
                        ticket_price:
                          type: "number"
                        donation_amount:
                          type: "number"
                        total_amount:
                          type: "number"
                        status:
                          type: "string"
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        language:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  total:
                    type: "integer"
                    description: "Nombre total de tickets correspondant aux filtres"
                  page:
                    type: "integer"
                    description: "Page actuelle"
                  limit:
                    type: "integer"
                    description: "Nombre d'√©l√©ments par page"
                  totalPages:
                    type: "integer"
                    description: "Nombre total de pages"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets/:id:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re un ticket par son ID (authentification requise)"
      description: "**R√©cup√©rer un ticket par ID** : qu'un ticket existe avec un ID sp√©cifique je re√ßois une r√©ponse 200 la r√©ponse contient le ticket avec l'ID demand√©

### Sc√©narios de test

**R√©cup√©rer un ticket par ID**

üìã que je suis authentifi√©

‚úÖ qu'un ticket existe avec un ID sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/tickets/:id\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le ticket avec l'ID demand√©

"
      operationId: "get_museum_tickets_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket"
      responses:
        200:
          description: "Succ√®s - qu'un ticket existe avec un ID sp√©cifique, je re√ßois une r√©ponse 200, la r√©ponse contient le ticket avec l'ID demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  guided_tour_price:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                qr_code: "exemple_qr_code"
                email: "exemple_email"
                reservation_date: "exemple_reservation_date"
                slot_start_time: "exemple_slot_start_time"
                slot_end_time: "exemple_slot_end_time"
                ticket_price: 123
                donation_amount: 123
                guided_tour_price: 123
                total_amount: 123
                status: "exemple_status"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - Tickets
      summary: "Met √† jour un ticket"
      description: "**Mettre √† jour un ticket** : qu'un ticket existe que je fournis de nouvelles valeurs je re√ßois une r√©ponse 200 la r√©ponse contient le ticket mis √† jour

### Sc√©narios de test

**Mettre √† jour un ticket**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un ticket existe

‚ö° je fais une requ√™te PUT vers \"/museum/tickets/:id\"

‚úÖ que je fournis de nouvelles valeurs

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le ticket mis √† jour

"
      operationId: "put_museum_tickets_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket √† mettre √† jour"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket √† mettre √† jour"
      responses:
        200:
          description: "Succ√®s - qu'un ticket existe, que je fournis de nouvelles valeurs, je re√ßois une r√©ponse 200, la r√©ponse contient le ticket mis √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  guided_tour_price:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                qr_code: "exemple_qr_code"
                email: "exemple_email"
                reservation_date: "exemple_reservation_date"
                slot_start_time: "exemple_slot_start_time"
                slot_end_time: "exemple_slot_end_time"
                ticket_price: 123
                donation_amount: 123
                guided_tour_price: 123
                total_amount: 123
                status: "exemple_status"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                first_name:
                  type:
                    - string
                  maxLength: 255
                  description: "Pr√©nom du visiteur"
                  nullable: true
                last_name:
                  type:
                    - string
                  maxLength: 255
                  description: "Nom du visiteur"
                  nullable: true
                email:
                  type: "string"
                  format: "email"
                  maxLength: 255
                  description: "Email du visiteur"
                reservation_date:
                  type: "string"
                  format: "date"
                  description: "Date de r√©servation (format YYYY-MM-DD)"
                slot_start_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but du cr√©neau horaire (format HH:MM:SS)"
                slot_end_time:
                  type: "string"
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin du cr√©neau horaire (format HH:MM:SS)"
                ticket_price:
                  type: "number"
                  minimum: 0
                  description: "Prix du ticket en euros"
                donation_amount:
                  type: "number"
                  minimum: 0
                  description: "Montant du don optionnel en euros"
                checkout_id:
                  type:
                    - string
                  description: "ID du checkout"
                  nullable: true
                checkout_reference:
                  type:
                    - string
                  description: "R√©f√©rence du checkout"
                  nullable: true
                transaction_status:
                  type:
                    - string
                  description: "Statut de la transaction"
                  nullable: true
                status:
                  type: "string"
                  enum:
                    - pending
                    - paid
                    - cancelled
                    - used
                    - expired
                  description: "Statut du ticket"
                used_at:
                  type:
                    - string
                  format: "date-time"
                  description: "Date/heure d'utilisation du ticket"
                  nullable: true
                notes:
                  type:
                    - string
                  description: "Notes optionnelles"
                  nullable: true
                language:
                  type:
                    - string
                  maxLength: 10
                  description: "Code de langue (ex: \"fr\", \"en\", \"es\")"
                  nullable: true
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - Tickets
      summary: "Supprime un ticket"
      description: "**Supprimer un ticket** : qu'un ticket existe je re√ßois une r√©ponse 204 le ticket est supprim√© de la base de donn√©es

### Sc√©narios de test

**Supprimer un ticket**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un ticket existe

‚ö° je fais une requ√™te DELETE vers \"/museum/tickets/:id\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ le ticket est supprim√© de la base de donn√©es

"
      operationId: "delete_museum_tickets_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket √† supprimer"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket √† supprimer"
      responses:
        204:
          description: "Code 204 - qu'un ticket existe, je re√ßois une r√©ponse 204, le ticket est supprim√© de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets/qr/:qrCode:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re un ticket par son code QR (route publique)"
      description: "**R√©cup√©rer un ticket par code QR** : je re√ßois une r√©ponse 200 la r√©ponse contient le ticket avec le code QR demand√©

### Sc√©narios de test

**R√©cup√©rer un ticket par code QR**

üìã qu'un ticket existe avec un code QR sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/tickets/qr/:qrCode\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient le ticket avec le code QR demand√©

"
      operationId: "get_museum_tickets_qr_:qrCode"
      parameters:
        - name: "id"
          in: "path"
          description: "ID du ticket"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID du ticket"
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient le ticket avec le code QR demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  guided_tour_price:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                qr_code: "exemple_qr_code"
                email: "exemple_email"
                reservation_date: "exemple_reservation_date"
                slot_start_time: "exemple_slot_start_time"
                slot_end_time: "exemple_slot_end_time"
                ticket_price: 123
                donation_amount: 123
                guided_tour_price: 123
                total_amount: 123
                status: "exemple_status"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/tickets/validate:
    post:
      tags:
        - Mus√©e - Tickets
      summary: "Valide/utilise un ticket en scannant son code QR (route publique)"
      description: "**Valider un ticket (scan QR)** : qu'un ticket existe avec status='paid' et used_at=null que je fournis qr_code je re√ßois une r√©ponse 200 la r√©ponse indique que le ticket est valide le ticket est marqu√© comme utilis√© (used_at est d√©fini)

**Erreur si le ticket est d√©j√† utilis√©** : qu'un ticket existe avec used_at d√©j√† d√©fini que je fournis qr_code je re√ßois une r√©ponse 400 la r√©ponse indique que le ticket est d√©j√† utilis√©

### Sc√©narios de test

**Valider un ticket (scan QR)**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un ticket existe avec status='paid' et used_at=null

‚ö° je fais une requ√™te POST vers \"/museum/tickets/validate\"

‚úÖ que je fournis qr_code

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse indique que le ticket est valide

‚úÖ le ticket est marqu√© comme utilis√© (used_at est d√©fini)

**Erreur si le ticket est d√©j√† utilis√©**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un ticket existe avec used_at d√©j√† d√©fini

‚ö° je fais une requ√™te POST vers \"/museum/tickets/validate\"

‚úÖ que je fournis qr_code

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse indique que le ticket est d√©j√† utilis√©

"
      operationId: "post_museum_tickets_validate"
      parameters:
      responses:
        200:
          description: "Succ√®s - qu'un ticket existe avec status='paid' et used_at=null, que je fournis qr_code, je re√ßois une r√©ponse 200, la r√©ponse indique que le ticket est valide, le ticket est marqu√© comme utilis√© (used_at est d√©fini)"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  qr_code:
                    type: "string"
                  first_name:
                    type:
                      - string
                    nullable: true
                  last_name:
                    type:
                      - string
                    nullable: true
                  email:
                    type: "string"
                  reservation_date:
                    type: "string"
                  slot_start_time:
                    type: "string"
                  slot_end_time:
                    type: "string"
                  checkout_id:
                    type:
                      - string
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    nullable: true
                  transaction_status:
                    type:
                      - string
                    nullable: true
                  ticket_price:
                    type: "number"
                  donation_amount:
                    type: "number"
                  guided_tour_price:
                    type: "number"
                  total_amount:
                    type: "number"
                  status:
                    type: "string"
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  language:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                qr_code: "exemple_qr_code"
                email: "exemple_email"
                reservation_date: "exemple_reservation_date"
                slot_start_time: "exemple_slot_start_time"
                slot_end_time: "exemple_slot_end_time"
                ticket_price: 123
                donation_amount: 123
                guided_tour_price: 123
                total_amount: 123
                status: "exemple_status"
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400 - qu'un ticket existe avec used_at d√©j√† d√©fini, que je fournis qr_code, je re√ßois une r√©ponse 400, la r√©ponse indique que le ticket est d√©j√† utilis√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - qr_code
              properties:
                qr_code:
                  type: "string"
                  minLength: 8
                  maxLength: 8
                  pattern: "^[A-Z0-9]{8}$"
                  description: "Code QR du ticket √† valider (8 caract√®res alphanum√©riques majuscules)"
      security:
        - cookieAuth:
  /museum/tickets/payment:
    post:
      tags:
        - Mus√©e - Tickets
      summary: "Cr√©e plusieurs tickets avec paiement. Cr√©e d'abord un checkout avec le montant total (somme de tous les ticket_price + donation_amount), puis enregistre tous les tickets avec le checkout_id et le statut pending (route publique)"
      description: "**Cr√©er plusieurs tickets avec paiement** : que je fournis tickets, success_url, cancel_url je re√ßois une r√©ponse 201 la r√©ponse contient un checkout_session_id la r√©ponse contient les tickets cr√©√©s

**Acc√®s public pour cr√©er des tickets avec paiement** : je peux cr√©er des tickets avec paiement

### Sc√©narios de test

**Cr√©er plusieurs tickets avec paiement**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/tickets/payment\"

‚úÖ que je fournis tickets, success_url, cancel_url

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient un checkout_session_id

‚úÖ la r√©ponse contient les tickets cr√©√©s

**Acc√®s public pour cr√©er des tickets avec paiement**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/tickets/payment\"

‚úÖ je peux cr√©er des tickets avec paiement

"
      operationId: "post_museum_tickets_payment"
      parameters:
      responses:
        201:
          description: "Code 201 - que je fournis tickets, success_url, cancel_url, je re√ßois une r√©ponse 201, la r√©ponse contient un checkout_session_id, la r√©ponse contient les tickets cr√©√©s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  checkout_id:
                    type:
                      - string
                    description: "ID du checkout (null si la commande est gratuite)"
                    nullable: true
                  checkout_reference:
                    type:
                      - string
                    description: "R√©f√©rence du checkout (null si la commande est gratuite)"
                    nullable: true
                  checkout_url:
                    type:
                      - string
                    format: "uri"
                    description: "URL de redirection vers la page de paiement (null si la commande est gratuite)"
                    nullable: true
                  tickets:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        qr_code:
                          type: "string"
                        first_name:
                          type:
                            - string
                          nullable: true
                        last_name:
                          type:
                            - string
                          nullable: true
                        email:
                          type: "string"
                        reservation_date:
                          type: "string"
                        slot_start_time:
                          type: "string"
                        slot_end_time:
                          type: "string"
                        checkout_id:
                          type:
                            - string
                          nullable: true
                        checkout_reference:
                          type:
                            - string
                          nullable: true
                        transaction_status:
                          type:
                            - string
                          nullable: true
                        ticket_price:
                          type: "number"
                        donation_amount:
                          type: "number"
                        total_amount:
                          type: "number"
                        status:
                          type: "string"
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        language:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                    description: "Liste des tickets cr√©√©s"
                required:
                  - tickets
              example:
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - tickets
                - success_url
                - cancel_url
              properties:
                email:
                  type: "string"
                  format: "email"
                  maxLength: 255
                  description: "Email commun pour tous les tickets (obligatoire uniquement si tous les tickets sont gratuites, sinon Stripe le r√©cup√®re)"
                first_name:
                  type: "string"
                  maxLength: 255
                  description: "Pr√©nom commun pour tous les tickets (optionnel)"
                last_name:
                  type: "string"
                  maxLength: 255
                  description: "Nom commun pour tous les tickets (optionnel)"
                language:
                  type: "string"
                  maxLength: 10
                  description: "Code de langue commun pour tous les tickets (ex: \"fr\", \"en\", \"es\")"
                tickets:
                  type: "array"
                  minItems: 1
                  items:
                    type: "object"
                    required:
                      - reservation_date
                      - slot_start_time
                      - slot_end_time
                      - ticket_price
                    properties:
                      reservation_date:
                        type: "string"
                        format: "date"
                        description: "Date de r√©servation (format YYYY-MM-DD)"
                      slot_start_time:
                        type: "string"
                        pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                        description: "Heure de d√©but du cr√©neau horaire (format HH:MM:SS)"
                      slot_end_time:
                        type: "string"
                        pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                        description: "Heure de fin du cr√©neau horaire (format HH:MM:SS)"
                      ticket_price:
                        type: "number"
                        minimum: 0
                        description: "Prix du ticket en euros"
                      donation_amount:
                        type: "number"
                        minimum: 0
                        default: 0
                        description: "Montant du don optionnel en euros (0 par d√©faut)"
                      notes:
                        type: "string"
                        description: "Notes libres optionnelles pour ce ticket. Si pricing_info est fourni, il sera automatiquement stock√© dans notes au format JSON avec les notes libres."
                      pricing_info:
                        type: "object"
                        description: "Informations de tarif au moment de la cr√©ation pour ce ticket (sera stock√© dans notes au format JSON). Permet de conserver les informations de tarif pour v√©rification ult√©rieure, notamment pour les membres avec places gratuites."
                        properties:
                          price_id:
                            type:
                              - string
                            format: "uuid"
                            description: "ID du tarif utilis√© (optionnel, peut √™tre null pour les tarifs personnalis√©s)"
                            nullable: true
                          price_name:
                            type:
                              - string
                            description: "Nom du tarif au moment de la cr√©ation (pour r√©f√©rence)"
                            nullable: true
                          price_amount:
                            type: "number"
                            minimum: 0
                            description: "Montant du tarif au moment de la cr√©ation"
                          audience_type:
                            type:
                              - string
                            enum:
                              - public
                              - member
                            description: "Type d'audience"
                            nullable: true
                          requires_proof:
                            type:
                              - boolean
                            description: "Si un justificatif √©tait requis"
                            nullable: true
                          proof_info:
                            type:
                              - object
                            description: "Informations sur le justificatif fourni"
                            properties:
                              type:
                                type:
                                  - string
                                description: "Type de justificatif (ex: \"student_card\", \"senior_card\", \"member_card\")"
                                nullable: true
                              reference:
                                type:
                                  - string
                                description: "R√©f√©rence du justificatif (num√©ro de carte, etc.)"
                                nullable: true
                              uploaded_at:
                                type:
                                  - string
                                format: "date-time"
                                description: "Date d'upload du justificatif (format ISO)"
                                nullable: true
                              verified:
                                type:
                                  - boolean
                                description: "Si le justificatif a √©t√© v√©rifi√©"
                                nullable: true
                              verified_by:
                                type:
                                  - string
                                description: "ID ou nom de la personne qui a v√©rifi√©"
                                nullable: true
                              verified_at:
                                type:
                                  - string
                                format: "date-time"
                                description: "Date de v√©rification (format ISO)"
                                nullable: true
                            nullable: true
                          applied_at:
                            type: "string"
                            format: "date-time"
                            description: "Date d'application du tarif (format ISO). G√©n√©r√©e automatiquement si non fournie."
                        required:
                          - price_amount
                          - applied_at
                  description: "Liste des tickets √† cr√©er (au moins 1 ticket requis)"
                gift_codes:
                  type: "array"
                  items:
                    type: "string"
                    pattern: "^[A-Z0-9]{12}$"
                    description: "Code cadeau (12 caract√®res alphanum√©riques majuscules)"
                  description: "Tableau de codes cadeaux √† utiliser (optionnel). Chaque code offre une place gratuite, appliqu√©e aux tickets les plus chers en premier."
                guided_tour:
                  type: "boolean"
                  default: false
                  description: "true si le visiteur souhaite une visite guid√©e (optionnel, false par d√©faut)"
                guided_tour_price:
                  type: "number"
                  minimum: 0
                  description: "Prix de la visite guid√©e (optionnel, sera r√©cup√©r√© depuis les settings si non fourni). Doit correspondre au tarif configur√© dans les settings."
                currency:
                  type: "string"
                  default: "EUR"
                  description: "Devise pour le paiement (d√©faut: EUR)"
                description:
                  type: "string"
                  description: "Description du paiement (optionnel)"
                success_url:
                  type: "string"
                  format: "uri"
                  description: "URL de redirection apr√®s paiement r√©ussi (obligatoire). Doit contenir {CHECKOUT_SESSION_ID} qui sera remplac√© par Stripe."
                cancel_url:
                  type: "string"
                  format: "uri"
                  description: "URL de redirection en cas d'annulation (obligatoire)"
  /museum/tickets/checkout/:checkoutId:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re tous les tickets associ√©s √† un checkout_id donn√© (route publique)"
      description: "**R√©cup√©rer les tickets par checkout_id** : que des tickets sont associ√©s √† ce checkout_id je re√ßois une r√©ponse 200 la r√©ponse contient un tableau de tickets associ√©s au checkout_id

### Sc√©narios de test

**R√©cup√©rer les tickets par checkout_id**

üìã qu'un checkout_id existe

‚úÖ que des tickets sont associ√©s √† ce checkout_id

‚ö° je fais une requ√™te GET vers \"/museum/tickets/checkout/:checkoutId\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau de tickets associ√©s au checkout_id

"
      operationId: "get_museum_tickets_checkout_:checkoutId"
      parameters:
        - name: "checkoutId"
          in: "path"
          description: "ID du checkout"
          required: true
          schema:
            type: "string"
            description: "ID du checkout"
      responses:
        200:
          description: "Succ√®s - que des tickets sont associ√©s √† ce checkout_id, je re√ßois une r√©ponse 200, la r√©ponse contient un tableau de tickets associ√©s au checkout_id"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    qr_code:
                      type: "string"
                    first_name:
                      type:
                        - string
                      nullable: true
                    last_name:
                      type:
                        - string
                      nullable: true
                    email:
                      type: "string"
                    reservation_date:
                      type: "string"
                    slot_start_time:
                      type: "string"
                    slot_end_time:
                      type: "string"
                    checkout_id:
                      type:
                        - string
                      nullable: true
                    checkout_reference:
                      type:
                        - string
                      nullable: true
                    transaction_status:
                      type:
                        - string
                      nullable: true
                    ticket_price:
                      type: "number"
                    donation_amount:
                      type: "number"
                    total_amount:
                      type: "number"
                    status:
                      type: "string"
                    used_at:
                      type:
                        - string
                      nullable: true
                    notes:
                      type:
                        - string
                      nullable: true
                    language:
                      type:
                        - string
                      nullable: true
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/tickets/stats:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re les statistiques compl√®tes des tickets : nombre total vendus, nombre de la semaine avec r√©partition par jour, total des dons, co√ªt moyen, statistiques par horaire (pour identifier les horaires √† forte influence), statistiques sur les r√©servations group√©es (m√™me checkout_reference), revenus totaux, taux de conversion et r√©partition par statut. R√©serv√© aux r√¥les bureau et dev."
      description: "**R√©cup√©rer les statistiques des tickets** : que des tickets existent je re√ßois une r√©ponse 200 la r√©ponse contient total_tickets_sold, week_tickets_sold, total_donations la r√©ponse contient average_ticket_price, hourly_stats, grouped_reservations

### Sc√©narios de test

**R√©cup√©rer les statistiques des tickets**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ que des tickets existent

‚ö° je fais une requ√™te GET vers \"/museum/tickets/stats\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient total_tickets_sold, week_tickets_sold, total_donations

‚úÖ la r√©ponse contient average_ticket_price, hourly_stats, grouped_reservations

"
      operationId: "get_museum_tickets_stats"
      parameters:
      responses:
        200:
          description: "Succ√®s - que des tickets existent, je re√ßois une r√©ponse 200, la r√©ponse contient total_tickets_sold, week_tickets_sold, total_donations, la r√©ponse contient average_ticket_price, hourly_stats, grouped_reservations"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  tickets_stats:
                    type: "object"
                    properties:
                      total_tickets_sold:
                        type: "number"
                        description: "Nombre total de tickets vendus (status = paid)"
                      week_tickets_sold:
                        type: "number"
                        description: "Nombre de tickets vendus cette semaine"
                      week_tickets_by_day:
                        type: "array"
                        items:
                          type: "object"
                          properties:
                            date:
                              type: "string"
                              description: "Date au format YYYY-MM-DD"
                            day_name:
                              type: "string"
                              description: "Nom du jour (lundi, mardi, etc.)"
                            tickets_count:
                              type: "number"
                              description: "Nombre de tickets vendus ce jour"
                          required:
                            - date
                            - day_name
                            - tickets_count
                        description: "R√©partition des tickets vendus par jour de la semaine"
                      total_donations:
                        type: "number"
                        description: "Total des dons re√ßus sur les tickets pay√©s"
                      average_ticket_price:
                        type: "number"
                        description: "Co√ªt moyen d'un ticket (ticket_price)"
                      hourly_stats:
                        type: "array"
                        items:
                          type: "object"
                          properties:
                            start_time:
                              type: "string"
                              pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                              description: "Heure de d√©but (HH:MM:SS)"
                            tickets_count:
                              type: "number"
                              description: "Nombre de tickets vendus √† cette heure"
                            percentage:
                              type: "number"
                              description: "Pourcentage par rapport au total"
                          required:
                            - start_time
                            - tickets_count
                            - percentage
                        description: "Statistiques par horaire (slot_start_time) pour voir les horaires √† forte influence"
                      grouped_reservations:
                        type: "object"
                        properties:
                          total_checkouts:
                            type: "number"
                            description: "Nombre total de checkout_reference uniques (avec checkout_reference non null)"
                          average_tickets_per_checkout:
                            type: "number"
                            description: "Nombre moyen de tickets par checkout"
                          max_tickets_in_checkout:
                            type: "number"
                            description: "Nombre maximum de tickets dans un seul checkout"
                          checkout_distribution:
                            type: "array"
                            items:
                              type: "object"
                              properties:
                                tickets_count:
                                  type: "number"
                                  description: "Nombre de tickets dans le checkout"
                                checkouts_count:
                                  type: "number"
                                  description: "Nombre de checkouts avec ce nombre de tickets"
                              required:
                                - tickets_count
                                - checkouts_count
                            description: "Distribution du nombre de tickets par checkout"
                        required:
                          - total_checkouts
                          - average_tickets_per_checkout
                          - max_tickets_in_checkout
                          - checkout_distribution
                        description: "Statistiques sur les r√©servations group√©es (m√™me checkout_reference)"
                      total_revenue:
                        type: "number"
                        description: "Total des revenus (ticket_price + donation_amount) pour les tickets pay√©s"
                      conversion_rate:
                        type: "number"
                        description: "Taux de conversion (paid / (paid + pending)) en pourcentage"
                      status_distribution:
                        type: "object"
                        properties:
                          paid:
                            type: "number"
                            description: "Nombre de tickets pay√©s"
                          pending:
                            type: "number"
                            description: "Nombre de tickets en attente"
                          cancelled:
                            type: "number"
                            description: "Nombre de tickets annul√©s"
                          used:
                            type: "number"
                            description: "Nombre de tickets utilis√©s"
                          expired:
                            type: "number"
                            description: "Nombre de tickets expir√©s"
                        required:
                          - paid
                          - pending
                          - cancelled
                          - used
                          - expired
                        description: "R√©partition par statut"
                    required:
                      - total_tickets_sold
                      - week_tickets_sold
                      - week_tickets_by_day
                      - total_donations
                      - average_ticket_price
                      - hourly_stats
                      - grouped_reservations
                      - total_revenue
                      - conversion_rate
                      - status_distribution
                required:
                  - tickets_stats
              example:
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/tickets/weekly-slots-stats:
    get:
      tags:
        - Mus√©e - Tickets
      summary: "R√©cup√®re les statistiques des cr√©neaux horaires pour la semaine courante : pour chaque jour et start_time, nombre de personnes attendues et pourcentage d‚Äôoccupation par rapport √† la capacit√©"
      description: "**R√©cup√©rer les statistiques des cr√©neaux de la semaine** : je re√ßois une r√©ponse 200 la r√©ponse contient week_start, week_end, slots_stats, daily_totals

### Sc√©narios de test

**R√©cup√©rer les statistiques des cr√©neaux de la semaine**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te GET vers \"/museum/tickets/weekly-slots-stats\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient week_start, week_end, slots_stats, daily_totals

"
      operationId: "get_museum_tickets_weekly-slots-stats"
      parameters:
      responses:
        200:
          description: "Succ√®s - je re√ßois une r√©ponse 200, la r√©ponse contient week_start, week_end, slots_stats, daily_totals"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  week_start:
                    type: "string"
                    format: "date"
                    description: "Date du lundi de la semaine courante (YYYY-MM-DD)"
                  week_end:
                    type: "string"
                    format: "date"
                    description: "Date du dimanche de la semaine courante (YYYY-MM-DD)"
                  slots_stats:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        date:
                          type: "string"
                          format: "date"
                          description: "Date du cr√©neau (YYYY-MM-DD)"
                        day_name:
                          type: "string"
                          description: "Nom du jour (lundi, mardi, etc.)"
                        start_time:
                          type: "string"
                          pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                          description: "Heure de d√©but du cr√©neau (HH:MM:SS)"
                        end_time:
                          type: "string"
                          pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                          description: "Heure de fin du cr√©neau (HH:MM:SS)"
                        expected_people:
                          type: "number"
                          description: "Nombre de personnes attendues (tickets pending + paid)"
                        capacity:
                          type: "number"
                          description: "Capacit√© maximale du cr√©neau (setting capacity)"
                        occupancy_percentage:
                          type: "number"
                          description: "Pourcentage d'occupation (0-100)"
                        is_half_price:
                          type: "boolean"
                          description: "true si le cr√©neau est incomplet (demi-tarif)"
                      required:
                        - date
                        - day_name
                        - start_time
                        - end_time
                        - expected_people
                        - capacity
                        - occupancy_percentage
                        - is_half_price
                    description: "Statistiques des cr√©neaux horaires pour chaque jour de la semaine courante (jauge horaire : un ticket compte pour chaque heure o√π il est pr√©sent)"
                  daily_totals:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        date:
                          type: "string"
                          format: "date"
                          description: "Date du jour (YYYY-MM-DD)"
                        day_name:
                          type: "string"
                          description: "Nom du jour (lundi, mardi, etc.)"
                        total_unique_tickets:
                          type: "number"
                          description: "Nombre unique de tickets attendus dans la journ√©e (sans double comptage, pour distinguer du nombre de pr√©sences horaires)"
                      required:
                        - date
                        - day_name
                        - total_unique_tickets
                    description: "Total unique de tickets par jour (pour distinguer du nombre de pr√©sences horaires dans slots_stats)"
                required:
                  - week_start
                  - week_end
                  - slots_stats
                  - daily_totals
              example:
                week_start: "exemple_week_start"
                week_end: "exemple_week_end"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/slots:
    get:
      tags:
        - Mus√©e - Cr√©neaux
      summary: "R√©cup√®re les cr√©neaux horaires disponibles pour une date donn√©e avec leurs capacit√©s et taux d'occupation (route publique)"
      description: "**Erreur si le param√®tre date est manquant** : je re√ßois une r√©ponse 400 la r√©ponse contient un message d'erreur \"Le param√®tre date est requis\"

### Sc√©narios de test

**Erreur si le param√®tre date est manquant**

‚ö° je fais une requ√™te GET vers \"/museum/slots\"

‚úÖ je re√ßois une r√©ponse 400

‚úÖ la r√©ponse contient un message d'erreur \"Le param√®tre date est requis\"

"
      operationId: "get_museum_slots"
      parameters:
        - name: "date"
          in: "query"
          description: "Date au format YYYY-MM-DD (ex: 2025-12-23)"
          required: true
          schema:
            type: "string"
            pattern: "^\d{4}-\d{2}-\d{2}$"
            description: "Date au format YYYY-MM-DD (ex: 2025-12-23)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  date:
                    type: "string"
                    description: "Date au format YYYY-MM-DD"
                  slots:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        start_time:
                          type: "string"
                          description: "Heure de d√©but du cr√©neau (HH:MM:SS)"
                        end_time:
                          type: "string"
                          description: "Heure de fin du cr√©neau (HH:MM:SS)"
                        capacity:
                          type: "number"
                          description: "Capacit√© maximale du cr√©neau"
                        booked:
                          type: "number"
                          description: "Nombre de tickets r√©serv√©s pour ce cr√©neau"
                        available:
                          type: "number"
                          description: "Nombre de places disponibles"
                        occupancy_percentage:
                          type: "number"
                          description: "Pourcentage d'occupation (0-100)"
                        is_half_price:
                          type: "boolean"
                          description: "true si le cr√©neau est incomplet (demi-tarif), false si complet (plein tarif)"
                      required:
                        - start_time
                        - end_time
                        - capacity
                        - booked
                        - available
                        - occupancy_percentage
                        - is_half_price
                  total_capacity:
                    type: "number"
                    description: "Capacit√© totale de la journ√©e"
                  total_booked:
                    type: "number"
                    description: "Nombre total de tickets r√©serv√©s"
                  total_available:
                    type: "number"
                    description: "Nombre total de places disponibles"
                required:
                  - date
                  - slots
                  - total_capacity
                  - total_booked
                  - total_available
              example: null
          headers: null
        400:
          description: "Code 400 - je re√ßois une r√©ponse 400, la r√©ponse contient un message d'erreur \"Le param√®tre date est requis\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/donation-proof/generate:
    get:
      tags:
        - Mus√©e - Certificats de don
      summary: "G√©n√®re et t√©l√©charge un certificat de don CERFA 11580 en PDF pour un ticket donn√©. Le ticket doit contenir un don (donation_amount > 0). Les param√®tres address, postal_code et city sont optionnels et permettent de compl√©ter les informations du donateur."
      description: "**Erreur si ticket_id est manquant** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer \"ticket_id est requis\"

### Sc√©narios de test

**Erreur si ticket_id est manquant**

üìã que je suis authentifi√©

‚ö° je fais une requ√™te GET vers \"/museum/donation-proof/generate\"

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer \"ticket_id est requis\"

"
      operationId: "get_museum_donation-proof_generate"
      parameters:
        - name: "ticket_id"
          in: "query"
          description: "ID du ticket pour lequel g√©n√©rer le certificat de don"
          required: true
          schema:
            type: "string"
            description: "ID du ticket pour lequel g√©n√©rer le certificat de don"
        - name: "address"
          in: "query"
          description: "Adresse du donateur (optionnel)"
          required: false
          schema:
            type: "string"
            description: "Adresse du donateur (optionnel)"
        - name: "postal_code"
          in: "query"
          description: "Code postal du donateur (optionnel)"
          required: false
          schema:
            type: "string"
            description: "Code postal du donateur (optionnel)"
        - name: "city"
          in: "query"
          description: "Ville du donateur (optionnel)"
          required: false
          schema:
            type: "string"
            description: "Ville du donateur (optionnel)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                description: "PDF du certificat de don"
                content:
                  application/pdf:
                    schema:
                      type: "string"
                      format: "binary"
              example: null
          headers: null
        400:
          description: "Code 400 - je devrais recevoir une erreur 400, le message d'erreur devrait indiquer \"ticket_id est requis\""
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/gift-codes/packs:
    post:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Cr√©e un pack de codes cadeaux. Chaque code offre une place gratuite. Les codes peuvent √™tre cr√©√©s en lot pour faciliter la distribution (ex: pour un influenceur)."
      description: "**Cr√©ation d'un pack de codes cadeaux** : je devrais recevoir un pack_id et une liste de codes le nombre de codes devrait correspondre √† la quantit√© demand√©e

**Cr√©ation d'un pack avec date d'expiration** : je devrais recevoir un pack avec des codes ayant la date d'expiration sp√©cifi√©e

**Erreur si la quantit√© est invalide** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer que la quantit√© doit √™tre sup√©rieure √† 0

**Erreur si la quantit√© d√©passe 1000** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer que la quantit√© ne peut pas d√©passer 1000

**Acc√®s refus√© pour la cr√©ation de pack sans authentification** : je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Non authentifi√©\"

**Acc√®s refus√© pour les r√¥les non autoris√©s** : je devrais recevoir une erreur 403 le message d'erreur devrait indiquer \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©ation d'un pack de codes cadeaux**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/packs\" avec une quantit√©

‚úÖ je devrais recevoir un pack_id et une liste de codes

‚úÖ le nombre de codes devrait correspondre √† la quantit√© demand√©e

**Cr√©ation d'un pack avec date d'expiration**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/packs\" avec une quantit√© et une date d'expiration

‚úÖ je devrais recevoir un pack avec des codes ayant la date d'expiration sp√©cifi√©e

**Erreur si la quantit√© est invalide**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/packs\" avec une quantit√© <= 0

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer que la quantit√© doit √™tre sup√©rieure √† 0

**Erreur si la quantit√© d√©passe 1000**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/packs\" avec une quantit√© > 1000

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer que la quantit√© ne peut pas d√©passer 1000

**Acc√®s refus√© pour la cr√©ation de pack sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/packs\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ le message d'erreur devrait indiquer \"Non authentifi√©\"

**Acc√®s refus√© pour les r√¥les non autoris√©s**

üìã que je suis authentifi√© avec un r√¥le non autoris√©

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/packs\"

‚úÖ je devrais recevoir une erreur 403

‚úÖ le message d'erreur devrait indiquer \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_gift-codes_packs"
      parameters:
      responses:
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  pack_id:
                    type: "string"
                  codes:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        code:
                          type: "string"
                        status:
                          type: "string"
                          enum:
                            - unused
                            - used
                            - expired
                        ticket_id:
                          type:
                            - string
                          nullable: true
                        pack_id:
                          type:
                            - string
                          nullable: true
                        recipient_email:
                          type:
                            - string
                          nullable: true
                        expires_at:
                          type:
                            - string
                          nullable: true
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  quantity:
                    type: "integer"
              example: null
          headers: null
        400:
          description: "Code 400 - je devrais recevoir une erreur 400, le message d'erreur devrait indiquer que la quantit√© doit √™tre sup√©rieure √† 0"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - quantity
              properties:
                quantity:
                  type: "integer"
                  minimum: 1
                  maximum: 1000
                  description: "Nombre de codes cadeaux √† cr√©er"
                pack_name:
                  type: "string"
                  maxLength: 255
                  description: "Nom du pack (optionnel)"
                expires_at:
                  type: "string"
                  format: "date-time"
                  description: "Date d'expiration des codes (optionnelle, format ISO)"
                notes:
                  type: "string"
                  description: "Notes optionnelles pour le pack"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "R√©cup√®re la liste pagin√©e des packs de codes cadeaux avec leurs codes associ√©s. Permet de rechercher un pack par code (param√®tre `code`). Retourne les statistiques de chaque pack (nombre de codes, utilis√©s, non utilis√©s, expir√©s)."
      description: "**R√©cup√©ration des packs de codes cadeaux** : je devrais recevoir une liste pagin√©e de packs avec leurs codes associ√©s chaque pack devrait contenir les statistiques (unused_count, used_count, expired_count)

### Sc√©narios de test

**R√©cup√©ration des packs de codes cadeaux**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te GET vers \"/museum/gift-codes/packs\"

‚úÖ je devrais recevoir une liste pagin√©e de packs avec leurs codes associ√©s

‚úÖ chaque pack devrait contenir les statistiques (unused_count, used_count, expired_count)

"
      operationId: "get_museum_gift-codes_packs"
      parameters:
        - name: "code"
          in: "query"
          description: "Rechercher un code sp√©cifique (retourne le pack qui le contient)"
          required: false
          schema:
            type: "string"
            pattern: "^[A-Z0-9]{12}$"
            description: "Rechercher un code sp√©cifique (retourne le pack qui le contient)"
        - name: "page"
          in: "query"
          description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
            description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
        - name: "limit"
          in: "query"
          description: "Nombre d'√©l√©ments par page (par d√©faut 50)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 50
            description: "Nombre d'√©l√©ments par page (par d√©faut 50)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  packs:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        pack_id:
                          type: "string"
                        codes:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              id:
                                type: "string"
                              code:
                                type: "string"
                              status:
                                type: "string"
                                enum:
                                  - unused
                                  - used
                                  - expired
                              ticket_id:
                                type:
                                  - string
                                nullable: true
                              pack_id:
                                type:
                                  - string
                                nullable: true
                              recipient_email:
                                type:
                                  - string
                                nullable: true
                              expires_at:
                                type:
                                  - string
                                nullable: true
                              used_at:
                                type:
                                  - string
                                nullable: true
                              notes:
                                type:
                                  - string
                                nullable: true
                              created_at:
                                type: "string"
                              updated_at:
                                type: "string"
                        codes_count:
                          type: "integer"
                        unused_count:
                          type: "integer"
                        used_count:
                          type: "integer"
                        expired_count:
                          type: "integer"
                        created_at:
                          type: "string"
                  total:
                    type: "integer"
                  page:
                    type: "integer"
                  limit:
                    type: "integer"
                  totalPages:
                    type: "integer"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/gift-codes/distribute:
    post:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Distribue des codes cadeaux par email. Permet d'envoyer un lot de codes √† un destinataire (ex: influenceur). Les codes sont associ√©s √† l'email du destinataire."
      description: "**Distribution de codes par email** : qu'un pack de codes existe les codes devraient √™tre associ√©s √† l'email du destinataire un email devrait √™tre envoy√© au destinataire avec les codes

**Erreur si certains codes n'existent pas lors de la distribution** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer que certains codes n'existent pas

**Erreur si certains codes sont d√©j√† utilis√©s lors de la distribution** : que certains codes sont d√©j√† utilis√©s je devrais recevoir une erreur 400 le message d'erreur devrait indiquer quels codes sont d√©j√† utilis√©s

### Sc√©narios de test

**Distribution de codes par email**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'un pack de codes existe

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/distribute\" avec des code_ids et un recipient_email

‚úÖ les codes devraient √™tre associ√©s √† l'email du destinataire

‚úÖ un email devrait √™tre envoy√© au destinataire avec les codes

**Erreur si certains codes n'existent pas lors de la distribution**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/distribute\" avec des code_ids invalides

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer que certains codes n'existent pas

**Erreur si certains codes sont d√©j√† utilis√©s lors de la distribution**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ que certains codes sont d√©j√† utilis√©s

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/distribute\" avec ces codes

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer quels codes sont d√©j√† utilis√©s

"
      operationId: "post_museum_gift-codes_distribute"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  message:
                    type: "string"
                  codes_sent:
                    type: "integer"
              example: null
          headers: null
        400:
          description: "Code 400 - je devrais recevoir une erreur 400, le message d'erreur devrait indiquer que certains codes n'existent pas"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - code_ids
                - recipient_email
              properties:
                code_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  minItems: 1
                  description: "IDs des codes cadeaux √† distribuer"
                recipient_email:
                  type: "string"
                  format: "email"
                  description: "Email du destinataire"
                subject:
                  type: "string"
                  description: "Sujet de l'email (optionnel)"
                message:
                  type: "string"
                  description: "Message personnalis√© (optionnel)"
                language:
                  type: "string"
                  enum:
                    - fr
                    - en
                  default: "fr"
                  description: "Langue de l'email"
      security:
        - cookieAuth:
  /museum/gift-codes:
    get:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "R√©cup√®re la liste des codes cadeaux avec pagination et filtres optionnels (statut, pack, destinataire, ticket associ√©)."
      description: "**R√©cup√©ration des codes cadeaux avec filtres** : je devrais recevoir une liste pagin√©e de codes correspondant aux filtres

### Sc√©narios de test

**R√©cup√©ration des codes cadeaux avec filtres**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚ö° je fais une requ√™te GET vers \"/museum/gift-codes\" avec des param√®tres de filtre

‚úÖ je devrais recevoir une liste pagin√©e de codes correspondant aux filtres

"
      operationId: "get_museum_gift-codes"
      parameters:
        - name: "status"
          in: "query"
          description: "Filtrer par statut"
          required: false
          schema:
            type: "string"
            enum:
              - unused
              - used
              - expired
            description: "Filtrer par statut"
        - name: "pack_id"
          in: "query"
          description: "Filtrer par pack"
          required: false
          schema:
            type: "string"
            format: "uuid"
            description: "Filtrer par pack"
        - name: "recipient_email"
          in: "query"
          description: "Filtrer par destinataire"
          required: false
          schema:
            type: "string"
            format: "email"
            description: "Filtrer par destinataire"
        - name: "ticket_id"
          in: "query"
          description: "Filtrer par ticket"
          required: false
          schema:
            type: "string"
            format: "uuid"
            description: "Filtrer par ticket"
        - name: "page"
          in: "query"
          description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
            description: "Num√©ro de page (commence √† 1, par d√©faut 1)"
        - name: "limit"
          in: "query"
          description: "Nombre d'√©l√©ments par page (par d√©faut 100)"
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 100
            description: "Nombre d'√©l√©ments par page (par d√©faut 100)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  codes:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        code:
                          type: "string"
                        status:
                          type: "string"
                          enum:
                            - unused
                            - used
                            - expired
                        ticket_id:
                          type:
                            - string
                          nullable: true
                        pack_id:
                          type:
                            - string
                          nullable: true
                        recipient_email:
                          type:
                            - string
                          nullable: true
                        expires_at:
                          type:
                            - string
                          nullable: true
                        used_at:
                          type:
                            - string
                          nullable: true
                        notes:
                          type:
                            - string
                          nullable: true
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  total:
                    type: "integer"
                  page:
                    type: "integer"
                  limit:
                    type: "integer"
                  totalPages:
                    type: "integer"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/gift-codes/validate/:code:
    get:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Valide un code cadeau (route publique). V√©rifie que le code existe, n'est pas utilis√© et n'est pas expir√©. Permet au frontend de valider un code avant de l'utiliser dans une commande."
      description: ""
      operationId: "get_museum_gift-codes_validate_:code"
      parameters:
        - name: "code"
          in: "path"
          description: "Code cadeau √† valider (12 caract√®res alphanum√©riques majuscules)"
          required: true
          schema:
            type: "string"
            pattern: "^[A-Z0-9]{12}$"
            description: "Code cadeau √† valider (12 caract√®res alphanum√©riques majuscules)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  code:
                    type: "string"
                  status:
                    type: "string"
                    enum:
                      - unused
                      - used
                      - expired
                  ticket_id:
                    type:
                      - string
                    nullable: true
                  pack_id:
                    type:
                      - string
                    nullable: true
                  recipient_email:
                    type:
                      - string
                    nullable: true
                  expires_at:
                    type:
                      - string
                    nullable: true
                  used_at:
                    type:
                      - string
                    nullable: true
                  notes:
                    type:
                      - string
                    nullable: true
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
  /museum/gift-codes/purchase:
    post:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Cr√©e une session de paiement Stripe pour acheter des codes cadeaux (route publique). Utilise le setting gift_code_price comme prix unitaire et retourne checkout_id + checkout_url."
      description: "**Achat public de codes cadeaux** : je devrais recevoir un checkout_id et un checkout_url une session Stripe devrait √™tre cr√©√©e

**Erreur si la quantit√© d'achat est invalide** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer que la quantit√© doit √™tre au moins 1

**Erreur si la quantit√© d'achat d√©passe 100** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer que la quantit√© maximale est 100

### Sc√©narios de test

**Achat public de codes cadeaux**

üìã que le prix des codes cadeaux est configur√©

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/purchase\" avec une quantit√© et un email

‚úÖ je devrais recevoir un checkout_id et un checkout_url

‚úÖ une session Stripe devrait √™tre cr√©√©e

**Erreur si la quantit√© d'achat est invalide**

üìã que le prix des codes cadeaux est configur√©

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/purchase\" avec une quantit√© <= 0

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer que la quantit√© doit √™tre au moins 1

**Erreur si la quantit√© d'achat d√©passe 100**

üìã que le prix des codes cadeaux est configur√©

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/purchase\" avec une quantit√© > 100

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer que la quantit√© maximale est 100

"
      operationId: "post_museum_gift-codes_purchase"
      parameters:
      responses:
        201:
          description: "Code 201"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  checkout_id:
                    type: "string"
                  checkout_url:
                    type: "string"
                required:
                  - checkout_id
                  - checkout_url
              example: null
          headers: null
        400:
          description: "Code 400 - je devrais recevoir une erreur 400, le message d'erreur devrait indiquer que la quantit√© doit √™tre au moins 1"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - quantity
                - email
                - success_url
                - cancel_url
              properties:
                quantity:
                  type: "integer"
                  minimum: 1
                  maximum: 100
                  description: "Nombre de codes cadeaux √† acheter"
                email:
                  type: "string"
                  format: "email"
                  description: "Email de l'acheteur / destinataire"
                language:
                  type: "string"
                  enum:
                    - fr
                    - en
                  default: "fr"
                  description: "Langue de l'email de confirmation"
                success_url:
                  type: "string"
                  format: "uri"
                  description: "URL de redirection apr√®s paiement r√©ussi"
                cancel_url:
                  type: "string"
                  format: "uri"
                  description: "URL de redirection en cas d'annulation"
  /museum/gift-codes/purchase/confirm:
    post:
      tags:
        - Mus√©e - Codes cadeaux
      summary: "Confirme un achat de codes cadeaux apr√®s paiement Stripe (route publique). V√©rifie la session, g√©n√®re un pack de codes et les envoie par email √† l'acheteur."
      description: "**Confirmation d'un achat apr√®s paiement** : un pack de codes devrait √™tre cr√©√© un email devrait √™tre envoy√© √† l'acheteur avec les codes les codes devraient √™tre associ√©s √† l'email de l'acheteur

**Erreur si le paiement n'est pas confirm√©** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer que le paiement n'est pas confirm√©

### Sc√©narios de test

**Confirmation d'un achat apr√®s paiement**

üìã qu'une session de paiement existe avec payment_status = paid

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/purchase/confirm\" avec le checkout_id

‚úÖ un pack de codes devrait √™tre cr√©√©

‚úÖ un email devrait √™tre envoy√© √† l'acheteur avec les codes

‚úÖ les codes devraient √™tre associ√©s √† l'email de l'acheteur

**Erreur si le paiement n'est pas confirm√©**

üìã qu'une session de paiement existe avec payment_status != paid

‚ö° je fais une requ√™te POST vers \"/museum/gift-codes/purchase/confirm\" avec le checkout_id

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer que le paiement n'est pas confirm√©

"
      operationId: "post_museum_gift-codes_purchase_confirm"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  pack_id:
                    type: "string"
                  codes:
                    type: "array"
                    items:
                      type: "string"
                required:
                  - pack_id
                  - codes
              example: null
          headers: null
        400:
          description: "Code 400 - je devrais recevoir une erreur 400, le message d'erreur devrait indiquer que le paiement n'est pas confirm√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - checkout_id
              properties:
                checkout_id:
                  type: "string"
                  description: "ID de la session Stripe √† confirmer"
  /museum/special-periods:
    post:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "Cr√©e une p√©riode sp√©ciale (vacances scolaires ou fermeture). Les p√©riodes de vacances permettent d'afficher automatiquement les horaires avec audience_type=\"holiday\" en plus des horaires publics. Les p√©riodes de fermeture masquent les horaires normaux."
      description: "**Cr√©er une p√©riode de vacances** : que je fournis type=\"holiday\", start_date, end_date, name, zone je re√ßois une r√©ponse 201 la r√©ponse contient la p√©riode cr√©√©e avec un id la r√©ponse contient type, start_date, end_date, name, zone, is_active

**Cr√©er une p√©riode de fermeture** : que je fournis type=\"closure\", start_date, end_date, name je re√ßois une r√©ponse 201 la r√©ponse contient la p√©riode cr√©√©e avec type=\"closure\"

**Erreur si la date de fin est ant√©rieure √† la date de d√©but** : que je fournis start_date=\"2024-12-25\" et end_date=\"2024-12-24\" je re√ßois une r√©ponse 500 la r√©ponse contient un message d'erreur indiquant que la date de fin doit √™tre sup√©rieure ou √©gale √† la date de d√©but

**Acc√®s non autoris√© pour cr√©er une p√©riode sans authentification** : je re√ßois une r√©ponse 401 la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er une p√©riode sans les r√¥les requis** : je re√ßois une r√©ponse 403 la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Cr√©er une p√©riode de vacances**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/special-periods\"

‚úÖ que je fournis type=\"holiday\", start_date, end_date, name, zone

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient la p√©riode cr√©√©e avec un id

‚úÖ la r√©ponse contient type, start_date, end_date, name, zone, is_active

**Cr√©er une p√©riode de fermeture**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/special-periods\"

‚úÖ que je fournis type=\"closure\", start_date, end_date, name

‚úÖ je re√ßois une r√©ponse 201

‚úÖ la r√©ponse contient la p√©riode cr√©√©e avec type=\"closure\"

**Erreur si la date de fin est ant√©rieure √† la date de d√©but**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/special-periods\"

‚úÖ que je fournis start_date=\"2024-12-25\" et end_date=\"2024-12-24\"

‚úÖ je re√ßois une r√©ponse 500

‚úÖ la r√©ponse contient un message d'erreur indiquant que la date de fin doit √™tre sup√©rieure ou √©gale √† la date de d√©but

**Acc√®s non autoris√© pour cr√©er une p√©riode sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/special-periods\"

‚úÖ je re√ßois une r√©ponse 401

‚úÖ la r√©ponse contient un message d'erreur \"Non authentifi√©\"

**Acc√®s non autoris√© pour cr√©er une p√©riode sans les r√¥les requis**

üìã que je suis authentifi√© mais sans les r√¥les bureau ou dev

‚ö° je fais une requ√™te POST vers \"/museum/special-periods\"

‚úÖ je re√ßois une r√©ponse 403

‚úÖ la r√©ponse contient un message d'erreur \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "post_museum_special-periods"
      parameters:
      responses:
        201:
          description: "Code 201 - que je fournis type=\"holiday\", start_date, end_date, name, zone, je re√ßois une r√©ponse 201, la r√©ponse contient la p√©riode cr√©√©e avec un id, la r√©ponse contient type, start_date, end_date, name, zone, is_active"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                    enum:
                      - holiday
                      - closure
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  name:
                    type:
                      - string
                    nullable: true
                  description:
                    type:
                      - string
                    nullable: true
                  zone:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                type: "exemple_type"
                start_date: "exemple_start_date"
                end_date: "exemple_end_date"
                is_active: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        400:
          description: "Code 400"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur - que je fournis start_date=\"2024-12-25\" et end_date=\"2024-12-24\", je re√ßois une r√©ponse 500, la r√©ponse contient un message d'erreur indiquant que la date de fin doit √™tre sup√©rieure ou √©gale √† la date de d√©but"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - type
                - start_date
                - end_date
              properties:
                type:
                  type: "string"
                  enum:
                    - holiday
                    - closure
                  description: "Type de p√©riode : holiday (vacances) ou closure (fermeture)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin (format YYYY-MM-DD)"
                name:
                  type: "string"
                  maxLength: 255
                  description: "Nom de la p√©riode (ex: \"Vacances de No√´l 2024\")"
                description:
                  type: "string"
                  description: "Description optionnelle"
                zone:
                  type: "string"
                  maxLength: 50
                  description: "Zone pour les vacances scolaires (ex: \"A\", \"B\", \"C\", \"all\"). Null pour les fermetures."
                is_active:
                  type: "boolean"
                  default: true
                  description: "Indique si la p√©riode est active"
      security:
        - cookieAuth:
    get:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "R√©cup√®re la liste des p√©riodes sp√©ciales (vacances et fermetures) avec filtres optionnels (type, date, zone). Permet de v√©rifier si une date est dans une p√©riode sp√©ciale."
      description: "**R√©cup√©rer toutes les p√©riodes sp√©ciales** : que des p√©riodes sp√©ciales existent je re√ßois une r√©ponse 200 la r√©ponse contient un tableau de p√©riodes sp√©ciales

### Sc√©narios de test

**R√©cup√©rer toutes les p√©riodes sp√©ciales**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ que des p√©riodes sp√©ciales existent

‚ö° je fais une requ√™te GET vers \"/museum/special-periods\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient un tableau de p√©riodes sp√©ciales

"
      operationId: "get_museum_special-periods"
      parameters:
        - name: "type"
          in: "query"
          description: "Filtrer par type"
          required: false
          schema:
            type: "string"
            enum:
              - holiday
              - closure
            description: "Filtrer par type"
        - name: "date"
          in: "query"
          description: "V√©rifier si une date est dans une p√©riode sp√©ciale (format YYYY-MM-DD)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "V√©rifier si une date est dans une p√©riode sp√©ciale (format YYYY-MM-DD)"
        - name: "zone"
          in: "query"
          description: "Filtrer par zone (pour les vacances scolaires)"
          required: false
          schema:
            type: "string"
            description: "Filtrer par zone (pour les vacances scolaires)"
        - name: "is_active"
          in: "query"
          description: "Filtrer par statut actif"
          required: false
          schema:
            type: "boolean"
            description: "Filtrer par statut actif"
      responses:
        200:
          description: "Succ√®s - que des p√©riodes sp√©ciales existent, je re√ßois une r√©ponse 200, la r√©ponse contient un tableau de p√©riodes sp√©ciales"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    type:
                      type: "string"
                      enum:
                        - holiday
                        - closure
                    start_date:
                      type: "string"
                    end_date:
                      type: "string"
                    name:
                      type:
                        - string
                      nullable: true
                    description:
                      type:
                        - string
                      nullable: true
                    zone:
                      type:
                        - string
                      nullable: true
                    is_active:
                      type: "boolean"
                    created_at:
                      type: "string"
                    updated_at:
                      type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/special-periods/:id:
    get:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "R√©cup√®re une p√©riode sp√©ciale par son ID."
      description: "**R√©cup√©rer une p√©riode sp√©ciale par ID** : qu'une p√©riode sp√©ciale existe avec un ID sp√©cifique je re√ßois une r√©ponse 200 la r√©ponse contient la p√©riode avec l'ID demand√©

### Sc√©narios de test

**R√©cup√©rer une p√©riode sp√©ciale par ID**

üìã que je suis authentifi√© avec un r√¥le bureau, dev ou museum

‚úÖ qu'une p√©riode sp√©ciale existe avec un ID sp√©cifique

‚ö° je fais une requ√™te GET vers \"/museum/special-periods/:id\"

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient la p√©riode avec l'ID demand√©

"
      operationId: "get_museum_special-periods_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de la p√©riode sp√©ciale"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de la p√©riode sp√©ciale"
      responses:
        200:
          description: "Succ√®s - qu'une p√©riode sp√©ciale existe avec un ID sp√©cifique, je re√ßois une r√©ponse 200, la r√©ponse contient la p√©riode avec l'ID demand√©"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                    enum:
                      - holiday
                      - closure
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  name:
                    type:
                      - string
                    nullable: true
                  description:
                    type:
                      - string
                    nullable: true
                  zone:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                type: "exemple_type"
                start_date: "exemple_start_date"
                end_date: "exemple_end_date"
                is_active: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "Met √† jour une p√©riode sp√©ciale (vacances ou fermeture)."
      description: "**Mettre √† jour une p√©riode sp√©ciale** : qu'une p√©riode sp√©ciale existe que je fournis de nouvelles valeurs pour name et description je re√ßois une r√©ponse 200 la r√©ponse contient la p√©riode mise √† jour

**Erreur si la date de fin est ant√©rieure √† la date de d√©but lors de la mise √† jour** : qu'une p√©riode sp√©ciale existe que je fournis start_date=\"2024-12-25\" et end_date=\"2024-12-24\" je re√ßois une r√©ponse 500 la r√©ponse contient un message d'erreur indiquant que la date de fin doit √™tre sup√©rieure ou √©gale √† la date de d√©but

### Sc√©narios de test

**Mettre √† jour une p√©riode sp√©ciale**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'une p√©riode sp√©ciale existe

‚ö° je fais une requ√™te PUT vers \"/museum/special-periods/:id\"

‚úÖ que je fournis de nouvelles valeurs pour name et description

‚úÖ je re√ßois une r√©ponse 200

‚úÖ la r√©ponse contient la p√©riode mise √† jour

**Erreur si la date de fin est ant√©rieure √† la date de d√©but lors de la mise √† jour**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'une p√©riode sp√©ciale existe

‚ö° je fais une requ√™te PUT vers \"/museum/special-periods/:id\"

‚úÖ que je fournis start_date=\"2024-12-25\" et end_date=\"2024-12-24\"

‚úÖ je re√ßois une r√©ponse 500

‚úÖ la r√©ponse contient un message d'erreur indiquant que la date de fin doit √™tre sup√©rieure ou √©gale √† la date de d√©but

"
      operationId: "put_museum_special-periods_:id"
      parameters:
      responses:
        200:
          description: "Succ√®s - qu'une p√©riode sp√©ciale existe, que je fournis de nouvelles valeurs pour name et description, je re√ßois une r√©ponse 200, la r√©ponse contient la p√©riode mise √† jour"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                    enum:
                      - holiday
                      - closure
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  name:
                    type:
                      - string
                    nullable: true
                  description:
                    type:
                      - string
                    nullable: true
                  zone:
                    type:
                      - string
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example:
                id: "exemple_id"
                type: "exemple_type"
                start_date: "exemple_start_date"
                end_date: "exemple_end_date"
                is_active: true
                created_at: "exemple_created_at"
                updated_at: "exemple_updated_at"
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur - qu'une p√©riode sp√©ciale existe, que je fournis start_date=\"2024-12-25\" et end_date=\"2024-12-24\", je re√ßois une r√©ponse 500, la r√©ponse contient un message d'erreur indiquant que la date de fin doit √™tre sup√©rieure ou √©gale √† la date de d√©but"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example:
                error: "exemple_error"
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                type:
                  type: "string"
                  enum:
                    - holiday
                    - closure
                  description: "Type de p√©riode : holiday (vacances) ou closure (fermeture)"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but (format YYYY-MM-DD)"
                end_date:
                  type: "string"
                  format: "date"
                  description: "Date de fin (format YYYY-MM-DD)"
                name:
                  type:
                    - string
                  maxLength: 255
                  description: "Nom de la p√©riode"
                  nullable: true
                description:
                  type:
                    - string
                  description: "Description optionnelle"
                  nullable: true
                zone:
                  type:
                    - string
                  maxLength: 50
                  description: "Zone pour les vacances scolaires"
                  nullable: true
                is_active:
                  type: "boolean"
                  description: "Indique si la p√©riode est active"
      security:
        - cookieAuth:
    delete:
      tags:
        - Mus√©e - P√©riodes sp√©ciales
      summary: "Supprime une p√©riode sp√©ciale."
      description: "**Supprimer une p√©riode sp√©ciale** : qu'une p√©riode sp√©ciale existe je re√ßois une r√©ponse 204 la p√©riode est supprim√©e de la base de donn√©es

### Sc√©narios de test

**Supprimer une p√©riode sp√©ciale**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'une p√©riode sp√©ciale existe

‚ö° je fais une requ√™te DELETE vers \"/museum/special-periods/:id\"

‚úÖ je re√ßois une r√©ponse 204

‚úÖ la p√©riode est supprim√©e de la base de donn√©es

"
      operationId: "delete_museum_special-periods_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de la p√©riode sp√©ciale"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de la p√©riode sp√©ciale"
      responses:
        204:
          description: "Code 204 - qu'une p√©riode sp√©ciale existe, je re√ßois une r√©ponse 204, la p√©riode est supprim√©e de la base de donn√©es"
          content:
            application/json:
              schema:
                type: "null"
                description: "P√©riode sp√©ciale supprim√©e avec succ√®s"
              example: null
          headers: null
        404:
          description: "Code 404"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
        500:
          description: "Erreur serveur"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  error:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /events:
    post:
      tags:
        - √âv√©nements
      summary: "Cr√©e un nouvel √©v√©nement (mus√©e, association ou externe)"
      description: ""
      operationId: "post_events"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                  category:
                    type:
                      - string
                    nullable: true
                  status:
                    type: "string"
                  start_date:
                    type: "string"
                  end_date:
                    type:
                      - string
                    nullable: true
                  start_time:
                    type:
                      - string
                    nullable: true
                  end_time:
                    type:
                      - string
                    nullable: true
                  location_type:
                    type: "string"
                  location_name:
                    type:
                      - string
                    nullable: true
                  location_address:
                    type:
                      - string
                    nullable: true
                  location_city:
                    type:
                      - string
                    nullable: true
                  location_postal_code:
                    type:
                      - string
                    nullable: true
                  public_title_fr:
                    type:
                      - string
                    nullable: true
                  public_title_en:
                    type:
                      - string
                    nullable: true
                  public_description_fr:
                    type:
                      - string
                    nullable: true
                  public_description_en:
                    type:
                      - string
                    nullable: true
                  public_image_url:
                    type:
                      - string
                    nullable: true
                  private_notes:
                    type:
                      - string
                    nullable: true
                  private_contact:
                    type:
                      - string
                    nullable: true
                  manager_dev:
                    type: "boolean"
                  manager_bureau:
                    type: "boolean"
                  manager_museum:
                    type: "boolean"
                  manager_com:
                    type: "boolean"
                  capacity:
                    type:
                      - integer
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - type
                - start_date
              properties:
                type:
                  type: "string"
                  enum:
                    - museum
                    - association
                    - external
                  description: "Type d'√©v√©nement"
                category:
                  type: "string"
                  enum:
                    - live
                    - mediation
                    - workshop
                    - conference
                    - exhibition
                    - other
                  description: "Cat√©gorie pour les √©v√©nements mus√©e (requis si type=museum)"
                status:
                  type: "string"
                  enum:
                    - draft
                    - private
                    - member
                    - public
                  default: "draft"
                  description: "Statut de visibilit√©"
                start_date:
                  type: "string"
                  format: "date"
                  description: "Date de d√©but (format YYYY-MM-DD)"
                end_date:
                  type:
                    - string
                  format: "date"
                  description: "Date de fin (optionnel, format YYYY-MM-DD)"
                  nullable: true
                start_time:
                  type:
                    - string
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de d√©but (format HH:MM:SS)"
                  nullable: true
                end_time:
                  type:
                    - string
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  description: "Heure de fin (format HH:MM:SS)"
                  nullable: true
                location_type:
                  type: "string"
                  enum:
                    - museum
                    - external
                  default: "museum"
                  description: "Type de localisation"
                location_name:
                  type:
                    - string
                  maxLength: 255
                  description: "Nom du lieu"
                  nullable: true
                location_address:
                  type:
                    - string
                  description: "Adresse compl√®te"
                  nullable: true
                location_city:
                  type:
                    - string
                  maxLength: 100
                  description: "Ville"
                  nullable: true
                location_postal_code:
                  type:
                    - string
                  maxLength: 20
                  description: "Code postal"
                  nullable: true
                public_title_fr:
                  type:
                    - string
                  maxLength: 255
                  description: "Titre public en fran√ßais"
                  nullable: true
                public_title_en:
                  type:
                    - string
                  maxLength: 255
                  description: "Titre public en anglais"
                  nullable: true
                public_description_fr:
                  type:
                    - string
                  description: "Description publique en fran√ßais"
                  nullable: true
                public_description_en:
                  type:
                    - string
                  description: "Description publique en anglais"
                  nullable: true
                public_image_url:
                  type:
                    - string
                  maxLength: 500
                  description: "URL de l'image publique"
                  nullable: true
                private_notes:
                  type:
                    - string
                  description: "Notes priv√©es pour les admins"
                  nullable: true
                private_contact:
                  type:
                    - string
                  maxLength: 255
                  description: "Contact priv√©"
                  nullable: true
                manager_dev:
                  type: "boolean"
                  default: false
                  description: "G√©r√© par dev"
                manager_bureau:
                  type: "boolean"
                  default: false
                  description: "G√©r√© par bureau"
                manager_museum:
                  type: "boolean"
                  default: false
                  description: "G√©r√© par mus√©e"
                manager_com:
                  type: "boolean"
                  default: false
                  description: "G√©r√© par com"
                capacity:
                  type:
                    - integer
                  minimum: 1
                  description: "Capacit√© maximale"
                  nullable: true
                is_active:
                  type: "boolean"
                  default: true
                  description: "√âv√©nement actif"
                related_event_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
                  description: "IDs des √©v√©nements √† lier"
      security:
        - cookieAuth:
    get:
      tags:
        - √âv√©nements
      summary: "R√©cup√®re les √©v√©nements avec pagination et filtres (tous types)"
      description: ""
      operationId: "get_events"
      parameters:
        - name: "type"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            enum:
              - museum
              - association
              - external
        - name: "category"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            enum:
              - live
              - mediation
              - workshop
              - conference
              - exhibition
              - other
        - name: "status"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            enum:
              - draft
              - private
              - member
              - public
        - name: "start_date"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            format: "date"
        - name: "end_date"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            format: "date"
        - name: "date"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            format: "date"
        - name: "location_type"
          in: "query"
          description: ""
          required: false
          schema:
            type: "string"
            enum:
              - museum
              - external
        - name: "is_active"
          in: "query"
          description: ""
          required: false
          schema:
            type: "boolean"
        - name: "include_relations"
          in: "query"
          description: ""
          required: false
          schema:
            type: "boolean"
        - name: "page"
          in: "query"
          description: ""
          required: false
          schema:
            type: "integer"
            minimum: 1
            default: 1
        - name: "limit"
          in: "query"
          description: ""
          required: false
          schema:
            type: "integer"
            minimum: 1
            maximum: 500
            default: 50
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  events:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        id:
                          type: "string"
                        type:
                          type: "string"
                        category:
                          type:
                            - string
                          nullable: true
                        status:
                          type: "string"
                        start_date:
                          type: "string"
                        end_date:
                          type:
                            - string
                          nullable: true
                        start_time:
                          type:
                            - string
                          nullable: true
                        end_time:
                          type:
                            - string
                          nullable: true
                        location_type:
                          type: "string"
                        location_name:
                          type:
                            - string
                          nullable: true
                        location_address:
                          type:
                            - string
                          nullable: true
                        location_city:
                          type:
                            - string
                          nullable: true
                        location_postal_code:
                          type:
                            - string
                          nullable: true
                        public_title_fr:
                          type:
                            - string
                          nullable: true
                        public_title_en:
                          type:
                            - string
                          nullable: true
                        public_description_fr:
                          type:
                            - string
                          nullable: true
                        public_description_en:
                          type:
                            - string
                          nullable: true
                        public_image_url:
                          type:
                            - string
                          nullable: true
                        private_notes:
                          type:
                            - string
                          nullable: true
                        private_contact:
                          type:
                            - string
                          nullable: true
                        manager_dev:
                          type: "boolean"
                        manager_bureau:
                          type: "boolean"
                        manager_museum:
                          type: "boolean"
                        manager_com:
                          type: "boolean"
                        capacity:
                          type:
                            - integer
                          nullable: true
                        is_active:
                          type: "boolean"
                        created_at:
                          type: "string"
                        updated_at:
                          type: "string"
                  total:
                    type: "integer"
                  page:
                    type: "integer"
                  limit:
                    type: "integer"
                  totalPages:
                    type: "integer"
              example: null
          headers: null
      security:
        - cookieAuth:
  /events/:id:
    get:
      tags:
        - √âv√©nements
      summary: "R√©cup√®re un √©v√©nement par son ID"
      description: ""
      operationId: "get_events_:id"
      parameters:
        - name: "include_relations"
          in: "query"
          description: ""
          required: false
          schema:
            type: "boolean"
        - name: "id"
          in: "path"
          description: ""
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                  category:
                    type:
                      - string
                    nullable: true
                  status:
                    type: "string"
                  start_date:
                    type: "string"
                  end_date:
                    type:
                      - string
                    nullable: true
                  start_time:
                    type:
                      - string
                    nullable: true
                  end_time:
                    type:
                      - string
                    nullable: true
                  location_type:
                    type: "string"
                  location_name:
                    type:
                      - string
                    nullable: true
                  location_address:
                    type:
                      - string
                    nullable: true
                  location_city:
                    type:
                      - string
                    nullable: true
                  location_postal_code:
                    type:
                      - string
                    nullable: true
                  public_title_fr:
                    type:
                      - string
                    nullable: true
                  public_title_en:
                    type:
                      - string
                    nullable: true
                  public_description_fr:
                    type:
                      - string
                    nullable: true
                  public_description_en:
                    type:
                      - string
                    nullable: true
                  public_image_url:
                    type:
                      - string
                    nullable: true
                  private_notes:
                    type:
                      - string
                    nullable: true
                  private_contact:
                    type:
                      - string
                    nullable: true
                  manager_dev:
                    type: "boolean"
                  manager_bureau:
                    type: "boolean"
                  manager_museum:
                    type: "boolean"
                  manager_com:
                    type: "boolean"
                  capacity:
                    type:
                      - integer
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
    put:
      tags:
        - √âv√©nements
      summary: "Met √† jour un √©v√©nement"
      description: ""
      operationId: "put_events_:id"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                  type:
                    type: "string"
                  category:
                    type:
                      - string
                    nullable: true
                  status:
                    type: "string"
                  start_date:
                    type: "string"
                  end_date:
                    type:
                      - string
                    nullable: true
                  start_time:
                    type:
                      - string
                    nullable: true
                  end_time:
                    type:
                      - string
                    nullable: true
                  location_type:
                    type: "string"
                  location_name:
                    type:
                      - string
                    nullable: true
                  location_address:
                    type:
                      - string
                    nullable: true
                  location_city:
                    type:
                      - string
                    nullable: true
                  location_postal_code:
                    type:
                      - string
                    nullable: true
                  public_title_fr:
                    type:
                      - string
                    nullable: true
                  public_title_en:
                    type:
                      - string
                    nullable: true
                  public_description_fr:
                    type:
                      - string
                    nullable: true
                  public_description_en:
                    type:
                      - string
                    nullable: true
                  public_image_url:
                    type:
                      - string
                    nullable: true
                  private_notes:
                    type:
                      - string
                    nullable: true
                  private_contact:
                    type:
                      - string
                    nullable: true
                  manager_dev:
                    type: "boolean"
                  manager_bureau:
                    type: "boolean"
                  manager_museum:
                    type: "boolean"
                  manager_com:
                    type: "boolean"
                  capacity:
                    type:
                      - integer
                    nullable: true
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                  updated_at:
                    type: "string"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                type:
                  type: "string"
                  enum:
                    - museum
                    - association
                    - external
                category:
                  type:
                    - string
                  enum:
                    - live
                    - mediation
                    - workshop
                    - conference
                    - exhibition
                    - other
                  nullable: true
                status:
                  type: "string"
                  enum:
                    - draft
                    - private
                    - member
                    - public
                start_date:
                  type: "string"
                  format: "date"
                end_date:
                  type:
                    - string
                  format: "date"
                  nullable: true
                start_time:
                  type:
                    - string
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  nullable: true
                end_time:
                  type:
                    - string
                  pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"
                  nullable: true
                location_type:
                  type: "string"
                  enum:
                    - museum
                    - external
                location_name:
                  type:
                    - string
                  maxLength: 255
                  nullable: true
                location_address:
                  type:
                    - string
                  nullable: true
                location_city:
                  type:
                    - string
                  maxLength: 100
                  nullable: true
                location_postal_code:
                  type:
                    - string
                  maxLength: 20
                  nullable: true
                public_title_fr:
                  type:
                    - string
                  maxLength: 255
                  nullable: true
                public_title_en:
                  type:
                    - string
                  maxLength: 255
                  nullable: true
                public_description_fr:
                  type:
                    - string
                  nullable: true
                public_description_en:
                  type:
                    - string
                  nullable: true
                public_image_url:
                  type:
                    - string
                  maxLength: 500
                  nullable: true
                private_notes:
                  type:
                    - string
                  nullable: true
                private_contact:
                  type:
                    - string
                  maxLength: 255
                  nullable: true
                manager_dev:
                  type: "boolean"
                manager_bureau:
                  type: "boolean"
                manager_museum:
                  type: "boolean"
                manager_com:
                  type: "boolean"
                capacity:
                  type:
                    - integer
                  minimum: 1
                  nullable: true
                is_active:
                  type: "boolean"
                related_event_ids:
                  type: "array"
                  items:
                    type: "string"
                    format: "uuid"
      security:
        - cookieAuth:
    delete:
      tags:
        - √âv√©nements
      summary: "Supprime un √©v√©nement"
      description: ""
      operationId: "delete_events_:id"
      parameters:
        - name: "id"
          in: "path"
          description: ""
          required: true
          schema:
            type: "string"
            format: "uuid"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  success:
                    type: "boolean"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/calendar:
    get:
      tags:
        - Mus√©e - Calendrier
      summary: "R√©cup√®re le calendrier avec √©v√©nements et horaires d'ouverture du mus√©e"
      description: ""
      operationId: "get_museum_calendar"
      parameters:
        - name: "start_date"
          in: "query"
          description: "Date de d√©but (format YYYY-MM-DD)"
          required: true
          schema:
            type: "string"
            format: "date"
            description: "Date de d√©but (format YYYY-MM-DD)"
        - name: "end_date"
          in: "query"
          description: "Date de fin (optionnel, par d√©faut = start_date)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "Date de fin (optionnel, par d√©faut = start_date)"
        - name: "view"
          in: "query"
          description: "Vue du calendrier"
          required: false
          schema:
            type: "string"
            enum:
              - day
              - week
              - month
            default: "month"
            description: "Vue du calendrier"
        - name: "status"
          in: "query"
          description: "Filtrer par statut (par d√©faut: public et member)"
          required: false
          schema:
            type: "string"
            enum:
              - draft
              - private
              - member
              - public
            description: "Filtrer par statut (par d√©faut: public et member)"
        - name: "include_private"
          in: "query"
          description: "Inclure les √©v√©nements priv√©s (admin uniquement)"
          required: false
          schema:
            type: "boolean"
            default: false
            description: "Inclure les √©v√©nements priv√©s (admin uniquement)"
        - name: "event_types"
          in: "query"
          description: "Filtrer par types d'√©v√©nements (par d√©faut: tous les types)"
          required: false
          schema:
            type: "array"
            items:
              type: "string"
              enum:
                - museum
                - association
                - external
            description: "Filtrer par types d'√©v√©nements (par d√©faut: tous les types)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  days:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        date:
                          type: "string"
                        is_open:
                          type: "boolean"
                        opening_hours:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              start_time:
                                type: "string"
                              end_time:
                                type: "string"
                              audience_type:
                                type: "string"
                              description:
                                type:
                                  - string
                                nullable: true
                        paid_tickets_count:
                          type: "integer"
                        events:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              id:
                                type: "string"
                              type:
                                type: "string"
                              category:
                                type:
                                  - string
                                nullable: true
                              status:
                                type: "string"
                              start_date:
                                type: "string"
                              end_date:
                                type:
                                  - string
                                nullable: true
                              start_time:
                                type:
                                  - string
                                nullable: true
                              end_time:
                                type:
                                  - string
                                nullable: true
                              location_type:
                                type: "string"
                              location_name:
                                type:
                                  - string
                                nullable: true
                              location_address:
                                type:
                                  - string
                                nullable: true
                              location_city:
                                type:
                                  - string
                                nullable: true
                              location_postal_code:
                                type:
                                  - string
                                nullable: true
                              public_title_fr:
                                type:
                                  - string
                                nullable: true
                              public_title_en:
                                type:
                                  - string
                                nullable: true
                              public_description_fr:
                                type:
                                  - string
                                nullable: true
                              public_description_en:
                                type:
                                  - string
                                nullable: true
                              public_image_url:
                                type:
                                  - string
                                nullable: true
                              private_notes:
                                type:
                                  - string
                                nullable: true
                              private_contact:
                                type:
                                  - string
                                nullable: true
                              manager_dev:
                                type: "boolean"
                              manager_bureau:
                                type: "boolean"
                              manager_museum:
                                type: "boolean"
                              manager_com:
                                type: "boolean"
                              capacity:
                                type:
                                  - integer
                                nullable: true
                              is_active:
                                type: "boolean"
                              created_at:
                                type: "string"
                              updated_at:
                                type: "string"
                        holiday_periods:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              id:
                                type: "string"
                              name:
                                type:
                                  - string
                                nullable: true
                              start_date:
                                type: "string"
                              end_date:
                                type: "string"
                              zone:
                                type:
                                  - string
                                nullable: true
                        closure_periods:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              id:
                                type: "string"
                              name:
                                type:
                                  - string
                                nullable: true
                              start_date:
                                type: "string"
                              end_date:
                                type: "string"
                              zone:
                                type:
                                  - string
                                nullable: true
                  start_date:
                    type: "string"
                  end_date:
                    type: "string"
                  view:
                    type: "string"
              example: null
          headers: null
      security:
        - cookieAuth:
  /museum/member-presences:
    post:
      tags:
        - Pr√©sences membres
      summary: "Cr√©er ou mettre √† jour la pr√©sence du membre connect√© pour une date. Le membre peut indiquer s'il vient le matin, l'apr√®s-midi, ou les deux."
      description: "**Cr√©ation d'une pr√©sence** : je devrais recevoir la pr√©sence cr√©√©e la pr√©sence devrait contenir mon user_id et mon user_name

**Mise √† jour d'une pr√©sence existante** : la pr√©sence devrait √™tre mise √† jour la p√©riode devrait √™tre la nouvelle valeur

**Erreur si la date est invalide** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer \"Date invalide\"

**Erreur si l'utilisateur n'existe pas** : je devrais recevoir une erreur 400 le message d'erreur devrait indiquer \"Utilisateur non trouv√©\"

**Acc√®s refus√© sans authentification** : je devrais recevoir une erreur 401 le message d'erreur devrait indiquer \"Non authentifi√©\"

### Sc√©narios de test

**Cr√©ation d'une pr√©sence**

üìã que je suis authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/member-presences\" avec une date et une p√©riode

‚úÖ je devrais recevoir la pr√©sence cr√©√©e

‚úÖ la pr√©sence devrait contenir mon user_id et mon user_name

**Mise √† jour d'une pr√©sence existante**

üìã qu'une pr√©sence existe d√©j√† pour cette date

‚ö° je fais une requ√™te POST vers \"/museum/member-presences\" avec la m√™me date et une nouvelle p√©riode

‚úÖ la pr√©sence devrait √™tre mise √† jour

‚úÖ la p√©riode devrait √™tre la nouvelle valeur

**Erreur si la date est invalide**

üìã que je suis authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/member-presences\" avec une date invalide

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer \"Date invalide\"

**Erreur si l'utilisateur n'existe pas**

üìã que mon discord_id n'existe pas dans la base de donn√©es

‚ö° je fais une requ√™te POST vers \"/museum/member-presences\"

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer \"Utilisateur non trouv√©\"

**Acc√®s refus√© sans authentification**

üìã que je ne suis pas authentifi√©

‚ö° je fais une requ√™te POST vers \"/museum/member-presences\"

‚úÖ je devrais recevoir une erreur 401

‚úÖ le message d'erreur devrait indiquer \"Non authentifi√©\"

"
      operationId: "post_museum_member-presences"
      parameters:
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                    format: "uuid"
                  user_id:
                    type: "string"
                    format: "uuid"
                  user_name:
                    type: "string"
                  date:
                    type: "string"
                    format: "date"
                  period:
                    type: "string"
                    enum:
                      - morning
                      - afternoon
                      - both
                  refused_by_admin:
                    type: "boolean"
                  created_at:
                    type: "string"
                    format: "date-time"
                  updated_at:
                    type: "string"
                    format: "date-time"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - date
                - period
              properties:
                date:
                  type: "string"
                  format: "date"
                  description: "Date de pr√©sence (format YYYY-MM-DD)"
                period:
                  type: "string"
                  enum:
                    - morning
                    - afternoon
                    - both
                  description: "P√©riode de pr√©sence : matin, apr√®s-midi, ou les deux"
      security:
        - cookieAuth:
    get:
      tags:
        - Pr√©sences membres
      summary: "R√©cup√®re les pr√©sences. Pour un membre : ses propres pr√©sences. Pour bureau/dev : toutes les pr√©sences de tous les membres. Retourne les jours avec leurs tableaux de pr√©sences."
      description: "**R√©cup√©ration de mes propres pr√©sences** : que j'ai des pr√©sences enregistr√©es je devrais recevoir mes pr√©sences organis√©es par jour chaque jour devrait contenir la date, le nom du jour et les pr√©sences

**R√©cup√©ration de toutes les pr√©sences (admin)** : je devrais recevoir toutes les pr√©sences de tous les membres les pr√©sences devraient √™tre organis√©es par jour

**R√©cup√©ration avec une seule date** : je devrais recevoir les pr√©sences pour cette date uniquement end_date devrait √™tre √©gal √† start_date

### Sc√©narios de test

**R√©cup√©ration de mes propres pr√©sences**

üìã que je suis authentifi√©

‚úÖ que j'ai des pr√©sences enregistr√©es

‚ö° je fais une requ√™te GET vers \"/museum/member-presences\" avec start_date et end_date

‚úÖ je devrais recevoir mes pr√©sences organis√©es par jour

‚úÖ chaque jour devrait contenir la date, le nom du jour et les pr√©sences

**R√©cup√©ration de toutes les pr√©sences (admin)**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚ö° je fais une requ√™te GET vers \"/museum/member-presences\" avec start_date et end_date

‚úÖ je devrais recevoir toutes les pr√©sences de tous les membres

‚úÖ les pr√©sences devraient √™tre organis√©es par jour

**R√©cup√©ration avec une seule date**

üìã que je suis authentifi√©

‚ö° je fais une requ√™te GET vers \"/museum/member-presences\" avec seulement start_date

‚úÖ je devrais recevoir les pr√©sences pour cette date uniquement

‚úÖ end_date devrait √™tre √©gal √† start_date

"
      operationId: "get_museum_member-presences"
      parameters:
        - name: "start_date"
          in: "query"
          description: "Date de d√©but (format YYYY-MM-DD)"
          required: true
          schema:
            type: "string"
            format: "date"
            description: "Date de d√©but (format YYYY-MM-DD)"
        - name: "end_date"
          in: "query"
          description: "Date de fin (optionnel, par d√©faut = start_date)"
          required: false
          schema:
            type: "string"
            format: "date"
            description: "Date de fin (optionnel, par d√©faut = start_date)"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  days:
                    type: "array"
                    items:
                      type: "object"
                      properties:
                        date:
                          type: "string"
                          format: "date"
                        day_name:
                          type: "string"
                        is_open:
                          type: "boolean"
                        presences:
                          type: "array"
                          items:
                            type: "object"
                            properties:
                              id:
                                type: "string"
                                format: "uuid"
                              user_id:
                                type: "string"
                                format: "uuid"
                              user_name:
                                type: "string"
                              date:
                                type: "string"
                                format: "date"
                              period:
                                type: "string"
                                enum:
                                  - morning
                                  - afternoon
                                  - both
                              refused_by_admin:
                                type: "boolean"
                              created_at:
                                type: "string"
                                format: "date-time"
                              updated_at:
                                type: "string"
                                format: "date-time"
                  start_date:
                    type: "string"
                    format: "date"
                  end_date:
                    type: "string"
                    format: "date"
              example: null
          headers: null
  /museum/member-presences/:id/refuse:
    put:
      tags:
        - Pr√©sences membres
      summary: "Refuser ou accepter une pr√©sence (bureau et dev uniquement). Permet aux admins de refuser certaines pr√©sences."
      description: "**Refus d'une pr√©sence (admin uniquement)** : qu'une pr√©sence existe la pr√©sence devrait √™tre marqu√©e comme refus√©e refused_by_admin devrait √™tre true

**Acceptation d'une pr√©sence refus√©e (admin uniquement)** : qu'une pr√©sence est refus√©e la pr√©sence devrait √™tre accept√©e refused_by_admin devrait √™tre false

**Acc√®s refus√© pour refuser une pr√©sence sans r√¥le admin** : je devrais recevoir une erreur 403 le message d'erreur devrait indiquer \"Acc√®s refus√© : r√¥le insuffisant\"

### Sc√©narios de test

**Refus d'une pr√©sence (admin uniquement)**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'une pr√©sence existe

‚ö° je fais une requ√™te PUT vers \"/museum/member-presences/:id/refuse\" avec refused=true

‚úÖ la pr√©sence devrait √™tre marqu√©e comme refus√©e

‚úÖ refused_by_admin devrait √™tre true

**Acceptation d'une pr√©sence refus√©e (admin uniquement)**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'une pr√©sence est refus√©e

‚ö° je fais une requ√™te PUT vers \"/museum/member-presences/:id/refuse\" avec refused=false

‚úÖ la pr√©sence devrait √™tre accept√©e

‚úÖ refused_by_admin devrait √™tre false

**Acc√®s refus√© pour refuser une pr√©sence sans r√¥le admin**

üìã que je suis authentifi√© sans r√¥le bureau ou dev

‚ö° je fais une requ√™te PUT vers \"/museum/member-presences/:id/refuse\"

‚úÖ je devrais recevoir une erreur 403

‚úÖ le message d'erreur devrait indiquer \"Acc√®s refus√© : r√¥le insuffisant\"

"
      operationId: "put_museum_member-presences_:id_refuse"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de la pr√©sence"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de la pr√©sence"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  id:
                    type: "string"
                    format: "uuid"
                  user_id:
                    type: "string"
                    format: "uuid"
                  user_name:
                    type: "string"
                  date:
                    type: "string"
                    format: "date"
                  period:
                    type: "string"
                    enum:
                      - morning
                      - afternoon
                      - both
                  refused_by_admin:
                    type: "boolean"
                  created_at:
                    type: "string"
                    format: "date-time"
                  updated_at:
                    type: "string"
                    format: "date-time"
              example: null
          headers: null
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              required:
                - refused
              properties:
                refused:
                  type: "boolean"
                  description: "true pour refuser, false pour accepter"
      security:
        - cookieAuth:
  /museum/member-presences/:id:
    delete:
      tags:
        - Pr√©sences membres
      summary: "Supprimer une pr√©sence. Un membre peut supprimer sa propre pr√©sence. Les admins peuvent supprimer n'importe quelle pr√©sence."
      description: "**Suppression de ma propre pr√©sence** : qu'une de mes pr√©sences existe la pr√©sence devrait √™tre supprim√©e je devrais recevoir { success: true }

**Suppression d'une pr√©sence par un admin** : qu'une pr√©sence existe la pr√©sence devrait √™tre supprim√©e je devrais recevoir { success: true }

**Erreur si je tente de supprimer une pr√©sence qui ne m'appartient pas** : qu'une pr√©sence d'un autre membre existe je devrais recevoir une erreur 400 le message d'erreur devrait indiquer \"Vous ne pouvez supprimer que vos propres pr√©sences\"

### Sc√©narios de test

**Suppression de ma propre pr√©sence**

üìã que je suis authentifi√©

‚úÖ qu'une de mes pr√©sences existe

‚ö° je fais une requ√™te DELETE vers \"/museum/member-presences/:id\"

‚úÖ la pr√©sence devrait √™tre supprim√©e

‚úÖ je devrais recevoir { success: true }

**Suppression d'une pr√©sence par un admin**

üìã que je suis authentifi√© avec un r√¥le bureau ou dev

‚úÖ qu'une pr√©sence existe

‚ö° je fais une requ√™te DELETE vers \"/museum/member-presences/:id\"

‚úÖ la pr√©sence devrait √™tre supprim√©e

‚úÖ je devrais recevoir { success: true }

**Erreur si je tente de supprimer une pr√©sence qui ne m'appartient pas**

üìã que je suis authentifi√©

‚úÖ qu'une pr√©sence d'un autre membre existe

‚ö° je fais une requ√™te DELETE vers \"/museum/member-presences/:id\"

‚úÖ je devrais recevoir une erreur 400

‚úÖ le message d'erreur devrait indiquer \"Vous ne pouvez supprimer que vos propres pr√©sences\"

"
      operationId: "delete_museum_member-presences_:id"
      parameters:
        - name: "id"
          in: "path"
          description: "ID de la pr√©sence"
          required: true
          schema:
            type: "string"
            format: "uuid"
            description: "ID de la pr√©sence"
      responses:
        200:
          description: "Succ√®s"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  success:
                    type: "boolean"
              example: null
          headers: null
      security:
        - cookieAuth:
components:
  securitySchemes:
    cookieAuth:
      type: "apiKey"
      in: "cookie"
      name: "discord_access_token"
      description: "Token d'acc√®s Discord stock√© dans un cookie HTTP-only"
